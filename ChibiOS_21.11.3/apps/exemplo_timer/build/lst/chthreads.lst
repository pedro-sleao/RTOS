   1               		.file	"chthreads.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  10               		.section	.text.__thd_object_init,"ax",@progbits
  11               	.global	__thd_object_init
  13               	__thd_object_init:
  14               	.LFB190:
  15               		.file 1 "../../os/rt/src/chthreads.c"
   1:../../os/rt/src/chthreads.c **** /*
   2:../../os/rt/src/chthreads.c ****     ChibiOS - Copyright (C) 2006,2007,2008,2009,2010,2011,2012,2013,2014,
   3:../../os/rt/src/chthreads.c ****               2015,2016,2017,2018,2019,2020,2021 Giovanni Di Sirio.
   4:../../os/rt/src/chthreads.c **** 
   5:../../os/rt/src/chthreads.c ****     This file is part of ChibiOS.
   6:../../os/rt/src/chthreads.c **** 
   7:../../os/rt/src/chthreads.c ****     ChibiOS is free software; you can redistribute it and/or modify
   8:../../os/rt/src/chthreads.c ****     it under the terms of the GNU General Public License as published by
   9:../../os/rt/src/chthreads.c ****     the Free Software Foundation version 3 of the License.
  10:../../os/rt/src/chthreads.c **** 
  11:../../os/rt/src/chthreads.c ****     ChibiOS is distributed in the hope that it will be useful,
  12:../../os/rt/src/chthreads.c ****     but WITHOUT ANY WARRANTY; without even the implied warranty of
  13:../../os/rt/src/chthreads.c ****     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  14:../../os/rt/src/chthreads.c ****     GNU General Public License for more details.
  15:../../os/rt/src/chthreads.c **** 
  16:../../os/rt/src/chthreads.c ****     You should have received a copy of the GNU General Public License
  17:../../os/rt/src/chthreads.c ****     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  18:../../os/rt/src/chthreads.c **** */
  19:../../os/rt/src/chthreads.c **** 
  20:../../os/rt/src/chthreads.c **** /**
  21:../../os/rt/src/chthreads.c ****  * @file    rt/src/chthreads.c
  22:../../os/rt/src/chthreads.c ****  * @brief   Threads code.
  23:../../os/rt/src/chthreads.c ****  *
  24:../../os/rt/src/chthreads.c ****  * @addtogroup threads
  25:../../os/rt/src/chthreads.c ****  * @details Threads related APIs and services.
  26:../../os/rt/src/chthreads.c ****  *          <h2>Operation mode</h2>
  27:../../os/rt/src/chthreads.c ****  *          A thread is an abstraction of an independent instructions flow.
  28:../../os/rt/src/chthreads.c ****  *          In ChibiOS/RT a thread is represented by a "C" function owning
  29:../../os/rt/src/chthreads.c ****  *          a processor context, state informations and a dedicated stack
  30:../../os/rt/src/chthreads.c ****  *          area. In this scenario static variables are shared among all
  31:../../os/rt/src/chthreads.c ****  *          threads while automatic variables are local to the thread.<br>
  32:../../os/rt/src/chthreads.c ****  *          Operations defined for threads:
  33:../../os/rt/src/chthreads.c ****  *          - <b>Create</b>, a thread is started on the specified thread
  34:../../os/rt/src/chthreads.c ****  *            function. This operation is available in multiple variants,
  35:../../os/rt/src/chthreads.c ****  *            both static and dynamic.
  36:../../os/rt/src/chthreads.c ****  *          - <b>Exit</b>, a thread terminates by returning from its top
  37:../../os/rt/src/chthreads.c ****  *            level function or invoking a specific API, the thread can
  38:../../os/rt/src/chthreads.c ****  *            return a value that can be retrieved by other threads.
  39:../../os/rt/src/chthreads.c ****  *          - <b>Wait</b>, a thread waits for the termination of another
  40:../../os/rt/src/chthreads.c ****  *            thread and retrieves its return value.
  41:../../os/rt/src/chthreads.c ****  *          - <b>Resume</b>, a thread created in suspended state is started.
  42:../../os/rt/src/chthreads.c ****  *          - <b>Sleep</b>, the execution of a thread is suspended for the
  43:../../os/rt/src/chthreads.c ****  *            specified amount of time or the specified future absolute time
  44:../../os/rt/src/chthreads.c ****  *            is reached.
  45:../../os/rt/src/chthreads.c ****  *          - <b>SetPriority</b>, a thread changes its own priority level.
  46:../../os/rt/src/chthreads.c ****  *          - <b>Yield</b>, a thread voluntarily renounces to its time slot.
  47:../../os/rt/src/chthreads.c ****  *          .
  48:../../os/rt/src/chthreads.c ****  * @{
  49:../../os/rt/src/chthreads.c ****  */
  50:../../os/rt/src/chthreads.c **** 
  51:../../os/rt/src/chthreads.c **** #include "ch.h"
  52:../../os/rt/src/chthreads.c **** 
  53:../../os/rt/src/chthreads.c **** /*===========================================================================*/
  54:../../os/rt/src/chthreads.c **** /* Module local definitions.                                                 */
  55:../../os/rt/src/chthreads.c **** /*===========================================================================*/
  56:../../os/rt/src/chthreads.c **** 
  57:../../os/rt/src/chthreads.c **** /*===========================================================================*/
  58:../../os/rt/src/chthreads.c **** /* Module exported variables.                                                */
  59:../../os/rt/src/chthreads.c **** /*===========================================================================*/
  60:../../os/rt/src/chthreads.c **** 
  61:../../os/rt/src/chthreads.c **** /*===========================================================================*/
  62:../../os/rt/src/chthreads.c **** /* Module local types.                                                       */
  63:../../os/rt/src/chthreads.c **** /*===========================================================================*/
  64:../../os/rt/src/chthreads.c **** 
  65:../../os/rt/src/chthreads.c **** /*===========================================================================*/
  66:../../os/rt/src/chthreads.c **** /* Module local variables.                                                   */
  67:../../os/rt/src/chthreads.c **** /*===========================================================================*/
  68:../../os/rt/src/chthreads.c **** 
  69:../../os/rt/src/chthreads.c **** /*===========================================================================*/
  70:../../os/rt/src/chthreads.c **** /* Module local functions.                                                   */
  71:../../os/rt/src/chthreads.c **** /*===========================================================================*/
  72:../../os/rt/src/chthreads.c **** 
  73:../../os/rt/src/chthreads.c **** /*===========================================================================*/
  74:../../os/rt/src/chthreads.c **** /* Module exported functions.                                                */
  75:../../os/rt/src/chthreads.c **** /*===========================================================================*/
  76:../../os/rt/src/chthreads.c **** 
  77:../../os/rt/src/chthreads.c **** /**
  78:../../os/rt/src/chthreads.c ****  * @brief   Initializes a thread structure.
  79:../../os/rt/src/chthreads.c ****  * @note    This is an internal functions, do not use it in application code.
  80:../../os/rt/src/chthreads.c ****  *
  81:../../os/rt/src/chthreads.c ****  * @param[in] oip       pointer to the OS instance
  82:../../os/rt/src/chthreads.c ****  * @param[in] tp        pointer to the thread
  83:../../os/rt/src/chthreads.c ****  * @param[in] name      thread name
  84:../../os/rt/src/chthreads.c ****  * @param[in] prio      the priority level for the new thread
  85:../../os/rt/src/chthreads.c ****  * @return              The same thread pointer passed as parameter.
  86:../../os/rt/src/chthreads.c ****  *
  87:../../os/rt/src/chthreads.c ****  * @notapi
  88:../../os/rt/src/chthreads.c ****  */
  89:../../os/rt/src/chthreads.c **** thread_t *__thd_object_init(os_instance_t *oip,
  90:../../os/rt/src/chthreads.c ****                             thread_t *tp,
  91:../../os/rt/src/chthreads.c ****                             const char *name,
  92:../../os/rt/src/chthreads.c ****                             tprio_t prio) {
  16               		.loc 1 92 0
  17               		.cfi_startproc
  18               	.LVL0:
  19 0000 CF93      		push r28
  20               	.LCFI0:
  21               		.cfi_def_cfa_offset 3
  22               		.cfi_offset 28, -2
  23 0002 DF93      		push r29
  24               	.LCFI1:
  25               		.cfi_def_cfa_offset 4
  26               		.cfi_offset 29, -3
  27               	/* prologue: function */
  28               	/* frame size = 0 */
  29               	/* stack size = 2 */
  30               	.L__stack_usage = 2
  31 0004 FB01      		movw r30,r22
  93:../../os/rt/src/chthreads.c **** 
  94:../../os/rt/src/chthreads.c ****   tp->hdr.pqueue.prio   = prio;
  32               		.loc 1 94 0
  33 0006 2483      		std Z+4,r18
  95:../../os/rt/src/chthreads.c ****   tp->state             = CH_STATE_WTSTART;
  34               		.loc 1 95 0
  35 0008 32E0      		ldi r19,lo8(2)
  36 000a 3787      		std Z+15,r19
  96:../../os/rt/src/chthreads.c ****   tp->flags             = CH_FLAG_MODE_STATIC;
  37               		.loc 1 96 0
  38 000c 108A      		std Z+16,__zero_reg__
  97:../../os/rt/src/chthreads.c ****   tp->owner             = oip;
  39               		.loc 1 97 0
  40 000e 9487      		std Z+12,r25
  41 0010 8387      		std Z+11,r24
  98:../../os/rt/src/chthreads.c **** #if CH_CFG_TIME_QUANTUM > 0
  99:../../os/rt/src/chthreads.c ****   tp->ticks             = (tslices_t)CH_CFG_TIME_QUANTUM;
 100:../../os/rt/src/chthreads.c **** #endif
 101:../../os/rt/src/chthreads.c **** #if CH_CFG_USE_MUTEXES == TRUE
 102:../../os/rt/src/chthreads.c ****   tp->realprio          = prio;
  42               		.loc 1 102 0
  43 0012 258F      		std Z+29,r18
 103:../../os/rt/src/chthreads.c ****   tp->mtxlist           = NULL;
  44               		.loc 1 103 0
  45 0014 148E      		std Z+28,__zero_reg__
  46 0016 138E      		std Z+27,__zero_reg__
 104:../../os/rt/src/chthreads.c **** #endif
 105:../../os/rt/src/chthreads.c **** #if CH_CFG_USE_EVENTS == TRUE
 106:../../os/rt/src/chthreads.c ****   tp->epending          = (eventmask_t)0;
  47               		.loc 1 106 0
  48 0018 128E      		std Z+26,__zero_reg__
 107:../../os/rt/src/chthreads.c **** #endif
 108:../../os/rt/src/chthreads.c **** #if CH_DBG_THREADS_PROFILING == TRUE
 109:../../os/rt/src/chthreads.c ****   tp->time              = (systime_t)0;
 110:../../os/rt/src/chthreads.c **** #endif
 111:../../os/rt/src/chthreads.c **** #if CH_CFG_USE_REGISTRY == TRUE
 112:../../os/rt/src/chthreads.c ****   tp->refs              = (trefs_t)1;
  49               		.loc 1 112 0
  50 001a 21E0      		ldi r18,lo8(1)
  51               	.LVL1:
  52 001c 218B      		std Z+17,r18
 113:../../os/rt/src/chthreads.c ****   tp->name              = name;
  53               		.loc 1 113 0
  54 001e 5687      		std Z+14,r21
  55 0020 4587      		std Z+13,r20
 114:../../os/rt/src/chthreads.c ****   REG_INSERT(oip, tp);
  56               		.loc 1 114 0
  57 0022 9B01      		movw r18,r22
  58 0024 295F      		subi r18,-7
  59 0026 3F4F      		sbci r19,-1
  60               	.LVL2:
  61 0028 AC01      		movw r20,r24
  62               	.LVL3:
  63 002a 495E      		subi r20,-23
  64 002c 5F4F      		sbci r21,-1
  65               	.LVL4:
  66               	.LBB220:
  67               	.LBB221:
  68               		.file 2 "../../os/rt/include/chlists.h"
   1:../../os/rt/include/chlists.h **** /*
   2:../../os/rt/include/chlists.h ****     ChibiOS - Copyright (C) 2006,2007,2008,2009,2010,2011,2012,2013,2014,
   3:../../os/rt/include/chlists.h ****               2015,2016,2017,2018,2019,2020,2021 Giovanni Di Sirio.
   4:../../os/rt/include/chlists.h **** 
   5:../../os/rt/include/chlists.h ****     This file is part of ChibiOS.
   6:../../os/rt/include/chlists.h **** 
   7:../../os/rt/include/chlists.h ****     ChibiOS is free software; you can redistribute it and/or modify
   8:../../os/rt/include/chlists.h ****     it under the terms of the GNU General Public License as published by
   9:../../os/rt/include/chlists.h ****     the Free Software Foundation version 3 of the License.
  10:../../os/rt/include/chlists.h **** 
  11:../../os/rt/include/chlists.h ****     ChibiOS is distributed in the hope that it will be useful,
  12:../../os/rt/include/chlists.h ****     but WITHOUT ANY WARRANTY; without even the implied warranty of
  13:../../os/rt/include/chlists.h ****     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  14:../../os/rt/include/chlists.h ****     GNU General Public License for more details.
  15:../../os/rt/include/chlists.h **** 
  16:../../os/rt/include/chlists.h ****     You should have received a copy of the GNU General Public License
  17:../../os/rt/include/chlists.h ****     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  18:../../os/rt/include/chlists.h **** */
  19:../../os/rt/include/chlists.h **** 
  20:../../os/rt/include/chlists.h **** /**
  21:../../os/rt/include/chlists.h ****  * @file    chlists.h
  22:../../os/rt/include/chlists.h ****  * @brief   Lists and Queues header.
  23:../../os/rt/include/chlists.h ****  *
  24:../../os/rt/include/chlists.h ****  * @addtogroup os_lists
  25:../../os/rt/include/chlists.h ****  * @{
  26:../../os/rt/include/chlists.h ****  */
  27:../../os/rt/include/chlists.h **** 
  28:../../os/rt/include/chlists.h **** #ifndef CHLISTS_H
  29:../../os/rt/include/chlists.h **** #define CHLISTS_H
  30:../../os/rt/include/chlists.h **** 
  31:../../os/rt/include/chlists.h **** /*===========================================================================*/
  32:../../os/rt/include/chlists.h **** /* Module constants.                                                         */
  33:../../os/rt/include/chlists.h **** /*===========================================================================*/
  34:../../os/rt/include/chlists.h **** 
  35:../../os/rt/include/chlists.h **** /*===========================================================================*/
  36:../../os/rt/include/chlists.h **** /* Module pre-compile time settings.                                         */
  37:../../os/rt/include/chlists.h **** /*===========================================================================*/
  38:../../os/rt/include/chlists.h **** 
  39:../../os/rt/include/chlists.h **** /*===========================================================================*/
  40:../../os/rt/include/chlists.h **** /* Derived constants and error checks.                                       */
  41:../../os/rt/include/chlists.h **** /*===========================================================================*/
  42:../../os/rt/include/chlists.h **** 
  43:../../os/rt/include/chlists.h **** /*===========================================================================*/
  44:../../os/rt/include/chlists.h **** /* Module data structures and types.                                         */
  45:../../os/rt/include/chlists.h **** /*===========================================================================*/
  46:../../os/rt/include/chlists.h **** 
  47:../../os/rt/include/chlists.h **** /**
  48:../../os/rt/include/chlists.h ****  * @brief   Type of a generic single link list header and element.
  49:../../os/rt/include/chlists.h ****  */
  50:../../os/rt/include/chlists.h **** typedef struct ch_list ch_list_t;
  51:../../os/rt/include/chlists.h **** 
  52:../../os/rt/include/chlists.h **** /**
  53:../../os/rt/include/chlists.h ****  * @brief   Structure representing a generic single link list header
  54:../../os/rt/include/chlists.h ****  *          and element.
  55:../../os/rt/include/chlists.h ****  */
  56:../../os/rt/include/chlists.h **** struct ch_list {
  57:../../os/rt/include/chlists.h ****   ch_list_t             *next;      /**< @brief Next in the list/queue.     */
  58:../../os/rt/include/chlists.h **** };
  59:../../os/rt/include/chlists.h **** 
  60:../../os/rt/include/chlists.h **** /**
  61:../../os/rt/include/chlists.h ****  * @brief   Type of a generic bidirectional linked list header and element.
  62:../../os/rt/include/chlists.h ****  */
  63:../../os/rt/include/chlists.h **** typedef struct ch_queue ch_queue_t;
  64:../../os/rt/include/chlists.h **** 
  65:../../os/rt/include/chlists.h **** /**
  66:../../os/rt/include/chlists.h ****  * @brief   Structure representing a generic bidirectional linked list header
  67:../../os/rt/include/chlists.h ****  *          and element.
  68:../../os/rt/include/chlists.h ****  */
  69:../../os/rt/include/chlists.h **** struct ch_queue {
  70:../../os/rt/include/chlists.h ****   ch_queue_t            *next;      /**< @brief Next in the list/queue.     */
  71:../../os/rt/include/chlists.h ****   ch_queue_t            *prev;      /**< @brief Previous in the queue.      */
  72:../../os/rt/include/chlists.h **** };
  73:../../os/rt/include/chlists.h **** 
  74:../../os/rt/include/chlists.h **** /**
  75:../../os/rt/include/chlists.h ****  * @brief   Type of a generic priority-ordered bidirectional linked list
  76:../../os/rt/include/chlists.h ****  *          header and element.
  77:../../os/rt/include/chlists.h ****  */
  78:../../os/rt/include/chlists.h **** typedef struct ch_priority_queue ch_priority_queue_t;
  79:../../os/rt/include/chlists.h **** 
  80:../../os/rt/include/chlists.h **** /**
  81:../../os/rt/include/chlists.h ****  * @brief   Structure representing a generic priority-ordered bidirectional
  82:../../os/rt/include/chlists.h ****  *          linked list header and element.
  83:../../os/rt/include/chlists.h ****  * @note    Link fields are void pointers in order to avoid aliasing issues.
  84:../../os/rt/include/chlists.h ****  */
  85:../../os/rt/include/chlists.h **** struct ch_priority_queue {
  86:../../os/rt/include/chlists.h ****   ch_priority_queue_t   *next;      /**< @brief Next in the queue.          */
  87:../../os/rt/include/chlists.h ****   ch_priority_queue_t   *prev;      /**< @brief Previous in the queue.      */
  88:../../os/rt/include/chlists.h ****   tprio_t               prio;       /**< @brief Priority of this element.   */
  89:../../os/rt/include/chlists.h **** };
  90:../../os/rt/include/chlists.h **** 
  91:../../os/rt/include/chlists.h **** /**
  92:../../os/rt/include/chlists.h ****  * @brief   Type of a generic bidirectional linked delta list
  93:../../os/rt/include/chlists.h ****  *          header and element.
  94:../../os/rt/include/chlists.h ****  */
  95:../../os/rt/include/chlists.h **** typedef struct ch_delta_list ch_delta_list_t;
  96:../../os/rt/include/chlists.h **** 
  97:../../os/rt/include/chlists.h **** /**
  98:../../os/rt/include/chlists.h ****  * @brief   Delta list element and header structure.
  99:../../os/rt/include/chlists.h ****  */
 100:../../os/rt/include/chlists.h **** struct ch_delta_list {
 101:../../os/rt/include/chlists.h ****   ch_delta_list_t       *next;      /**< @brief Next in the delta list.     */
 102:../../os/rt/include/chlists.h ****   ch_delta_list_t       *prev;      /**< @brief Previous in the delta list. */
 103:../../os/rt/include/chlists.h ****   sysinterval_t         delta;      /**< @brief Time interval from previous.*/
 104:../../os/rt/include/chlists.h **** };
 105:../../os/rt/include/chlists.h **** 
 106:../../os/rt/include/chlists.h **** /*===========================================================================*/
 107:../../os/rt/include/chlists.h **** /* Module macros.                                                            */
 108:../../os/rt/include/chlists.h **** /*===========================================================================*/
 109:../../os/rt/include/chlists.h **** 
 110:../../os/rt/include/chlists.h **** /**
 111:../../os/rt/include/chlists.h ****  * @brief   Data part of a static queue object initializer.
 112:../../os/rt/include/chlists.h ****  * @details This macro should be used when statically initializing a
 113:../../os/rt/include/chlists.h ****  *          queue that is part of a bigger structure.
 114:../../os/rt/include/chlists.h ****  *
 115:../../os/rt/include/chlists.h ****  * @param[in] name      the name of the queue variable
 116:../../os/rt/include/chlists.h ****  */
 117:../../os/rt/include/chlists.h **** #define __CH_QUEUE_DATA(name) {(ch_queue_t *)&name, (ch_queue_t *)&name}
 118:../../os/rt/include/chlists.h **** 
 119:../../os/rt/include/chlists.h **** /**
 120:../../os/rt/include/chlists.h ****  * @brief   Static queue object initializer.
 121:../../os/rt/include/chlists.h ****  * @details Statically initialized queues require no explicit
 122:../../os/rt/include/chlists.h ****  *          initialization using @p queue_init().
 123:../../os/rt/include/chlists.h ****  *
 124:../../os/rt/include/chlists.h ****  * @param[in] name      the name of the queue variable
 125:../../os/rt/include/chlists.h ****  */
 126:../../os/rt/include/chlists.h **** #define CH_QUEUE_DECL(name)                                                 \
 127:../../os/rt/include/chlists.h ****     ch_queue_t name = __CH_QUEUE_DATA(name)
 128:../../os/rt/include/chlists.h **** 
 129:../../os/rt/include/chlists.h **** /*===========================================================================*/
 130:../../os/rt/include/chlists.h **** /* External declarations.                                                    */
 131:../../os/rt/include/chlists.h **** /*===========================================================================*/
 132:../../os/rt/include/chlists.h **** 
 133:../../os/rt/include/chlists.h **** /* Early function prototypes required by the following headers.*/
 134:../../os/rt/include/chlists.h **** #ifdef __cplusplus
 135:../../os/rt/include/chlists.h **** extern "C" {
 136:../../os/rt/include/chlists.h **** #endif
 137:../../os/rt/include/chlists.h **** 
 138:../../os/rt/include/chlists.h **** #ifdef __cplusplus
 139:../../os/rt/include/chlists.h **** }
 140:../../os/rt/include/chlists.h **** #endif
 141:../../os/rt/include/chlists.h **** 
 142:../../os/rt/include/chlists.h **** /*===========================================================================*/
 143:../../os/rt/include/chlists.h **** /* Module inline functions.                                                  */
 144:../../os/rt/include/chlists.h **** /*===========================================================================*/
 145:../../os/rt/include/chlists.h **** 
 146:../../os/rt/include/chlists.h **** /**
 147:../../os/rt/include/chlists.h ****  * @brief   List initialization.
 148:../../os/rt/include/chlists.h ****  *
 149:../../os/rt/include/chlists.h ****  * @param[out] lp       pointer to the list header
 150:../../os/rt/include/chlists.h ****  *
 151:../../os/rt/include/chlists.h ****  * @notapi
 152:../../os/rt/include/chlists.h ****  */
 153:../../os/rt/include/chlists.h **** static inline void ch_list_init(ch_list_t *lp) {
 154:../../os/rt/include/chlists.h **** 
 155:../../os/rt/include/chlists.h ****   lp->next = lp;
 156:../../os/rt/include/chlists.h **** }
 157:../../os/rt/include/chlists.h **** 
 158:../../os/rt/include/chlists.h **** /**
 159:../../os/rt/include/chlists.h ****  * @brief   Evaluates to @p true if the specified list is empty.
 160:../../os/rt/include/chlists.h ****  *
 161:../../os/rt/include/chlists.h ****  * @param[in] lp        pointer to the list header
 162:../../os/rt/include/chlists.h ****  * @return              The status of the list.
 163:../../os/rt/include/chlists.h ****  *
 164:../../os/rt/include/chlists.h ****  * @notapi
 165:../../os/rt/include/chlists.h ****  */
 166:../../os/rt/include/chlists.h **** static inline bool ch_list_isempty(ch_list_t *lp) {
 167:../../os/rt/include/chlists.h **** 
 168:../../os/rt/include/chlists.h ****   return (bool)(lp->next == lp);
 169:../../os/rt/include/chlists.h **** }
 170:../../os/rt/include/chlists.h **** 
 171:../../os/rt/include/chlists.h **** /**
 172:../../os/rt/include/chlists.h ****  * @brief   Evaluates to @p true if the specified list is not empty.
 173:../../os/rt/include/chlists.h ****  *
 174:../../os/rt/include/chlists.h ****  * @param[in] lp        pointer to the list header
 175:../../os/rt/include/chlists.h ****  * @return              The status of the list.
 176:../../os/rt/include/chlists.h ****  *
 177:../../os/rt/include/chlists.h ****  * @notapi
 178:../../os/rt/include/chlists.h ****  */
 179:../../os/rt/include/chlists.h **** static inline bool ch_list_notempty(ch_list_t *lp) {
 180:../../os/rt/include/chlists.h **** 
 181:../../os/rt/include/chlists.h ****   return (bool)(lp->next != lp);
 182:../../os/rt/include/chlists.h **** }
 183:../../os/rt/include/chlists.h **** 
 184:../../os/rt/include/chlists.h **** /**
 185:../../os/rt/include/chlists.h ****  * @brief   Pushes an element on top of a stack list.
 186:../../os/rt/include/chlists.h ****  *
 187:../../os/rt/include/chlists.h ****  * @param[in] lp    the pointer to the list header
 188:../../os/rt/include/chlists.h ****  * @param[in] p     the pointer to the element to be inserted in the list
 189:../../os/rt/include/chlists.h ****  *
 190:../../os/rt/include/chlists.h ****  * @notapi
 191:../../os/rt/include/chlists.h ****  */
 192:../../os/rt/include/chlists.h **** static inline void ch_list_link(ch_list_t *lp, ch_list_t *p) {
 193:../../os/rt/include/chlists.h **** 
 194:../../os/rt/include/chlists.h ****   p->next = lp->next;
 195:../../os/rt/include/chlists.h ****   lp->next = p;
 196:../../os/rt/include/chlists.h **** }
 197:../../os/rt/include/chlists.h **** 
 198:../../os/rt/include/chlists.h **** /**
 199:../../os/rt/include/chlists.h ****  * @brief   Pops an element from the top of a stack list and returns it.
 200:../../os/rt/include/chlists.h ****  * @pre     The list must be non-empty before calling this function.
 201:../../os/rt/include/chlists.h ****  *
 202:../../os/rt/include/chlists.h ****  * @param[in] lp        the pointer to the list header
 203:../../os/rt/include/chlists.h ****  * @return              The removed element pointer.
 204:../../os/rt/include/chlists.h ****  *
 205:../../os/rt/include/chlists.h ****  * @notapi
 206:../../os/rt/include/chlists.h ****  */
 207:../../os/rt/include/chlists.h **** static inline ch_list_t *ch_list_unlink(ch_list_t *lp) {
 208:../../os/rt/include/chlists.h **** 
 209:../../os/rt/include/chlists.h ****   ch_list_t *p = lp->next;
 210:../../os/rt/include/chlists.h ****   lp->next = p->next;
 211:../../os/rt/include/chlists.h **** 
 212:../../os/rt/include/chlists.h ****   return p;
 213:../../os/rt/include/chlists.h **** }
 214:../../os/rt/include/chlists.h **** 
 215:../../os/rt/include/chlists.h **** /**
 216:../../os/rt/include/chlists.h ****  * @brief   Queue initialization.
 217:../../os/rt/include/chlists.h ****  *
 218:../../os/rt/include/chlists.h ****  * @param[out] qp       pointer to the queue header
 219:../../os/rt/include/chlists.h ****  *
 220:../../os/rt/include/chlists.h ****  * @notapi
 221:../../os/rt/include/chlists.h ****  */
 222:../../os/rt/include/chlists.h **** static inline void ch_queue_init(ch_queue_t *qp) {
 223:../../os/rt/include/chlists.h **** 
 224:../../os/rt/include/chlists.h ****   qp->next = qp;
 225:../../os/rt/include/chlists.h ****   qp->prev = qp;
 226:../../os/rt/include/chlists.h **** }
 227:../../os/rt/include/chlists.h **** 
 228:../../os/rt/include/chlists.h **** /**
 229:../../os/rt/include/chlists.h ****  * @brief   Evaluates to @p true if the specified queue is empty.
 230:../../os/rt/include/chlists.h ****  *
 231:../../os/rt/include/chlists.h ****  * @param[in] qp        pointer to the queue header
 232:../../os/rt/include/chlists.h ****  * @return              The status of the queue.
 233:../../os/rt/include/chlists.h ****  *
 234:../../os/rt/include/chlists.h ****  * @notapi
 235:../../os/rt/include/chlists.h ****  */
 236:../../os/rt/include/chlists.h **** static inline bool ch_queue_isempty(const ch_queue_t *qp) {
 237:../../os/rt/include/chlists.h **** 
 238:../../os/rt/include/chlists.h ****   return (bool)(qp->next == qp);
 239:../../os/rt/include/chlists.h **** }
 240:../../os/rt/include/chlists.h **** 
 241:../../os/rt/include/chlists.h **** /**
 242:../../os/rt/include/chlists.h ****  * @brief   Evaluates to @p true if the specified queue is not empty.
 243:../../os/rt/include/chlists.h ****  *
 244:../../os/rt/include/chlists.h ****  * @param[in] qp        pointer to the queue header
 245:../../os/rt/include/chlists.h ****  * @return              The status of the queue.
 246:../../os/rt/include/chlists.h ****  *
 247:../../os/rt/include/chlists.h ****  * @notapi
 248:../../os/rt/include/chlists.h ****  */
 249:../../os/rt/include/chlists.h **** static inline bool ch_queue_notempty(const ch_queue_t *qp) {
 250:../../os/rt/include/chlists.h **** 
 251:../../os/rt/include/chlists.h ****   return (bool)(qp->next != qp);
 252:../../os/rt/include/chlists.h **** }
 253:../../os/rt/include/chlists.h **** 
 254:../../os/rt/include/chlists.h **** /**
 255:../../os/rt/include/chlists.h ****  * @brief   Inserts an element into a queue.
 256:../../os/rt/include/chlists.h ****  *
 257:../../os/rt/include/chlists.h ****  * @param[in] qp        the pointer to the queue header
 258:../../os/rt/include/chlists.h ****  * @param[in] p         the pointer to the element to be inserted in the queue
 259:../../os/rt/include/chlists.h ****  *
 260:../../os/rt/include/chlists.h ****  * @notapi
 261:../../os/rt/include/chlists.h ****  */
 262:../../os/rt/include/chlists.h **** static inline void ch_queue_insert(ch_queue_t *qp, ch_queue_t *p) {
 263:../../os/rt/include/chlists.h **** 
 264:../../os/rt/include/chlists.h ****   p->next       = qp;
  69               		.loc 2 264 0
  70 002e 5087      		std Z+8,r21
  71 0030 4783      		std Z+7,r20
 265:../../os/rt/include/chlists.h ****   p->prev       = qp->prev;
  72               		.loc 2 265 0
  73 0032 EC01      		movw r28,r24
  74 0034 A98D      		ldd r26,Y+25
  75 0036 BA8D      		ldd r27,Y+26
  76 0038 B287      		std Z+10,r27
  77 003a A187      		std Z+9,r26
 266:../../os/rt/include/chlists.h ****   p->prev->next = p;
  78               		.loc 2 266 0
  79 003c 2D93      		st X+,r18
  80 003e 3C93      		st X,r19
  81               	.LVL5:
 267:../../os/rt/include/chlists.h ****   qp->prev      = p;
  82               		.loc 2 267 0
  83 0040 3A8F      		std Y+26,r19
  84 0042 298F      		std Y+25,r18
  85               	.LVL6:
  86               	.LBE221:
  87               	.LBE220:
 115:../../os/rt/src/chthreads.c **** #else
 116:../../os/rt/src/chthreads.c ****   (void)name;
 117:../../os/rt/src/chthreads.c **** #endif
 118:../../os/rt/src/chthreads.c **** #if CH_CFG_USE_WAITEXIT == TRUE
 119:../../os/rt/src/chthreads.c ****   ch_list_init(&tp->waiting);
  88               		.loc 1 119 0
  89 0044 CB01      		movw r24,r22
  90               	.LVL7:
  91 0046 4496      		adiw r24,20
  92               	.LVL8:
  93               	.LBB222:
  94               	.LBB223:
 155:../../os/rt/include/chlists.h **** }
  95               		.loc 2 155 0
  96 0048 958B      		std Z+21,r25
  97 004a 848B      		std Z+20,r24
  98               	.LVL9:
  99               	.LBE223:
 100               	.LBE222:
 120:../../os/rt/src/chthreads.c **** #endif
 121:../../os/rt/src/chthreads.c **** #if CH_CFG_USE_MESSAGES == TRUE
 122:../../os/rt/src/chthreads.c ****   ch_queue_init(&tp->msgqueue);
 101               		.loc 1 122 0
 102 004c 0296      		adiw r24,2
 103               	.LVL10:
 104               	.LBB224:
 105               	.LBB225:
 224:../../os/rt/include/chlists.h ****   qp->prev = qp;
 106               		.loc 2 224 0
 107 004e 978B      		std Z+23,r25
 108 0050 868B      		std Z+22,r24
 225:../../os/rt/include/chlists.h **** }
 109               		.loc 2 225 0
 110 0052 918F      		std Z+25,r25
 111 0054 808F      		std Z+24,r24
 112               	.LVL11:
 113               	.LBE225:
 114               	.LBE224:
 123:../../os/rt/src/chthreads.c **** #endif
 124:../../os/rt/src/chthreads.c **** #if CH_DBG_STATISTICS == TRUE
 125:../../os/rt/src/chthreads.c ****   chTMObjectInit(&tp->stats);
 126:../../os/rt/src/chthreads.c **** #endif
 127:../../os/rt/src/chthreads.c ****   CH_CFG_THREAD_INIT_HOOK(tp);
 128:../../os/rt/src/chthreads.c ****   return tp;
 129:../../os/rt/src/chthreads.c **** }
 115               		.loc 1 129 0
 116 0056 CB01      		movw r24,r22
 117               	/* epilogue start */
 118 0058 DF91      		pop r29
 119 005a CF91      		pop r28
 120               	.LVL12:
 121 005c 0895      		ret
 122               		.cfi_endproc
 123               	.LFE190:
 125               		.section	.text.chThdCreateSuspendedI,"ax",@progbits
 126               	.global	chThdCreateSuspendedI
 128               	chThdCreateSuspendedI:
 129               	.LFB191:
 130:../../os/rt/src/chthreads.c **** 
 131:../../os/rt/src/chthreads.c **** #if (CH_DBG_FILL_THREADS == TRUE) || defined(__DOXYGEN__)
 132:../../os/rt/src/chthreads.c **** /**
 133:../../os/rt/src/chthreads.c ****  * @brief   Stack fill utility.
 134:../../os/rt/src/chthreads.c ****  *
 135:../../os/rt/src/chthreads.c ****  * @param[in] startp    first address to fill
 136:../../os/rt/src/chthreads.c ****  * @param[in] endp      last address to fill +1
 137:../../os/rt/src/chthreads.c ****  *
 138:../../os/rt/src/chthreads.c ****  * @notapi
 139:../../os/rt/src/chthreads.c ****  */
 140:../../os/rt/src/chthreads.c **** void __thd_stackfill(uint8_t *startp, uint8_t *endp) {
 141:../../os/rt/src/chthreads.c **** 
 142:../../os/rt/src/chthreads.c ****   do {
 143:../../os/rt/src/chthreads.c ****     *startp++ = CH_DBG_STACK_FILL_VALUE;
 144:../../os/rt/src/chthreads.c ****   } while (likely(startp < endp));
 145:../../os/rt/src/chthreads.c **** }
 146:../../os/rt/src/chthreads.c **** #endif /* CH_DBG_FILL_THREADS */
 147:../../os/rt/src/chthreads.c **** 
 148:../../os/rt/src/chthreads.c **** /**
 149:../../os/rt/src/chthreads.c ****  * @brief   Creates a new thread into a static memory area.
 150:../../os/rt/src/chthreads.c ****  * @details The new thread is initialized but not inserted in the ready list,
 151:../../os/rt/src/chthreads.c ****  *          the initial state is @p CH_STATE_WTSTART.
 152:../../os/rt/src/chthreads.c ****  * @post    The created thread has a reference counter set to one, it is
 153:../../os/rt/src/chthreads.c ****  *          caller responsibility to call @p chThdRelease() or @p chthdWait()
 154:../../os/rt/src/chthreads.c ****  *          in order to release the reference. The thread persists in the
 155:../../os/rt/src/chthreads.c ****  *          registry until its reference counter reaches zero.
 156:../../os/rt/src/chthreads.c ****  * @post    The initialized thread can be subsequently started by invoking
 157:../../os/rt/src/chthreads.c ****  *          @p chThdStart(), @p chThdStartI() or @p chSchWakeupS()
 158:../../os/rt/src/chthreads.c ****  *          depending on the execution context.
 159:../../os/rt/src/chthreads.c ****  * @note    A thread can terminate by calling @p chThdExit() or by simply
 160:../../os/rt/src/chthreads.c ****  *          returning from its main function.
 161:../../os/rt/src/chthreads.c ****  * @note    Threads created using this function do not obey to the
 162:../../os/rt/src/chthreads.c ****  *          @p CH_DBG_FILL_THREADS debug option because it would keep
 163:../../os/rt/src/chthreads.c ****  *          the kernel locked for too much time.
 164:../../os/rt/src/chthreads.c ****  *
 165:../../os/rt/src/chthreads.c ****  * @param[out] tdp      pointer to the thread descriptor
 166:../../os/rt/src/chthreads.c ****  * @return              The pointer to the @p thread_t structure allocated for
 167:../../os/rt/src/chthreads.c ****  *                      the thread into the working space area.
 168:../../os/rt/src/chthreads.c ****  *
 169:../../os/rt/src/chthreads.c ****  * @iclass
 170:../../os/rt/src/chthreads.c ****  */
 171:../../os/rt/src/chthreads.c **** thread_t *chThdCreateSuspendedI(const thread_descriptor_t *tdp) {
 130               		.loc 1 171 0
 131               		.cfi_startproc
 132               	.LVL13:
 133 0000 CF93      		push r28
 134               	.LCFI2:
 135               		.cfi_def_cfa_offset 3
 136               		.cfi_offset 28, -2
 137 0002 DF93      		push r29
 138               	.LCFI3:
 139               		.cfi_def_cfa_offset 4
 140               		.cfi_offset 29, -3
 141               	/* prologue: function */
 142               	/* frame size = 0 */
 143               	/* stack size = 2 */
 144               	.L__stack_usage = 2
 145 0004 DC01      		movw r26,r24
 172:../../os/rt/src/chthreads.c ****   thread_t *tp;
 173:../../os/rt/src/chthreads.c **** 
 174:../../os/rt/src/chthreads.c ****   chDbgCheckClassI();
 175:../../os/rt/src/chthreads.c ****   chDbgCheck(tdp != NULL);
 176:../../os/rt/src/chthreads.c ****   chDbgCheck(MEM_IS_ALIGNED(tdp->wbase, PORT_WORKING_AREA_ALIGN) &&
 177:../../os/rt/src/chthreads.c ****              MEM_IS_ALIGNED(tdp->wend, PORT_STACK_ALIGN) &&
 178:../../os/rt/src/chthreads.c ****              (tdp->wend > tdp->wbase) &&
 179:../../os/rt/src/chthreads.c ****              (((size_t)tdp->wend - (size_t)tdp->wbase) >= THD_WORKING_AREA_SIZE(0)));
 180:../../os/rt/src/chthreads.c ****   chDbgCheck((tdp->prio <= HIGHPRIO) && (tdp->funcp != NULL));
 181:../../os/rt/src/chthreads.c **** 
 182:../../os/rt/src/chthreads.c ****   /* The thread structure is laid out in the upper part of the thread
 183:../../os/rt/src/chthreads.c ****      workspace. The thread position structure is aligned to the required
 184:../../os/rt/src/chthreads.c ****      stack alignment because it represents the stack top.*/
 185:../../os/rt/src/chthreads.c ****   tp = threadref(((uint8_t *)tdp->wend -
 146               		.loc 1 185 0
 147 0006 1496      		adiw r26,4
 148 0008 2D91      		ld r18,X+
 149 000a 3C91      		ld r19,X
 150 000c 1597      		sbiw r26,4+1
 151               	.LVL14:
 186:../../os/rt/src/chthreads.c ****                  MEM_ALIGN_NEXT(sizeof (thread_t), PORT_STACK_ALIGN)));
 187:../../os/rt/src/chthreads.c **** 
 188:../../os/rt/src/chthreads.c **** #if (CH_DBG_ENABLE_STACK_CHECK == TRUE) || (CH_CFG_USE_DYNAMIC == TRUE)
 189:../../os/rt/src/chthreads.c ****   /* Stack boundary.*/
 190:../../os/rt/src/chthreads.c ****   tp->wabase = tdp->wbase;
 191:../../os/rt/src/chthreads.c **** #endif
 192:../../os/rt/src/chthreads.c **** 
 193:../../os/rt/src/chthreads.c ****   /* Setting up the port-dependent part of the working area.*/
 194:../../os/rt/src/chthreads.c ****   PORT_SETUP_CONTEXT(tp, tdp->wbase, tp, tdp->funcp, tdp->arg);
 152               		.loc 1 194 0
 153 000e F901      		movw r30,r18
 154 0010 7E97      		sbiw r30,30
 155               	.LVL15:
 156 0012 E901      		movw r28,r18
 157 0014 E397      		sbiw r28,51
 158 0016 D683      		std Z+6,r29
 159 0018 C583      		std Z+5,r28
 160 001a 1796      		adiw r26,7
 161 001c 9C91      		ld r25,X
 162 001e 1797      		sbiw r26,7
 163 0020 1896      		adiw r26,8
 164 0022 8C91      		ld r24,X
 165 0024 1897      		sbiw r26,8
 166               	.LVL16:
 167 0026 9A8B      		std Y+18,r25
 168 0028 898B      		std Y+17,r24
 169 002a 1996      		adiw r26,9
 170 002c 9C91      		ld r25,X
 171 002e 1997      		sbiw r26,9
 172 0030 1A96      		adiw r26,10
 173 0032 8C91      		ld r24,X
 174 0034 1A97      		sbiw r26,10
 175 0036 988B      		std Y+16,r25
 176 0038 8F87      		std Y+15,r24
 177 003a 80E0      		ldi r24,lo8(gs(_port_thread_start))
 178 003c 90E0      		ldi r25,hi8(gs(_port_thread_start))
 179 003e 9B8B      		std Y+19,r25
 180 0040 8C8B      		std Y+20,r24
 195:../../os/rt/src/chthreads.c **** 
 196:../../os/rt/src/chthreads.c ****   /* The thread object is initialized but not started.*/
 197:../../os/rt/src/chthreads.c **** #if CH_CFG_SMP_MODE != FALSE
 198:../../os/rt/src/chthreads.c ****   if (tdp->instance != NULL) {
 199:../../os/rt/src/chthreads.c ****     return __thd_object_init(tdp->instance, tp, tdp->name, tdp->prio);
 200:../../os/rt/src/chthreads.c ****   }
 201:../../os/rt/src/chthreads.c **** #endif
 202:../../os/rt/src/chthreads.c **** 
 203:../../os/rt/src/chthreads.c ****   return __thd_object_init(currcore, tp, tdp->name, tdp->prio);
 181               		.loc 1 203 0
 182 0042 1696      		adiw r26,6
 183 0044 8C91      		ld r24,X
 184 0046 1697      		sbiw r26,6
 185 0048 4D91      		ld r20,X+
 186 004a 5C91      		ld r21,X
 187               	.LVL17:
 188               	.LBB226:
 189               	.LBB227:
  94:../../os/rt/src/chthreads.c ****   tp->state             = CH_STATE_WTSTART;
 190               		.loc 1 94 0
 191 004c 8483      		std Z+4,r24
  95:../../os/rt/src/chthreads.c ****   tp->flags             = CH_FLAG_MODE_STATIC;
 192               		.loc 1 95 0
 193 004e 92E0      		ldi r25,lo8(2)
 194 0050 9787      		std Z+15,r25
  96:../../os/rt/src/chthreads.c ****   tp->owner             = oip;
 195               		.loc 1 96 0
 196 0052 108A      		std Z+16,__zero_reg__
  97:../../os/rt/src/chthreads.c **** #if CH_CFG_TIME_QUANTUM > 0
 197               		.loc 1 97 0
 198 0054 60E0      		ldi r22,lo8(ch0)
 199 0056 70E0      		ldi r23,hi8(ch0)
 200 0058 7487      		std Z+12,r23
 201 005a 6387      		std Z+11,r22
 102:../../os/rt/src/chthreads.c ****   tp->mtxlist           = NULL;
 202               		.loc 1 102 0
 203 005c 858F      		std Z+29,r24
 103:../../os/rt/src/chthreads.c **** #endif
 204               		.loc 1 103 0
 205 005e 148E      		std Z+28,__zero_reg__
 206 0060 138E      		std Z+27,__zero_reg__
 106:../../os/rt/src/chthreads.c **** #endif
 207               		.loc 1 106 0
 208 0062 128E      		std Z+26,__zero_reg__
 112:../../os/rt/src/chthreads.c ****   tp->name              = name;
 209               		.loc 1 112 0
 210 0064 81E0      		ldi r24,lo8(1)
 211               	.LVL18:
 212 0066 818B      		std Z+17,r24
 113:../../os/rt/src/chthreads.c ****   REG_INSERT(oip, tp);
 213               		.loc 1 113 0
 214 0068 5687      		std Z+14,r21
 215 006a 4587      		std Z+13,r20
 114:../../os/rt/src/chthreads.c **** #else
 216               		.loc 1 114 0
 217 006c D901      		movw r26,r18
 218               	.LVL19:
 219 006e 5797      		sbiw r26,23
 220               	.LVL20:
 221               	.LBB228:
 222               	.LBB229:
 264:../../os/rt/include/chlists.h ****   p->prev       = qp->prev;
 223               		.loc 2 264 0
 224 0070 80E0      		ldi r24,lo8(ch0+23)
 225 0072 90E0      		ldi r25,hi8(ch0+23)
 226               	.LVL21:
 227 0074 1196      		adiw r26,1
 228 0076 9C93      		st X,r25
 229 0078 8E93      		st -X,r24
 265:../../os/rt/include/chlists.h ****   p->prev->next = p;
 230               		.loc 2 265 0
 231 007a EB01      		movw r28,r22
 232 007c 898D      		ldd r24,Y+25
 233 007e 9A8D      		ldd r25,Y+26
 234               	.LVL22:
 235 0080 1396      		adiw r26,2+1
 236 0082 9C93      		st X,r25
 237 0084 8E93      		st -X,r24
 238 0086 1297      		sbiw r26,2
 266:../../os/rt/include/chlists.h ****   qp->prev      = p;
 239               		.loc 2 266 0
 240 0088 EC01      		movw r28,r24
 241 008a B983      		std Y+1,r27
 242 008c A883      		st Y,r26
 243               	.LVL23:
 244               		.loc 2 267 0
 245 008e EB01      		movw r28,r22
 246 0090 BA8F      		std Y+26,r27
 247 0092 A98F      		std Y+25,r26
 248               	.LVL24:
 249               	.LBE229:
 250               	.LBE228:
 251               	.LBB230:
 252               	.LBB231:
 155:../../os/rt/include/chlists.h **** }
 253               		.loc 2 155 0
 254 0094 1D96      		adiw r26,13
 255 0096 0B2E      		mov __tmp_reg__,r27
 256 0098 1196      		adiw r26,1
 257 009a 0C92      		st X,__tmp_reg__
 258 009c 1197      		sbiw r26,1
 259 009e AC93      		st X,r26
 260               	.LBE231:
 261               	.LBE230:
 122:../../os/rt/src/chthreads.c **** #endif
 262               		.loc 1 122 0
 263 00a0 1296      		adiw r26,2
 264               	.LVL25:
 265               	.LBB232:
 266               	.LBB233:
 224:../../os/rt/include/chlists.h ****   qp->prev = qp;
 267               		.loc 2 224 0
 268 00a2 0B2E      		mov __tmp_reg__,r27
 269 00a4 1196      		adiw r26,1
 270 00a6 0C92      		st X,__tmp_reg__
 271 00a8 1197      		sbiw r26,1
 272 00aa AC93      		st X,r26
 225:../../os/rt/include/chlists.h **** }
 273               		.loc 2 225 0
 274 00ac 0A2E      		mov __tmp_reg__,r26
 275 00ae 1B2E      		mov __zero_reg__,r27
 276 00b0 1396      		adiw r26,2+1
 277 00b2 1C92      		st X,__zero_reg__
 278 00b4 0E92      		st -X,__tmp_reg__
 279 00b6 1124      		clr __zero_reg__
 280 00b8 1297      		sbiw r26,2
 281               	.LVL26:
 282               	.LBE233:
 283               	.LBE232:
 284               	.LBE227:
 285               	.LBE226:
 204:../../os/rt/src/chthreads.c **** }
 286               		.loc 1 204 0
 287 00ba CF01      		movw r24,r30
 288               	/* epilogue start */
 289 00bc DF91      		pop r29
 290 00be CF91      		pop r28
 291 00c0 0895      		ret
 292               		.cfi_endproc
 293               	.LFE191:
 295               		.section	.text.chThdCreateSuspended,"ax",@progbits
 296               	.global	chThdCreateSuspended
 298               	chThdCreateSuspended:
 299               	.LFB192:
 205:../../os/rt/src/chthreads.c **** 
 206:../../os/rt/src/chthreads.c **** /**
 207:../../os/rt/src/chthreads.c ****  * @brief   Creates a new thread into a static memory area.
 208:../../os/rt/src/chthreads.c ****  * @details The new thread is initialized but not inserted in the ready list,
 209:../../os/rt/src/chthreads.c ****  *          the initial state is @p CH_STATE_WTSTART.
 210:../../os/rt/src/chthreads.c ****  * @post    The created thread has a reference counter set to one, it is
 211:../../os/rt/src/chthreads.c ****  *          caller responsibility to call @p chThdRelease() or @p chthdWait()
 212:../../os/rt/src/chthreads.c ****  *          in order to release the reference. The thread persists in the
 213:../../os/rt/src/chthreads.c ****  *          registry until its reference counter reaches zero.
 214:../../os/rt/src/chthreads.c ****  * @post    The initialized thread can be subsequently started by invoking
 215:../../os/rt/src/chthreads.c ****  *          @p chThdStart(), @p chThdStartI() or @p chSchWakeupS()
 216:../../os/rt/src/chthreads.c ****  *          depending on the execution context.
 217:../../os/rt/src/chthreads.c ****  * @note    A thread can terminate by calling @p chThdExit() or by simply
 218:../../os/rt/src/chthreads.c ****  *          returning from its main function.
 219:../../os/rt/src/chthreads.c ****  *
 220:../../os/rt/src/chthreads.c ****  * @param[out] tdp      pointer to the thread descriptor
 221:../../os/rt/src/chthreads.c ****  * @return              The pointer to the @p thread_t structure allocated for
 222:../../os/rt/src/chthreads.c ****  *                      the thread into the working space area.
 223:../../os/rt/src/chthreads.c ****  *
 224:../../os/rt/src/chthreads.c ****  * @api
 225:../../os/rt/src/chthreads.c ****  */
 226:../../os/rt/src/chthreads.c **** thread_t *chThdCreateSuspended(const thread_descriptor_t *tdp) {
 300               		.loc 1 226 0
 301               		.cfi_startproc
 302               	.LVL27:
 303               	/* prologue: function */
 304               	/* frame size = 0 */
 305               	/* stack size = 0 */
 306               	.L__stack_usage = 0
 307               	.LBB234:
 308               	.LBB235:
 309               	.LBB236:
 310               		.file 3 "../../os/common/ports/AVR/chcore.h"
   1:../../os/common/ports/AVR/chcore.h **** /*
   2:../../os/common/ports/AVR/chcore.h ****     ChibiOS - Copyright (C) 2006,2007,2008,2009,2010,2011,2012,2013,2014,
   3:../../os/common/ports/AVR/chcore.h ****               2015,2016,2017,2018,2019,2020,2021 Giovanni Di Sirio.
   4:../../os/common/ports/AVR/chcore.h **** 
   5:../../os/common/ports/AVR/chcore.h ****     This file is part of ChibiOS.
   6:../../os/common/ports/AVR/chcore.h **** 
   7:../../os/common/ports/AVR/chcore.h ****     ChibiOS is free software; you can redistribute it and/or modify
   8:../../os/common/ports/AVR/chcore.h ****     it under the terms of the GNU General Public License as published by
   9:../../os/common/ports/AVR/chcore.h ****     the Free Software Foundation version 3 of the License.
  10:../../os/common/ports/AVR/chcore.h **** 
  11:../../os/common/ports/AVR/chcore.h ****     ChibiOS is distributed in the hope that it will be useful,
  12:../../os/common/ports/AVR/chcore.h ****     but WITHOUT ANY WARRANTY; without even the implied warranty of
  13:../../os/common/ports/AVR/chcore.h ****     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  14:../../os/common/ports/AVR/chcore.h ****     GNU General Public License for more details.
  15:../../os/common/ports/AVR/chcore.h **** 
  16:../../os/common/ports/AVR/chcore.h ****     You should have received a copy of the GNU General Public License
  17:../../os/common/ports/AVR/chcore.h ****     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  18:../../os/common/ports/AVR/chcore.h **** */
  19:../../os/common/ports/AVR/chcore.h **** 
  20:../../os/common/ports/AVR/chcore.h **** /**
  21:../../os/common/ports/AVR/chcore.h ****  * @file    chcore.h
  22:../../os/common/ports/AVR/chcore.h ****  * @brief   AVR port macros and structures.
  23:../../os/common/ports/AVR/chcore.h ****  *
  24:../../os/common/ports/AVR/chcore.h ****  * @addtogroup AVR_CORE
  25:../../os/common/ports/AVR/chcore.h ****  * @{
  26:../../os/common/ports/AVR/chcore.h ****  */
  27:../../os/common/ports/AVR/chcore.h **** 
  28:../../os/common/ports/AVR/chcore.h **** #ifndef CHCORE_H
  29:../../os/common/ports/AVR/chcore.h **** #define CHCORE_H
  30:../../os/common/ports/AVR/chcore.h **** 
  31:../../os/common/ports/AVR/chcore.h **** #include <avr/io.h>
  32:../../os/common/ports/AVR/chcore.h **** #include <avr/interrupt.h>
  33:../../os/common/ports/AVR/chcore.h **** 
  34:../../os/common/ports/AVR/chcore.h **** extern bool __avr_in_isr;
  35:../../os/common/ports/AVR/chcore.h **** 
  36:../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
  37:../../os/common/ports/AVR/chcore.h **** /* Module constants.                                                         */
  38:../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
  39:../../os/common/ports/AVR/chcore.h **** 
  40:../../os/common/ports/AVR/chcore.h **** /**
  41:../../os/common/ports/AVR/chcore.h ****  * @name    Port Capabilities and Constants
  42:../../os/common/ports/AVR/chcore.h ****  * @{
  43:../../os/common/ports/AVR/chcore.h ****  */
  44:../../os/common/ports/AVR/chcore.h **** /**
  45:../../os/common/ports/AVR/chcore.h ****  * @brief   This port supports a realtime counter.
  46:../../os/common/ports/AVR/chcore.h ****  */
  47:../../os/common/ports/AVR/chcore.h **** #define PORT_SUPPORTS_RT                FALSE
  48:../../os/common/ports/AVR/chcore.h **** 
  49:../../os/common/ports/AVR/chcore.h **** /**
  50:../../os/common/ports/AVR/chcore.h ****  * @brief   Natural alignment constant.
  51:../../os/common/ports/AVR/chcore.h ****  * @note    It is the minimum alignment for pointer-size variables.
  52:../../os/common/ports/AVR/chcore.h ****  */
  53:../../os/common/ports/AVR/chcore.h **** #define PORT_NATURAL_ALIGN              1U
  54:../../os/common/ports/AVR/chcore.h **** 
  55:../../os/common/ports/AVR/chcore.h **** /**
  56:../../os/common/ports/AVR/chcore.h ****  * @brief   Stack alignment constant.
  57:../../os/common/ports/AVR/chcore.h ****  * @note    It is the alignment required for the stack pointer.
  58:../../os/common/ports/AVR/chcore.h ****  */
  59:../../os/common/ports/AVR/chcore.h **** #define PORT_STACK_ALIGN                1U
  60:../../os/common/ports/AVR/chcore.h **** 
  61:../../os/common/ports/AVR/chcore.h **** /**
  62:../../os/common/ports/AVR/chcore.h ****  * @brief   Working Areas alignment constant.
  63:../../os/common/ports/AVR/chcore.h ****  * @note    It is the alignment to be enforced for thread working areas.
  64:../../os/common/ports/AVR/chcore.h ****  */
  65:../../os/common/ports/AVR/chcore.h **** #define PORT_WORKING_AREA_ALIGN         1U
  66:../../os/common/ports/AVR/chcore.h **** /** @} */
  67:../../os/common/ports/AVR/chcore.h **** 
  68:../../os/common/ports/AVR/chcore.h **** /**
  69:../../os/common/ports/AVR/chcore.h ****  * @name    Architecture and Compiler
  70:../../os/common/ports/AVR/chcore.h ****  * @{
  71:../../os/common/ports/AVR/chcore.h ****  */
  72:../../os/common/ports/AVR/chcore.h **** /**
  73:../../os/common/ports/AVR/chcore.h ****  * @brief   Macro defining an AVR architecture.
  74:../../os/common/ports/AVR/chcore.h ****  */
  75:../../os/common/ports/AVR/chcore.h **** #define PORT_ARCHITECTURE_AVR
  76:../../os/common/ports/AVR/chcore.h **** 
  77:../../os/common/ports/AVR/chcore.h **** /**
  78:../../os/common/ports/AVR/chcore.h ****  * @brief   Macro defining the specific AVR architecture.
  79:../../os/common/ports/AVR/chcore.h ****  */
  80:../../os/common/ports/AVR/chcore.h **** #define PORT_ARCHITECTURE_AVR_MEGAAVR
  81:../../os/common/ports/AVR/chcore.h **** 
  82:../../os/common/ports/AVR/chcore.h **** /**
  83:../../os/common/ports/AVR/chcore.h ****  * @brief   Name of the implemented architecture.
  84:../../os/common/ports/AVR/chcore.h ****  */
  85:../../os/common/ports/AVR/chcore.h **** #define PORT_ARCHITECTURE_NAME          "AVR"
  86:../../os/common/ports/AVR/chcore.h **** 
  87:../../os/common/ports/AVR/chcore.h **** /**
  88:../../os/common/ports/AVR/chcore.h ****  * @brief   Name of the architecture variant.
  89:../../os/common/ports/AVR/chcore.h ****  */
  90:../../os/common/ports/AVR/chcore.h **** #define PORT_CORE_VARIANT_NAME          "MegaAVR"
  91:../../os/common/ports/AVR/chcore.h **** 
  92:../../os/common/ports/AVR/chcore.h **** /**
  93:../../os/common/ports/AVR/chcore.h ****  * @brief   Compiler name and version.
  94:../../os/common/ports/AVR/chcore.h ****  */
  95:../../os/common/ports/AVR/chcore.h **** #if defined(__GNUC__) || defined(__DOXYGEN__)
  96:../../os/common/ports/AVR/chcore.h **** #define PORT_COMPILER_NAME              "GCC " __VERSION__
  97:../../os/common/ports/AVR/chcore.h **** 
  98:../../os/common/ports/AVR/chcore.h **** #else
  99:../../os/common/ports/AVR/chcore.h **** #error "unsupported compiler"
 100:../../os/common/ports/AVR/chcore.h **** #endif
 101:../../os/common/ports/AVR/chcore.h **** 
 102:../../os/common/ports/AVR/chcore.h **** /**
 103:../../os/common/ports/AVR/chcore.h ****  * @brief   Port-specific information string.
 104:../../os/common/ports/AVR/chcore.h ****  */
 105:../../os/common/ports/AVR/chcore.h **** #define PORT_INFO                       "None"
 106:../../os/common/ports/AVR/chcore.h **** /** @} */
 107:../../os/common/ports/AVR/chcore.h **** 
 108:../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 109:../../os/common/ports/AVR/chcore.h **** /* Module pre-compile time settings.                                         */
 110:../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 111:../../os/common/ports/AVR/chcore.h **** 
 112:../../os/common/ports/AVR/chcore.h **** /**
 113:../../os/common/ports/AVR/chcore.h ****  * @brief   Stack size for the system idle thread.
 114:../../os/common/ports/AVR/chcore.h ****  * @details This size depends on the idle thread implementation, usually
 115:../../os/common/ports/AVR/chcore.h ****  *          the idle thread should take no more space than those reserved
 116:../../os/common/ports/AVR/chcore.h ****  *          by @p PORT_INT_REQUIRED_STACK.
 117:../../os/common/ports/AVR/chcore.h ****  */
 118:../../os/common/ports/AVR/chcore.h **** #if !defined(PORT_IDLE_THREAD_STACK_SIZE) || defined(__DOXYGEN__)
 119:../../os/common/ports/AVR/chcore.h **** #define PORT_IDLE_THREAD_STACK_SIZE     8
 120:../../os/common/ports/AVR/chcore.h **** #endif
 121:../../os/common/ports/AVR/chcore.h **** 
 122:../../os/common/ports/AVR/chcore.h **** /**
 123:../../os/common/ports/AVR/chcore.h ****  * @brief   Per-thread stack overhead for interrupts servicing.
 124:../../os/common/ports/AVR/chcore.h ****  * @details This constant is used in the calculation of the correct working
 125:../../os/common/ports/AVR/chcore.h ****  *          area size.
 126:../../os/common/ports/AVR/chcore.h ****  */
 127:../../os/common/ports/AVR/chcore.h **** #if !defined(PORT_INT_REQUIRED_STACK) || defined(__DOXYGEN__)
 128:../../os/common/ports/AVR/chcore.h **** #define PORT_INT_REQUIRED_STACK         32
 129:../../os/common/ports/AVR/chcore.h **** #endif
 130:../../os/common/ports/AVR/chcore.h **** 
 131:../../os/common/ports/AVR/chcore.h **** /**
 132:../../os/common/ports/AVR/chcore.h ****  * @brief   Enables a "wait for interrupt" instruction in the idle loop.
 133:../../os/common/ports/AVR/chcore.h ****  */
 134:../../os/common/ports/AVR/chcore.h **** #if !defined(PORT_AVR_WFI_SLEEP_IDLE) || defined(__DOXYGEN__)
 135:../../os/common/ports/AVR/chcore.h **** #define PORT_AVR_WFI_SLEEP_IDLE      FALSE
 136:../../os/common/ports/AVR/chcore.h **** #endif
 137:../../os/common/ports/AVR/chcore.h **** 
 138:../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 139:../../os/common/ports/AVR/chcore.h **** /* Derived constants and error checks.                                       */
 140:../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 141:../../os/common/ports/AVR/chcore.h **** 
 142:../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 143:../../os/common/ports/AVR/chcore.h **** /* Module data structures and types.                                         */
 144:../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 145:../../os/common/ports/AVR/chcore.h **** 
 146:../../os/common/ports/AVR/chcore.h **** /* The following code is not processed when the file is included from an
 147:../../os/common/ports/AVR/chcore.h ****    asm module.*/
 148:../../os/common/ports/AVR/chcore.h **** #if !defined(_FROM_ASM_)
 149:../../os/common/ports/AVR/chcore.h **** 
 150:../../os/common/ports/AVR/chcore.h **** /**
 151:../../os/common/ports/AVR/chcore.h ****  * @brief   Type of stack and memory alignment enforcement.
 152:../../os/common/ports/AVR/chcore.h ****  * @note    In this architecture the stack alignment is enforced to 8 bits.
 153:../../os/common/ports/AVR/chcore.h ****  */
 154:../../os/common/ports/AVR/chcore.h **** typedef uint8_t stkalign_t;
 155:../../os/common/ports/AVR/chcore.h **** 
 156:../../os/common/ports/AVR/chcore.h **** /**
 157:../../os/common/ports/AVR/chcore.h ****  * @brief   Interrupt saved context.
 158:../../os/common/ports/AVR/chcore.h ****  * @details This structure represents the stack frame saved during a
 159:../../os/common/ports/AVR/chcore.h ****  *          preemption-capable interrupt handler.
 160:../../os/common/ports/AVR/chcore.h ****  * @note    R2 and R13 are not saved because those are assumed to be immutable
 161:../../os/common/ports/AVR/chcore.h ****  *          during the system life cycle.
 162:../../os/common/ports/AVR/chcore.h ****  */
 163:../../os/common/ports/AVR/chcore.h **** struct port_extctx {
 164:../../os/common/ports/AVR/chcore.h ****   uint8_t       _next;
 165:../../os/common/ports/AVR/chcore.h ****   uint8_t       r31;
 166:../../os/common/ports/AVR/chcore.h ****   uint8_t       r30;
 167:../../os/common/ports/AVR/chcore.h ****   uint8_t       r27;
 168:../../os/common/ports/AVR/chcore.h ****   uint8_t       r26;
 169:../../os/common/ports/AVR/chcore.h ****   uint8_t       r25;
 170:../../os/common/ports/AVR/chcore.h ****   uint8_t       r24;
 171:../../os/common/ports/AVR/chcore.h ****   uint8_t       r23;
 172:../../os/common/ports/AVR/chcore.h ****   uint8_t       r22;
 173:../../os/common/ports/AVR/chcore.h ****   uint8_t       r21;
 174:../../os/common/ports/AVR/chcore.h ****   uint8_t       r20;
 175:../../os/common/ports/AVR/chcore.h ****   uint8_t       r19;
 176:../../os/common/ports/AVR/chcore.h ****   uint8_t       r18;
 177:../../os/common/ports/AVR/chcore.h ****   uint8_t       sr;
 178:../../os/common/ports/AVR/chcore.h ****   uint8_t       r1;
 179:../../os/common/ports/AVR/chcore.h ****   uint8_t       r0;
 180:../../os/common/ports/AVR/chcore.h **** #if defined(__AVR_3_BYTE_PC__)
 181:../../os/common/ports/AVR/chcore.h ****   uint8_t       pcx;
 182:../../os/common/ports/AVR/chcore.h **** #endif
 183:../../os/common/ports/AVR/chcore.h ****   uint16_t      pc;
 184:../../os/common/ports/AVR/chcore.h **** };
 185:../../os/common/ports/AVR/chcore.h **** 
 186:../../os/common/ports/AVR/chcore.h **** /**
 187:../../os/common/ports/AVR/chcore.h ****  * @brief   System saved context.
 188:../../os/common/ports/AVR/chcore.h ****  * @details This structure represents the inner stack frame during a context
 189:../../os/common/ports/AVR/chcore.h ****  *          switching.
 190:../../os/common/ports/AVR/chcore.h ****  * @note    R2 and R13 are not saved because those are assumed to be immutable
 191:../../os/common/ports/AVR/chcore.h ****  *          during the system life cycle.
 192:../../os/common/ports/AVR/chcore.h ****  * @note    LR is stored in the caller context so it is not present in this
 193:../../os/common/ports/AVR/chcore.h ****  *          structure.
 194:../../os/common/ports/AVR/chcore.h ****  */
 195:../../os/common/ports/AVR/chcore.h **** struct port_intctx {
 196:../../os/common/ports/AVR/chcore.h ****   uint8_t       _next;
 197:../../os/common/ports/AVR/chcore.h ****   uint8_t       r29;
 198:../../os/common/ports/AVR/chcore.h ****   uint8_t       r28;
 199:../../os/common/ports/AVR/chcore.h ****   uint8_t       r17;
 200:../../os/common/ports/AVR/chcore.h ****   uint8_t       r16;
 201:../../os/common/ports/AVR/chcore.h ****   uint8_t       r15;
 202:../../os/common/ports/AVR/chcore.h ****   uint8_t       r14;
 203:../../os/common/ports/AVR/chcore.h ****   uint8_t       r13;
 204:../../os/common/ports/AVR/chcore.h ****   uint8_t       r12;
 205:../../os/common/ports/AVR/chcore.h ****   uint8_t       r11;
 206:../../os/common/ports/AVR/chcore.h ****   uint8_t       r10;
 207:../../os/common/ports/AVR/chcore.h ****   uint8_t       r9;
 208:../../os/common/ports/AVR/chcore.h ****   uint8_t       r8;
 209:../../os/common/ports/AVR/chcore.h ****   uint8_t       r7;
 210:../../os/common/ports/AVR/chcore.h ****   uint8_t       r6;
 211:../../os/common/ports/AVR/chcore.h ****   uint8_t       r5;
 212:../../os/common/ports/AVR/chcore.h ****   uint8_t       r4;
 213:../../os/common/ports/AVR/chcore.h ****   uint8_t       r3;
 214:../../os/common/ports/AVR/chcore.h ****   uint8_t       r2;
 215:../../os/common/ports/AVR/chcore.h **** #if defined(__AVR_3_BYTE_PC__)
 216:../../os/common/ports/AVR/chcore.h ****   uint8_t       pcx;
 217:../../os/common/ports/AVR/chcore.h **** #endif
 218:../../os/common/ports/AVR/chcore.h ****   uint8_t       pcl;
 219:../../os/common/ports/AVR/chcore.h ****   uint8_t       pch;
 220:../../os/common/ports/AVR/chcore.h **** };
 221:../../os/common/ports/AVR/chcore.h **** 
 222:../../os/common/ports/AVR/chcore.h **** /**
 223:../../os/common/ports/AVR/chcore.h ****  * @brief   Platform dependent part of the @p thread_t structure.
 224:../../os/common/ports/AVR/chcore.h ****  * @details This structure usually contains just the saved stack pointer
 225:../../os/common/ports/AVR/chcore.h ****  *          defined as a pointer to a @p port_intctx structure.
 226:../../os/common/ports/AVR/chcore.h ****  */
 227:../../os/common/ports/AVR/chcore.h **** struct port_context {
 228:../../os/common/ports/AVR/chcore.h ****   struct port_intctx *sp;
 229:../../os/common/ports/AVR/chcore.h **** };
 230:../../os/common/ports/AVR/chcore.h **** 
 231:../../os/common/ports/AVR/chcore.h **** #endif /* !defined(_FROM_ASM_) */
 232:../../os/common/ports/AVR/chcore.h **** 
 233:../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 234:../../os/common/ports/AVR/chcore.h **** /* Module macros.                                                            */
 235:../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 236:../../os/common/ports/AVR/chcore.h **** 
 237:../../os/common/ports/AVR/chcore.h **** /**
 238:../../os/common/ports/AVR/chcore.h ****  * @brief   Platform dependent part of the @p chThdCreateI() API.
 239:../../os/common/ports/AVR/chcore.h ****  * @details This code usually setup the context switching frame represented
 240:../../os/common/ports/AVR/chcore.h ****  *          by an @p port_intctx structure.
 241:../../os/common/ports/AVR/chcore.h ****  */
 242:../../os/common/ports/AVR/chcore.h **** #if defined(__AVR_3_BYTE_PC__) || defined(__DOXYGEN__)
 243:../../os/common/ports/AVR/chcore.h **** #define PORT_SETUP_CONTEXT(tp, wbase, wtop, pf, arg) {                      \
 244:../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp = (struct port_intctx *)((uint8_t *)(wtop) -                   \
 245:../../os/common/ports/AVR/chcore.h ****                                       sizeof(struct port_intctx));          \
 246:../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r2  = (uint8_t)(0xff & (uint16_t)pf);                         \
 247:../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r3  = (uint8_t)((uint16_t)(pf) >> 8);                         \
 248:../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r4  = (uint8_t)(0xff & (uint16_t)arg);                        \
 249:../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r5  = (uint8_t)((uint16_t)(arg) >> 8);                        \
 250:../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->pcx = (uint8_t)0;                                             \
 251:../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->pcl = (uint16_t)_port_thread_start >> 8;                      \
 252:../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->pch = (uint8_t)(0xff & (uint16_t)_port_thread_start);         \
 253:../../os/common/ports/AVR/chcore.h **** }
 254:../../os/common/ports/AVR/chcore.h **** #else /* !__AVR_3_BYTE_PC__ */
 255:../../os/common/ports/AVR/chcore.h **** #define PORT_SETUP_CONTEXT(tp, wbase, wtop, pf, arg) {                      \
 256:../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp = (struct port_intctx *)((uint8_t *)(wtop) -                   \
 257:../../os/common/ports/AVR/chcore.h ****                                       sizeof(struct port_intctx));          \
 258:../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r2  = (uint8_t)(0xff & (uint16_t)pf);                         \
 259:../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r3  = (uint8_t)((uint16_t)(pf) >> 8);                         \
 260:../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r4  = (uint8_t)(0xff & (uint16_t)arg);                        \
 261:../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->r5  = (uint8_t)((uint16_t)(arg) >> 8);                        \
 262:../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->pcl = (uint16_t)_port_thread_start >> 8;                      \
 263:../../os/common/ports/AVR/chcore.h ****   tp->ctx.sp->pch = (uint8_t)(0xff & (uint16_t)_port_thread_start);         \
 264:../../os/common/ports/AVR/chcore.h **** }
 265:../../os/common/ports/AVR/chcore.h **** #endif /* !__AVR_3_BYTE_PC__ */
 266:../../os/common/ports/AVR/chcore.h **** 
 267:../../os/common/ports/AVR/chcore.h **** /**
 268:../../os/common/ports/AVR/chcore.h ****  * @brief   Computes the thread working area global size.
 269:../../os/common/ports/AVR/chcore.h ****  * @note    There is no need to perform alignments in this macro.
 270:../../os/common/ports/AVR/chcore.h ****  */
 271:../../os/common/ports/AVR/chcore.h **** #define PORT_WA_SIZE(n) ((sizeof(struct port_intctx) - 1) +                \
 272:../../os/common/ports/AVR/chcore.h ****                          (sizeof(struct port_extctx) - 1) +                \
 273:../../os/common/ports/AVR/chcore.h ****                          ((size_t)(n)) + ((size_t)(PORT_INT_REQUIRED_STACK)))
 274:../../os/common/ports/AVR/chcore.h **** 
 275:../../os/common/ports/AVR/chcore.h **** /**
 276:../../os/common/ports/AVR/chcore.h ****  * @brief   Static working area allocation.
 277:../../os/common/ports/AVR/chcore.h ****  * @details This macro is used to allocate a static thread working area
 278:../../os/common/ports/AVR/chcore.h ****  *          aligned as both position and size.
 279:../../os/common/ports/AVR/chcore.h ****  *
 280:../../os/common/ports/AVR/chcore.h ****  * @param[in] s         the name to be assigned to the stack array
 281:../../os/common/ports/AVR/chcore.h ****  * @param[in] n         the stack size to be assigned to the thread
 282:../../os/common/ports/AVR/chcore.h ****  */
 283:../../os/common/ports/AVR/chcore.h **** #define PORT_WORKING_AREA(s, n)                                             \
 284:../../os/common/ports/AVR/chcore.h ****   stkalign_t s[THD_WORKING_AREA_SIZE(n) / sizeof (stkalign_t)]
 285:../../os/common/ports/AVR/chcore.h **** 
 286:../../os/common/ports/AVR/chcore.h **** /**
 287:../../os/common/ports/AVR/chcore.h ****  * @brief   Priority level verification macro.
 288:../../os/common/ports/AVR/chcore.h ****  */
 289:../../os/common/ports/AVR/chcore.h **** #define PORT_IRQ_IS_VALID_PRIORITY(n) false
 290:../../os/common/ports/AVR/chcore.h **** 
 291:../../os/common/ports/AVR/chcore.h **** /**
 292:../../os/common/ports/AVR/chcore.h ****  * @brief   Priority level verification macro.
 293:../../os/common/ports/AVR/chcore.h ****  */
 294:../../os/common/ports/AVR/chcore.h **** #define PORT_IRQ_IS_VALID_KERNEL_PRIORITY(n) false
 295:../../os/common/ports/AVR/chcore.h **** 
 296:../../os/common/ports/AVR/chcore.h **** /**
 297:../../os/common/ports/AVR/chcore.h ****  * @brief   IRQ prologue code.
 298:../../os/common/ports/AVR/chcore.h ****  * @details This macro must be inserted at the start of all IRQ handlers
 299:../../os/common/ports/AVR/chcore.h ****  *          enabled to invoke system APIs.
 300:../../os/common/ports/AVR/chcore.h ****  * @note    This code tricks the compiler to save all the specified registers
 301:../../os/common/ports/AVR/chcore.h ****  *          by "touching" them.
 302:../../os/common/ports/AVR/chcore.h ****  */
 303:../../os/common/ports/AVR/chcore.h **** #define PORT_IRQ_PROLOGUE() {                                               \
 304:../../os/common/ports/AVR/chcore.h ****   asm ("" : : : "r18", "r19", "r20", "r21", "r22", "r23", "r24",            \
 305:../../os/common/ports/AVR/chcore.h ****                 "r25", "r26", "r27", "r30", "r31");                         \
 306:../../os/common/ports/AVR/chcore.h ****   __avr_in_isr = true;                                                      \
 307:../../os/common/ports/AVR/chcore.h **** }
 308:../../os/common/ports/AVR/chcore.h **** 
 309:../../os/common/ports/AVR/chcore.h **** /**
 310:../../os/common/ports/AVR/chcore.h ****  * @brief   IRQ epilogue code.
 311:../../os/common/ports/AVR/chcore.h ****  * @details This macro must be inserted at the end of all IRQ handlers
 312:../../os/common/ports/AVR/chcore.h ****  *          enabled to invoke system APIs.
 313:../../os/common/ports/AVR/chcore.h ****  */
 314:../../os/common/ports/AVR/chcore.h **** #define PORT_IRQ_EPILOGUE() {                                               \
 315:../../os/common/ports/AVR/chcore.h ****   __avr_in_isr = false;                                                     \
 316:../../os/common/ports/AVR/chcore.h ****   __dbg_check_lock();                                                       \
 317:../../os/common/ports/AVR/chcore.h ****   if (chSchIsPreemptionRequired())                                          \
 318:../../os/common/ports/AVR/chcore.h ****     chSchDoPreemption();                                                    \
 319:../../os/common/ports/AVR/chcore.h ****   __dbg_check_unlock();                                                     \
 320:../../os/common/ports/AVR/chcore.h **** }
 321:../../os/common/ports/AVR/chcore.h **** 
 322:../../os/common/ports/AVR/chcore.h **** /**
 323:../../os/common/ports/AVR/chcore.h ****  * @brief   IRQ handler function declaration.
 324:../../os/common/ports/AVR/chcore.h ****  * @note    @p id can be a function name or a vector number depending on the
 325:../../os/common/ports/AVR/chcore.h ****  *          port implementation.
 326:../../os/common/ports/AVR/chcore.h ****  */
 327:../../os/common/ports/AVR/chcore.h **** #define PORT_IRQ_HANDLER(id) ISR(id)
 328:../../os/common/ports/AVR/chcore.h **** 
 329:../../os/common/ports/AVR/chcore.h **** /**
 330:../../os/common/ports/AVR/chcore.h ****  * @brief   Fast IRQ handler function declaration.
 331:../../os/common/ports/AVR/chcore.h ****  * @note    @p id can be a function name or a vector number depending on the
 332:../../os/common/ports/AVR/chcore.h ****  *          port implementation.
 333:../../os/common/ports/AVR/chcore.h ****  */
 334:../../os/common/ports/AVR/chcore.h **** #define PORT_FAST_IRQ_HANDLER(id) ISR(id)
 335:../../os/common/ports/AVR/chcore.h **** 
 336:../../os/common/ports/AVR/chcore.h **** /**
 337:../../os/common/ports/AVR/chcore.h ****  * @brief   Performs a context switch between two threads.
 338:../../os/common/ports/AVR/chcore.h ****  * @details This is the most critical code in any port, this function
 339:../../os/common/ports/AVR/chcore.h ****  *          is responsible for the context switch between 2 threads.
 340:../../os/common/ports/AVR/chcore.h ****  * @note    The implementation of this code affects <b>directly</b> the context
 341:../../os/common/ports/AVR/chcore.h ****  *          switch performance so optimize here as much as you can.
 342:../../os/common/ports/AVR/chcore.h ****  *
 343:../../os/common/ports/AVR/chcore.h ****  * @param[in] ntp       the thread to be switched in
 344:../../os/common/ports/AVR/chcore.h ****  * @param[in] otp       the thread to be switched out
 345:../../os/common/ports/AVR/chcore.h ****  */
 346:../../os/common/ports/AVR/chcore.h **** #define port_switch(ntp, otp) {                                             \
 347:../../os/common/ports/AVR/chcore.h ****   _port_switch(ntp, otp);                                                   \
 348:../../os/common/ports/AVR/chcore.h ****   asm volatile ("" : : : "memory");                                         \
 349:../../os/common/ports/AVR/chcore.h **** }
 350:../../os/common/ports/AVR/chcore.h **** 
 351:../../os/common/ports/AVR/chcore.h **** 
 352:../../os/common/ports/AVR/chcore.h **** /**
 353:../../os/common/ports/AVR/chcore.h ****  * @brief   Port-related initialization code.
 354:../../os/common/ports/AVR/chcore.h ****  * @note    This function is empty in this port.
 355:../../os/common/ports/AVR/chcore.h ****  */
 356:../../os/common/ports/AVR/chcore.h **** #define port_init(oip) {                                                    \
 357:../../os/common/ports/AVR/chcore.h ****   __avr_in_isr = true;                                                      \
 358:../../os/common/ports/AVR/chcore.h **** }
 359:../../os/common/ports/AVR/chcore.h **** 
 360:../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 361:../../os/common/ports/AVR/chcore.h **** /* External declarations.                                                    */
 362:../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 363:../../os/common/ports/AVR/chcore.h **** 
 364:../../os/common/ports/AVR/chcore.h **** /* The following code is not processed when the file is included from an
 365:../../os/common/ports/AVR/chcore.h ****    asm module.*/
 366:../../os/common/ports/AVR/chcore.h **** #if !defined(_FROM_ASM_)
 367:../../os/common/ports/AVR/chcore.h **** 
 368:../../os/common/ports/AVR/chcore.h **** #ifdef __cplusplus
 369:../../os/common/ports/AVR/chcore.h **** extern "C" {
 370:../../os/common/ports/AVR/chcore.h **** #endif
 371:../../os/common/ports/AVR/chcore.h ****   void _port_switch(thread_t *ntp, thread_t *otp);
 372:../../os/common/ports/AVR/chcore.h ****   void _port_thread_start(void);
 373:../../os/common/ports/AVR/chcore.h **** #ifdef __cplusplus
 374:../../os/common/ports/AVR/chcore.h **** }
 375:../../os/common/ports/AVR/chcore.h **** #endif
 376:../../os/common/ports/AVR/chcore.h **** 
 377:../../os/common/ports/AVR/chcore.h **** #endif /* !defined(_FROM_ASM_) */
 378:../../os/common/ports/AVR/chcore.h **** 
 379:../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 380:../../os/common/ports/AVR/chcore.h **** /* Module inline functions.                                                  */
 381:../../os/common/ports/AVR/chcore.h **** /*===========================================================================*/
 382:../../os/common/ports/AVR/chcore.h **** 
 383:../../os/common/ports/AVR/chcore.h **** /* The following code is not processed when the file is included from an
 384:../../os/common/ports/AVR/chcore.h ****    asm module.*/
 385:../../os/common/ports/AVR/chcore.h **** #if !defined(_FROM_ASM_)
 386:../../os/common/ports/AVR/chcore.h **** 
 387:../../os/common/ports/AVR/chcore.h **** /**
 388:../../os/common/ports/AVR/chcore.h ****  * @brief   Returns a word encoding the current interrupts status.
 389:../../os/common/ports/AVR/chcore.h ****  *
 390:../../os/common/ports/AVR/chcore.h ****  * @return              The interrupts status.
 391:../../os/common/ports/AVR/chcore.h ****  */
 392:../../os/common/ports/AVR/chcore.h **** static inline syssts_t port_get_irq_status(void) {
 393:../../os/common/ports/AVR/chcore.h **** 
 394:../../os/common/ports/AVR/chcore.h ****   return SREG;
 395:../../os/common/ports/AVR/chcore.h **** }
 396:../../os/common/ports/AVR/chcore.h **** 
 397:../../os/common/ports/AVR/chcore.h **** /**
 398:../../os/common/ports/AVR/chcore.h ****  * @brief   Checks the interrupt status.
 399:../../os/common/ports/AVR/chcore.h ****  *
 400:../../os/common/ports/AVR/chcore.h ****  * @param[in] sts       the interrupt status word
 401:../../os/common/ports/AVR/chcore.h ****  *
 402:../../os/common/ports/AVR/chcore.h ****  * @return              The interrupt status.
 403:../../os/common/ports/AVR/chcore.h ****  * @retval false        the word specified a disabled interrupts status.
 404:../../os/common/ports/AVR/chcore.h ****  * @retval true         the word specified an enabled interrupts status.
 405:../../os/common/ports/AVR/chcore.h ****  */
 406:../../os/common/ports/AVR/chcore.h **** static inline bool port_irq_enabled(syssts_t sts) {
 407:../../os/common/ports/AVR/chcore.h **** 
 408:../../os/common/ports/AVR/chcore.h ****   return (bool)((sts & 0x80) != 0);
 409:../../os/common/ports/AVR/chcore.h **** }
 410:../../os/common/ports/AVR/chcore.h **** 
 411:../../os/common/ports/AVR/chcore.h **** /**
 412:../../os/common/ports/AVR/chcore.h ****  * @brief   Determines the current execution context.
 413:../../os/common/ports/AVR/chcore.h ****  *
 414:../../os/common/ports/AVR/chcore.h ****  * @return              The execution context.
 415:../../os/common/ports/AVR/chcore.h ****  * @retval false        not running in ISR mode.
 416:../../os/common/ports/AVR/chcore.h ****  * @retval true         running in ISR mode.
 417:../../os/common/ports/AVR/chcore.h ****  */
 418:../../os/common/ports/AVR/chcore.h **** static inline bool port_is_isr_context(void) {
 419:../../os/common/ports/AVR/chcore.h **** 
 420:../../os/common/ports/AVR/chcore.h ****   return __avr_in_isr;
 421:../../os/common/ports/AVR/chcore.h **** }
 422:../../os/common/ports/AVR/chcore.h **** 
 423:../../os/common/ports/AVR/chcore.h **** /**
 424:../../os/common/ports/AVR/chcore.h ****  * @brief   Kernel-lock action.
 425:../../os/common/ports/AVR/chcore.h ****  * @details Usually this function just disables interrupts but may perform more
 426:../../os/common/ports/AVR/chcore.h ****  *          actions.
 427:../../os/common/ports/AVR/chcore.h ****  */
 428:../../os/common/ports/AVR/chcore.h **** static inline void port_lock(void) {
 429:../../os/common/ports/AVR/chcore.h **** 
 430:../../os/common/ports/AVR/chcore.h ****   asm volatile ("cli" : : : "memory");
 311               		.loc 3 430 0
 312               	/* #APP */
 313               	 ;  430 "../../os/common/ports/AVR/chcore.h" 1
 314 0000 F894      		cli
 315               	 ;  0 "" 2
 316               	/* #NOAPP */
 317               	.LBE236:
 318               	.LBE235:
 319               	.LBE234:
 227:../../os/rt/src/chthreads.c ****   thread_t *tp;
 228:../../os/rt/src/chthreads.c **** 
 229:../../os/rt/src/chthreads.c **** #if CH_CFG_USE_REGISTRY == TRUE
 230:../../os/rt/src/chthreads.c ****   chDbgAssert(chRegFindThreadByWorkingArea(tdp->wbase) == NULL,
 231:../../os/rt/src/chthreads.c ****               "working area in use");
 232:../../os/rt/src/chthreads.c **** #endif
 233:../../os/rt/src/chthreads.c **** 
 234:../../os/rt/src/chthreads.c **** #if CH_DBG_FILL_THREADS == TRUE
 235:../../os/rt/src/chthreads.c ****   __thd_stackfill((uint8_t *)tdp->wbase, (uint8_t *)tdp->wend);
 236:../../os/rt/src/chthreads.c **** #endif
 237:../../os/rt/src/chthreads.c **** 
 238:../../os/rt/src/chthreads.c ****   chSysLock();
 239:../../os/rt/src/chthreads.c ****   tp = chThdCreateSuspendedI(tdp);
 320               		.loc 1 239 0
 321 0002 0E94 0000 		call chThdCreateSuspendedI
 322               	.LVL28:
 323               	.LBB237:
 324               	.LBB238:
 325               	.LBB239:
 326               	.LBB240:
 431:../../os/common/ports/AVR/chcore.h **** }
 432:../../os/common/ports/AVR/chcore.h **** 
 433:../../os/common/ports/AVR/chcore.h **** /**
 434:../../os/common/ports/AVR/chcore.h ****  * @brief   Kernel-unlock action.
 435:../../os/common/ports/AVR/chcore.h ****  * @details Usually this function just enables interrupts but may perform more
 436:../../os/common/ports/AVR/chcore.h ****  *          actions.
 437:../../os/common/ports/AVR/chcore.h ****  */
 438:../../os/common/ports/AVR/chcore.h **** static inline void port_unlock(void) {
 439:../../os/common/ports/AVR/chcore.h **** 
 440:../../os/common/ports/AVR/chcore.h ****   asm volatile ("sei" : : : "memory");
 327               		.loc 3 440 0
 328               	/* #APP */
 329               	 ;  440 "../../os/common/ports/AVR/chcore.h" 1
 330 0006 7894      		sei
 331               	 ;  0 "" 2
 332               	/* epilogue start */
 333               	/* #NOAPP */
 334               	.LBE240:
 335               	.LBE239:
 336               	.LBE238:
 337               	.LBE237:
 240:../../os/rt/src/chthreads.c ****   chSysUnlock();
 241:../../os/rt/src/chthreads.c **** 
 242:../../os/rt/src/chthreads.c ****   return tp;
 243:../../os/rt/src/chthreads.c **** }
 338               		.loc 1 243 0
 339 0008 0895      		ret
 340               		.cfi_endproc
 341               	.LFE192:
 343               		.section	.text.chThdCreateI,"ax",@progbits
 344               	.global	chThdCreateI
 346               	chThdCreateI:
 347               	.LFB193:
 244:../../os/rt/src/chthreads.c **** 
 245:../../os/rt/src/chthreads.c **** /**
 246:../../os/rt/src/chthreads.c ****  * @brief   Creates a new thread into a static memory area.
 247:../../os/rt/src/chthreads.c ****  * @details The new thread is initialized and make ready to execute.
 248:../../os/rt/src/chthreads.c ****  * @post    The created thread has a reference counter set to one, it is
 249:../../os/rt/src/chthreads.c ****  *          caller responsibility to call @p chThdRelease() or @p chthdWait()
 250:../../os/rt/src/chthreads.c ****  *          in order to release the reference. The thread persists in the
 251:../../os/rt/src/chthreads.c ****  *          registry until its reference counter reaches zero.
 252:../../os/rt/src/chthreads.c ****  * @post    The initialized thread can be subsequently started by invoking
 253:../../os/rt/src/chthreads.c ****  *          @p chThdStart(), @p chThdStartI() or @p chSchWakeupS()
 254:../../os/rt/src/chthreads.c ****  *          depending on the execution context.
 255:../../os/rt/src/chthreads.c ****  * @note    A thread can terminate by calling @p chThdExit() or by simply
 256:../../os/rt/src/chthreads.c ****  *          returning from its main function.
 257:../../os/rt/src/chthreads.c ****  * @note    Threads created using this function do not obey to the
 258:../../os/rt/src/chthreads.c ****  *          @p CH_DBG_FILL_THREADS debug option because it would keep
 259:../../os/rt/src/chthreads.c ****  *          the kernel locked for too much time.
 260:../../os/rt/src/chthreads.c ****  *
 261:../../os/rt/src/chthreads.c ****  * @param[out] tdp      pointer to the thread descriptor
 262:../../os/rt/src/chthreads.c ****  * @return              The pointer to the @p thread_t structure allocated for
 263:../../os/rt/src/chthreads.c ****  *                      the thread into the working space area.
 264:../../os/rt/src/chthreads.c ****  *
 265:../../os/rt/src/chthreads.c ****  * @iclass
 266:../../os/rt/src/chthreads.c ****  */
 267:../../os/rt/src/chthreads.c **** thread_t *chThdCreateI(const thread_descriptor_t *tdp) {
 348               		.loc 1 267 0
 349               		.cfi_startproc
 350               	.LVL29:
 351               	/* prologue: function */
 352               	/* frame size = 0 */
 353               	/* stack size = 0 */
 354               	.L__stack_usage = 0
 268:../../os/rt/src/chthreads.c **** 
 269:../../os/rt/src/chthreads.c ****   return chSchReadyI(chThdCreateSuspendedI(tdp));
 355               		.loc 1 269 0
 356 0000 0E94 0000 		call chThdCreateSuspendedI
 357               	.LVL30:
 358 0004 0C94 0000 		jmp chSchReadyI
 359               	.LVL31:
 360               		.cfi_endproc
 361               	.LFE193:
 363               		.section	.text.chThdCreate,"ax",@progbits
 364               	.global	chThdCreate
 366               	chThdCreate:
 367               	.LFB194:
 270:../../os/rt/src/chthreads.c **** }
 271:../../os/rt/src/chthreads.c **** 
 272:../../os/rt/src/chthreads.c **** /**
 273:../../os/rt/src/chthreads.c ****  * @brief   Creates a new thread into a static memory area.
 274:../../os/rt/src/chthreads.c ****  * @details The new thread is initialized and make ready to execute.
 275:../../os/rt/src/chthreads.c ****  * @post    The created thread has a reference counter set to one, it is
 276:../../os/rt/src/chthreads.c ****  *          caller responsibility to call @p chThdRelease() or @p chthdWait()
 277:../../os/rt/src/chthreads.c ****  *          in order to release the reference. The thread persists in the
 278:../../os/rt/src/chthreads.c ****  *          registry until its reference counter reaches zero.
 279:../../os/rt/src/chthreads.c ****  * @note    A thread can terminate by calling @p chThdExit() or by simply
 280:../../os/rt/src/chthreads.c ****  *          returning from its main function.
 281:../../os/rt/src/chthreads.c ****  *
 282:../../os/rt/src/chthreads.c ****  * @param[out] tdp      pointer to the thread descriptor
 283:../../os/rt/src/chthreads.c ****  * @return              The pointer to the @p thread_t structure allocated for
 284:../../os/rt/src/chthreads.c ****  *                      the thread into the working space area.
 285:../../os/rt/src/chthreads.c ****  *
 286:../../os/rt/src/chthreads.c ****  * @iclass
 287:../../os/rt/src/chthreads.c ****  */
 288:../../os/rt/src/chthreads.c **** thread_t *chThdCreate(const thread_descriptor_t *tdp) {
 368               		.loc 1 288 0
 369               		.cfi_startproc
 370               	.LVL32:
 371 0000 CF93      		push r28
 372               	.LCFI4:
 373               		.cfi_def_cfa_offset 3
 374               		.cfi_offset 28, -2
 375 0002 DF93      		push r29
 376               	.LCFI5:
 377               		.cfi_def_cfa_offset 4
 378               		.cfi_offset 29, -3
 379               	/* prologue: function */
 380               	/* frame size = 0 */
 381               	/* stack size = 2 */
 382               	.L__stack_usage = 2
 383               	.LBB241:
 384               	.LBB242:
 385               	.LBB243:
 430:../../os/common/ports/AVR/chcore.h **** }
 386               		.loc 3 430 0
 387               	/* #APP */
 388               	 ;  430 "../../os/common/ports/AVR/chcore.h" 1
 389 0004 F894      		cli
 390               	 ;  0 "" 2
 391               	/* #NOAPP */
 392               	.LBE243:
 393               	.LBE242:
 394               	.LBE241:
 289:../../os/rt/src/chthreads.c ****   thread_t *tp;
 290:../../os/rt/src/chthreads.c **** 
 291:../../os/rt/src/chthreads.c **** #if (CH_CFG_USE_REGISTRY == TRUE) &&                                        \
 292:../../os/rt/src/chthreads.c ****     ((CH_DBG_ENABLE_STACK_CHECK == TRUE) || (CH_CFG_USE_DYNAMIC == TRUE))
 293:../../os/rt/src/chthreads.c ****   chDbgAssert(chRegFindThreadByWorkingArea(tdp->wbase) == NULL,
 294:../../os/rt/src/chthreads.c ****               "working area in use");
 295:../../os/rt/src/chthreads.c **** #endif
 296:../../os/rt/src/chthreads.c **** 
 297:../../os/rt/src/chthreads.c **** #if CH_DBG_FILL_THREADS == TRUE
 298:../../os/rt/src/chthreads.c ****   __thd_stackfill((uint8_t *)tdp->wbase, (uint8_t *)tdp->wend);
 299:../../os/rt/src/chthreads.c **** #endif
 300:../../os/rt/src/chthreads.c **** 
 301:../../os/rt/src/chthreads.c ****   chSysLock();
 302:../../os/rt/src/chthreads.c ****   tp = chThdCreateSuspendedI(tdp);
 395               		.loc 1 302 0
 396 0006 0E94 0000 		call chThdCreateSuspendedI
 397               	.LVL33:
 398 000a EC01      		movw r28,r24
 399               	.LVL34:
 303:../../os/rt/src/chthreads.c ****   chSchWakeupS(tp, MSG_OK);
 400               		.loc 1 303 0
 401 000c 70E0      		ldi r23,0
 402 000e 60E0      		ldi r22,0
 403 0010 0E94 0000 		call chSchWakeupS
 404               	.LVL35:
 405               	.LBB244:
 406               	.LBB245:
 407               	.LBB246:
 408               	.LBB247:
 409               		.loc 3 440 0
 410               	/* #APP */
 411               	 ;  440 "../../os/common/ports/AVR/chcore.h" 1
 412 0014 7894      		sei
 413               	 ;  0 "" 2
 414               	/* #NOAPP */
 415               	.LBE247:
 416               	.LBE246:
 417               	.LBE245:
 418               	.LBE244:
 304:../../os/rt/src/chthreads.c ****   chSysUnlock();
 305:../../os/rt/src/chthreads.c **** 
 306:../../os/rt/src/chthreads.c ****   return tp;
 307:../../os/rt/src/chthreads.c **** }
 419               		.loc 1 307 0
 420 0016 CE01      		movw r24,r28
 421               	/* epilogue start */
 422 0018 DF91      		pop r29
 423 001a CF91      		pop r28
 424               	.LVL36:
 425 001c 0895      		ret
 426               		.cfi_endproc
 427               	.LFE194:
 429               		.section	.rodata.chThdCreateStatic.str1.1,"aMS",@progbits,1
 430               	.LC0:
 431 0000 6E6F 6E61 		.string	"noname"
 431      6D65 00
 432               		.section	.text.chThdCreateStatic,"ax",@progbits
 433               	.global	chThdCreateStatic
 435               	chThdCreateStatic:
 436               	.LFB195:
 308:../../os/rt/src/chthreads.c **** 
 309:../../os/rt/src/chthreads.c **** /**
 310:../../os/rt/src/chthreads.c ****  * @brief   Creates a new thread into a static memory area.
 311:../../os/rt/src/chthreads.c ****  * @post    The created thread has a reference counter set to one, it is
 312:../../os/rt/src/chthreads.c ****  *          caller responsibility to call @p chThdRelease() or @p chthdWait()
 313:../../os/rt/src/chthreads.c ****  *          in order to release the reference. The thread persists in the
 314:../../os/rt/src/chthreads.c ****  *          registry until its reference counter reaches zero.
 315:../../os/rt/src/chthreads.c ****  * @note    A thread can terminate by calling @p chThdExit() or by simply
 316:../../os/rt/src/chthreads.c ****  *          returning from its main function.
 317:../../os/rt/src/chthreads.c ****  *
 318:../../os/rt/src/chthreads.c ****  * @param[out] wsp      pointer to a working area dedicated to the thread stack
 319:../../os/rt/src/chthreads.c ****  * @param[in] size      size of the working area
 320:../../os/rt/src/chthreads.c ****  * @param[in] prio      the priority level for the new thread
 321:../../os/rt/src/chthreads.c ****  * @param[in] pf        the thread function
 322:../../os/rt/src/chthreads.c ****  * @param[in] arg       an argument passed to the thread function. It can be
 323:../../os/rt/src/chthreads.c ****  *                      @p NULL.
 324:../../os/rt/src/chthreads.c ****  * @return              The pointer to the @p thread_t structure allocated for
 325:../../os/rt/src/chthreads.c ****  *                      the thread into the working space area.
 326:../../os/rt/src/chthreads.c ****  *
 327:../../os/rt/src/chthreads.c ****  * @api
 328:../../os/rt/src/chthreads.c ****  */
 329:../../os/rt/src/chthreads.c **** thread_t *chThdCreateStatic(void *wsp, size_t size,
 330:../../os/rt/src/chthreads.c ****                             tprio_t prio, tfunc_t pf, void *arg) {
 437               		.loc 1 330 0
 438               		.cfi_startproc
 439               	.LVL37:
 440 0000 0F93      		push r16
 441               	.LCFI6:
 442               		.cfi_def_cfa_offset 3
 443               		.cfi_offset 16, -2
 444 0002 1F93      		push r17
 445               	.LCFI7:
 446               		.cfi_def_cfa_offset 4
 447               		.cfi_offset 17, -3
 448 0004 CF93      		push r28
 449               	.LCFI8:
 450               		.cfi_def_cfa_offset 5
 451               		.cfi_offset 28, -4
 452 0006 DF93      		push r29
 453               	.LCFI9:
 454               		.cfi_def_cfa_offset 6
 455               		.cfi_offset 29, -5
 456               	/* prologue: function */
 457               	/* frame size = 0 */
 458               	/* stack size = 4 */
 459               	.L__stack_usage = 4
 460               	.LBB248:
 461               	.LBB249:
 462               	.LBB250:
 430:../../os/common/ports/AVR/chcore.h **** }
 463               		.loc 3 430 0
 464               	/* #APP */
 465               	 ;  430 "../../os/common/ports/AVR/chcore.h" 1
 466 0008 F894      		cli
 467               	 ;  0 "" 2
 468               	/* #NOAPP */
 469               	.LBE250:
 470               	.LBE249:
 471               	.LBE248:
 331:../../os/rt/src/chthreads.c ****   thread_t *tp;
 332:../../os/rt/src/chthreads.c **** 
 333:../../os/rt/src/chthreads.c ****   chDbgCheck((wsp != NULL) &&
 334:../../os/rt/src/chthreads.c ****              MEM_IS_ALIGNED(wsp, PORT_WORKING_AREA_ALIGN) &&
 335:../../os/rt/src/chthreads.c ****              (size >= THD_WORKING_AREA_SIZE(0)) &&
 336:../../os/rt/src/chthreads.c ****              MEM_IS_ALIGNED(size, PORT_STACK_ALIGN) &&
 337:../../os/rt/src/chthreads.c ****              (prio <= HIGHPRIO) && (pf != NULL));
 338:../../os/rt/src/chthreads.c **** 
 339:../../os/rt/src/chthreads.c **** #if (CH_CFG_USE_REGISTRY == TRUE) &&                                        \
 340:../../os/rt/src/chthreads.c ****     ((CH_DBG_ENABLE_STACK_CHECK == TRUE) || (CH_CFG_USE_DYNAMIC == TRUE))
 341:../../os/rt/src/chthreads.c ****   chDbgAssert(chRegFindThreadByWorkingArea(wsp) == NULL,
 342:../../os/rt/src/chthreads.c ****               "working area in use");
 343:../../os/rt/src/chthreads.c **** #endif
 344:../../os/rt/src/chthreads.c **** 
 345:../../os/rt/src/chthreads.c **** #if CH_DBG_FILL_THREADS == TRUE
 346:../../os/rt/src/chthreads.c ****   __thd_stackfill((uint8_t *)wsp, (uint8_t *)wsp + size);
 347:../../os/rt/src/chthreads.c **** #endif
 348:../../os/rt/src/chthreads.c **** 
 349:../../os/rt/src/chthreads.c ****   chSysLock();
 350:../../os/rt/src/chthreads.c **** 
 351:../../os/rt/src/chthreads.c ****   /* The thread structure is laid out in the upper part of the thread
 352:../../os/rt/src/chthreads.c ****      workspace. The thread position structure is aligned to the required
 353:../../os/rt/src/chthreads.c ****      stack alignment because it represents the stack top.*/
 354:../../os/rt/src/chthreads.c ****   tp = threadref(((uint8_t *)wsp + size -
 472               		.loc 1 354 0
 473 000a 6E51      		subi r22,30
 474 000c 7109      		sbc r23,__zero_reg__
 475               	.LVL38:
 476 000e EC01      		movw r28,r24
 477 0010 C60F      		add r28,r22
 478 0012 D71F      		adc r29,r23
 479               	.LVL39:
 355:../../os/rt/src/chthreads.c ****                  MEM_ALIGN_NEXT(sizeof (thread_t), PORT_STACK_ALIGN)));
 356:../../os/rt/src/chthreads.c **** 
 357:../../os/rt/src/chthreads.c **** #if (CH_DBG_ENABLE_STACK_CHECK == TRUE) || (CH_CFG_USE_DYNAMIC == TRUE)
 358:../../os/rt/src/chthreads.c ****   /* Stack boundary.*/
 359:../../os/rt/src/chthreads.c ****   tp->wabase = (stkalign_t *)wsp;
 360:../../os/rt/src/chthreads.c **** #endif
 361:../../os/rt/src/chthreads.c **** 
 362:../../os/rt/src/chthreads.c ****   /* Setting up the port-dependent part of the working area.*/
 363:../../os/rt/src/chthreads.c ****   PORT_SETUP_CONTEXT(tp, wsp, tp, pf, arg);
 480               		.loc 1 363 0
 481 0014 FE01      		movw r30,r28
 482 0016 7597      		sbiw r30,21
 483 0018 FE83      		std Y+6,r31
 484 001a ED83      		std Y+5,r30
 485 001c 228B      		std Z+18,r18
 486 001e 318B      		std Z+17,r19
 487 0020 008B      		std Z+16,r16
 488 0022 1787      		std Z+15,r17
 489 0024 80E0      		ldi r24,lo8(gs(_port_thread_start))
 490 0026 90E0      		ldi r25,hi8(gs(_port_thread_start))
 491               	.LVL40:
 492 0028 938B      		std Z+19,r25
 493 002a 848B      		std Z+20,r24
 494               	.LVL41:
 495               	.LBB251:
 496               	.LBB252:
  94:../../os/rt/src/chthreads.c ****   tp->state             = CH_STATE_WTSTART;
 497               		.loc 1 94 0
 498 002c 4C83      		std Y+4,r20
  95:../../os/rt/src/chthreads.c ****   tp->flags             = CH_FLAG_MODE_STATIC;
 499               		.loc 1 95 0
 500 002e 82E0      		ldi r24,lo8(2)
 501 0030 8F87      		std Y+15,r24
  96:../../os/rt/src/chthreads.c ****   tp->owner             = oip;
 502               		.loc 1 96 0
 503 0032 188A      		std Y+16,__zero_reg__
  97:../../os/rt/src/chthreads.c **** #if CH_CFG_TIME_QUANTUM > 0
 504               		.loc 1 97 0
 505 0034 E0E0      		ldi r30,lo8(ch0)
 506 0036 F0E0      		ldi r31,hi8(ch0)
 507 0038 FC87      		std Y+12,r31
 508 003a EB87      		std Y+11,r30
 102:../../os/rt/src/chthreads.c ****   tp->mtxlist           = NULL;
 509               		.loc 1 102 0
 510 003c 4D8F      		std Y+29,r20
 103:../../os/rt/src/chthreads.c **** #endif
 511               		.loc 1 103 0
 512 003e 1C8E      		std Y+28,__zero_reg__
 513 0040 1B8E      		std Y+27,__zero_reg__
 106:../../os/rt/src/chthreads.c **** #endif
 514               		.loc 1 106 0
 515 0042 1A8E      		std Y+26,__zero_reg__
 112:../../os/rt/src/chthreads.c ****   tp->name              = name;
 516               		.loc 1 112 0
 517 0044 81E0      		ldi r24,lo8(1)
 518 0046 898B      		std Y+17,r24
 113:../../os/rt/src/chthreads.c ****   REG_INSERT(oip, tp);
 519               		.loc 1 113 0
 520 0048 80E0      		ldi r24,lo8(.LC0)
 521 004a 90E0      		ldi r25,hi8(.LC0)
 522 004c 9E87      		std Y+14,r25
 523 004e 8D87      		std Y+13,r24
 114:../../os/rt/src/chthreads.c **** #else
 524               		.loc 1 114 0
 525 0050 CE01      		movw r24,r28
 526 0052 0796      		adiw r24,7
 527               	.LVL42:
 528               	.LBB253:
 529               	.LBB254:
 264:../../os/rt/include/chlists.h ****   p->prev       = qp->prev;
 530               		.loc 2 264 0
 531 0054 20E0      		ldi r18,lo8(ch0+23)
 532 0056 30E0      		ldi r19,hi8(ch0+23)
 533               	.LVL43:
 534 0058 3887      		std Y+8,r19
 535 005a 2F83      		std Y+7,r18
 265:../../os/rt/include/chlists.h ****   p->prev->next = p;
 536               		.loc 2 265 0
 537 005c A18D      		ldd r26,Z+25
 538 005e B28D      		ldd r27,Z+26
 539 0060 BA87      		std Y+10,r27
 540 0062 A987      		std Y+9,r26
 266:../../os/rt/include/chlists.h ****   qp->prev      = p;
 541               		.loc 2 266 0
 542 0064 8D93      		st X+,r24
 543 0066 9C93      		st X,r25
 544               		.loc 2 267 0
 545 0068 928F      		std Z+26,r25
 546 006a 818F      		std Z+25,r24
 547               	.LVL44:
 548               	.LBE254:
 549               	.LBE253:
 119:../../os/rt/src/chthreads.c **** #endif
 550               		.loc 1 119 0
 551 006c 0D96      		adiw r24,13
 552               	.LBB255:
 553               	.LBB256:
 155:../../os/rt/include/chlists.h **** }
 554               		.loc 2 155 0
 555 006e 9D8B      		std Y+21,r25
 556 0070 8C8B      		std Y+20,r24
 557               	.LVL45:
 558               	.LBE256:
 559               	.LBE255:
 122:../../os/rt/src/chthreads.c **** #endif
 560               		.loc 1 122 0
 561 0072 0296      		adiw r24,2
 562               	.LVL46:
 563               	.LBB257:
 564               	.LBB258:
 224:../../os/rt/include/chlists.h ****   qp->prev = qp;
 565               		.loc 2 224 0
 566 0074 9F8B      		std Y+23,r25
 567 0076 8E8B      		std Y+22,r24
 225:../../os/rt/include/chlists.h **** }
 568               		.loc 2 225 0
 569 0078 998F      		std Y+25,r25
 570 007a 888F      		std Y+24,r24
 571               	.LVL47:
 572               	.LBE258:
 573               	.LBE257:
 574               	.LBE252:
 575               	.LBE251:
 364:../../os/rt/src/chthreads.c **** 
 365:../../os/rt/src/chthreads.c ****   tp = __thd_object_init(currcore, tp, "noname", prio);
 366:../../os/rt/src/chthreads.c **** 
 367:../../os/rt/src/chthreads.c ****   /* Starting the thread immediately.*/
 368:../../os/rt/src/chthreads.c ****   chSchWakeupS(tp, MSG_OK);
 576               		.loc 1 368 0
 577 007c 70E0      		ldi r23,0
 578 007e 60E0      		ldi r22,0
 579               	.LVL48:
 580 0080 CE01      		movw r24,r28
 581 0082 0E94 0000 		call chSchWakeupS
 582               	.LVL49:
 583               	.LBB259:
 584               	.LBB260:
 585               	.LBB261:
 586               	.LBB262:
 587               		.loc 3 440 0
 588               	/* #APP */
 589               	 ;  440 "../../os/common/ports/AVR/chcore.h" 1
 590 0086 7894      		sei
 591               	 ;  0 "" 2
 592               	/* #NOAPP */
 593               	.LBE262:
 594               	.LBE261:
 595               	.LBE260:
 596               	.LBE259:
 369:../../os/rt/src/chthreads.c ****   chSysUnlock();
 370:../../os/rt/src/chthreads.c **** 
 371:../../os/rt/src/chthreads.c ****   return tp;
 372:../../os/rt/src/chthreads.c **** }
 597               		.loc 1 372 0
 598 0088 CE01      		movw r24,r28
 599               	/* epilogue start */
 600 008a DF91      		pop r29
 601 008c CF91      		pop r28
 602 008e 1F91      		pop r17
 603 0090 0F91      		pop r16
 604               	.LVL50:
 605 0092 0895      		ret
 606               		.cfi_endproc
 607               	.LFE195:
 609               		.section	.text.chThdStart,"ax",@progbits
 610               	.global	chThdStart
 612               	chThdStart:
 613               	.LFB196:
 373:../../os/rt/src/chthreads.c **** 
 374:../../os/rt/src/chthreads.c **** /**
 375:../../os/rt/src/chthreads.c ****  * @brief   Resumes a thread created with @p chThdCreateI().
 376:../../os/rt/src/chthreads.c ****  *
 377:../../os/rt/src/chthreads.c ****  * @param[in] tp        pointer to the thread
 378:../../os/rt/src/chthreads.c ****  * @return              The pointer to the @p thread_t structure allocated for
 379:../../os/rt/src/chthreads.c ****  *                      the thread into the working space area.
 380:../../os/rt/src/chthreads.c ****  *
 381:../../os/rt/src/chthreads.c ****  * @api
 382:../../os/rt/src/chthreads.c ****  */
 383:../../os/rt/src/chthreads.c **** thread_t *chThdStart(thread_t *tp) {
 614               		.loc 1 383 0
 615               		.cfi_startproc
 616               	.LVL51:
 617 0000 CF93      		push r28
 618               	.LCFI10:
 619               		.cfi_def_cfa_offset 3
 620               		.cfi_offset 28, -2
 621 0002 DF93      		push r29
 622               	.LCFI11:
 623               		.cfi_def_cfa_offset 4
 624               		.cfi_offset 29, -3
 625               	/* prologue: function */
 626               	/* frame size = 0 */
 627               	/* stack size = 2 */
 628               	.L__stack_usage = 2
 629 0004 EC01      		movw r28,r24
 630               	.LBB263:
 631               	.LBB264:
 632               	.LBB265:
 430:../../os/common/ports/AVR/chcore.h **** }
 633               		.loc 3 430 0
 634               	/* #APP */
 635               	 ;  430 "../../os/common/ports/AVR/chcore.h" 1
 636 0006 F894      		cli
 637               	 ;  0 "" 2
 638               	/* #NOAPP */
 639               	.LBE265:
 640               	.LBE264:
 641               	.LBE263:
 384:../../os/rt/src/chthreads.c **** 
 385:../../os/rt/src/chthreads.c ****   chSysLock();
 386:../../os/rt/src/chthreads.c ****   chDbgAssert(tp->state == CH_STATE_WTSTART, "wrong state");
 387:../../os/rt/src/chthreads.c ****   chSchWakeupS(tp, MSG_OK);
 642               		.loc 1 387 0
 643 0008 70E0      		ldi r23,0
 644 000a 60E0      		ldi r22,0
 645 000c 0E94 0000 		call chSchWakeupS
 646               	.LVL52:
 647               	.LBB266:
 648               	.LBB267:
 649               	.LBB268:
 650               	.LBB269:
 651               		.loc 3 440 0
 652               	/* #APP */
 653               	 ;  440 "../../os/common/ports/AVR/chcore.h" 1
 654 0010 7894      		sei
 655               	 ;  0 "" 2
 656               	/* #NOAPP */
 657               	.LBE269:
 658               	.LBE268:
 659               	.LBE267:
 660               	.LBE266:
 388:../../os/rt/src/chthreads.c ****   chSysUnlock();
 389:../../os/rt/src/chthreads.c **** 
 390:../../os/rt/src/chthreads.c ****   return tp;
 391:../../os/rt/src/chthreads.c **** }
 661               		.loc 1 391 0
 662 0012 CE01      		movw r24,r28
 663               	/* epilogue start */
 664 0014 DF91      		pop r29
 665 0016 CF91      		pop r28
 666               	.LVL53:
 667 0018 0895      		ret
 668               		.cfi_endproc
 669               	.LFE196:
 671               		.section	.text.chThdAddRef,"ax",@progbits
 672               	.global	chThdAddRef
 674               	chThdAddRef:
 675               	.LFB197:
 392:../../os/rt/src/chthreads.c **** 
 393:../../os/rt/src/chthreads.c **** #if (CH_CFG_USE_REGISTRY == TRUE) || defined(__DOXYGEN__)
 394:../../os/rt/src/chthreads.c **** /**
 395:../../os/rt/src/chthreads.c ****  * @brief   Adds a reference to a thread object.
 396:../../os/rt/src/chthreads.c ****  * @pre     The configuration option @p CH_CFG_USE_REGISTRY must be enabled in
 397:../../os/rt/src/chthreads.c ****  *          order to use this function.
 398:../../os/rt/src/chthreads.c ****  *
 399:../../os/rt/src/chthreads.c ****  * @param[in] tp        pointer to the thread
 400:../../os/rt/src/chthreads.c ****  * @return              The same thread pointer passed as parameter
 401:../../os/rt/src/chthreads.c ****  *                      representing the new reference.
 402:../../os/rt/src/chthreads.c ****  *
 403:../../os/rt/src/chthreads.c ****  * @api
 404:../../os/rt/src/chthreads.c ****  */
 405:../../os/rt/src/chthreads.c **** thread_t *chThdAddRef(thread_t *tp) {
 676               		.loc 1 405 0
 677               		.cfi_startproc
 678               	.LVL54:
 679               	/* prologue: function */
 680               	/* frame size = 0 */
 681               	/* stack size = 0 */
 682               	.L__stack_usage = 0
 683               	.LBB270:
 684               	.LBB271:
 685               	.LBB272:
 430:../../os/common/ports/AVR/chcore.h **** }
 686               		.loc 3 430 0
 687               	/* #APP */
 688               	 ;  430 "../../os/common/ports/AVR/chcore.h" 1
 689 0000 F894      		cli
 690               	 ;  0 "" 2
 691               	/* #NOAPP */
 692               	.LBE272:
 693               	.LBE271:
 694               	.LBE270:
 406:../../os/rt/src/chthreads.c **** 
 407:../../os/rt/src/chthreads.c ****   chSysLock();
 408:../../os/rt/src/chthreads.c ****   chDbgAssert(tp->refs < (trefs_t)255, "too many references");
 409:../../os/rt/src/chthreads.c ****   tp->refs++;
 695               		.loc 1 409 0
 696 0002 FC01      		movw r30,r24
 697 0004 2189      		ldd r18,Z+17
 698 0006 2F5F      		subi r18,lo8(-(1))
 699 0008 218B      		std Z+17,r18
 700               	.LBB273:
 701               	.LBB274:
 702               	.LBB275:
 703               	.LBB276:
 704               		.loc 3 440 0
 705               	/* #APP */
 706               	 ;  440 "../../os/common/ports/AVR/chcore.h" 1
 707 000a 7894      		sei
 708               	 ;  0 "" 2
 709               	/* epilogue start */
 710               	/* #NOAPP */
 711               	.LBE276:
 712               	.LBE275:
 713               	.LBE274:
 714               	.LBE273:
 410:../../os/rt/src/chthreads.c ****   chSysUnlock();
 411:../../os/rt/src/chthreads.c **** 
 412:../../os/rt/src/chthreads.c ****   return tp;
 413:../../os/rt/src/chthreads.c **** }
 715               		.loc 1 413 0
 716 000c 0895      		ret
 717               		.cfi_endproc
 718               	.LFE197:
 720               		.section	.text.chThdRelease,"ax",@progbits
 721               	.global	chThdRelease
 723               	chThdRelease:
 724               	.LFB198:
 414:../../os/rt/src/chthreads.c **** 
 415:../../os/rt/src/chthreads.c **** /**
 416:../../os/rt/src/chthreads.c ****  * @brief   Releases a reference to a thread object.
 417:../../os/rt/src/chthreads.c ****  * @details If the references counter reaches zero <b>and</b> the thread
 418:../../os/rt/src/chthreads.c ****  *          is in the @p CH_STATE_FINAL state then the thread's memory is
 419:../../os/rt/src/chthreads.c ****  *          returned to the proper allocator and the thread is removed
 420:../../os/rt/src/chthreads.c ****  *          from the registry.<br>
 421:../../os/rt/src/chthreads.c ****  *          Threads whose counter reaches zero and are still active become
 422:../../os/rt/src/chthreads.c ****  *          "detached" and will be removed from registry on termination.
 423:../../os/rt/src/chthreads.c ****  * @pre     The configuration option @p CH_CFG_USE_REGISTRY must be enabled in
 424:../../os/rt/src/chthreads.c ****  *          order to use this function.
 425:../../os/rt/src/chthreads.c ****  * @note    Static threads are not affected.
 426:../../os/rt/src/chthreads.c ****  *
 427:../../os/rt/src/chthreads.c ****  * @param[in] tp        pointer to the thread
 428:../../os/rt/src/chthreads.c ****  *
 429:../../os/rt/src/chthreads.c ****  * @api
 430:../../os/rt/src/chthreads.c ****  */
 431:../../os/rt/src/chthreads.c **** void chThdRelease(thread_t *tp) {
 725               		.loc 1 431 0
 726               		.cfi_startproc
 727               	.LVL55:
 728               	/* prologue: function */
 729               	/* frame size = 0 */
 730               	/* stack size = 0 */
 731               	.L__stack_usage = 0
 732 0000 FC01      		movw r30,r24
 733               	.LBB299:
 734               	.LBB300:
 735               	.LBB301:
 430:../../os/common/ports/AVR/chcore.h **** }
 736               		.loc 3 430 0
 737               	/* #APP */
 738               	 ;  430 "../../os/common/ports/AVR/chcore.h" 1
 739 0002 F894      		cli
 740               	 ;  0 "" 2
 741               	/* #NOAPP */
 742               	.LBE301:
 743               	.LBE300:
 744               	.LBE299:
 432:../../os/rt/src/chthreads.c **** 
 433:../../os/rt/src/chthreads.c ****   chSysLock();
 434:../../os/rt/src/chthreads.c ****   chDbgAssert(tp->refs > (trefs_t)0, "not referenced");
 435:../../os/rt/src/chthreads.c ****   tp->refs--;
 745               		.loc 1 435 0
 746 0004 9189      		ldd r25,Z+17
 747 0006 9150      		subi r25,lo8(-(-1))
 748 0008 918B      		std Z+17,r25
 436:../../os/rt/src/chthreads.c **** 
 437:../../os/rt/src/chthreads.c ****   /* If the references counter reaches zero and the thread is in its
 438:../../os/rt/src/chthreads.c ****      terminated state then the memory can be returned to the proper
 439:../../os/rt/src/chthreads.c ****      allocator.*/
 440:../../os/rt/src/chthreads.c ****   if ((tp->refs == (trefs_t)0) && (tp->state == CH_STATE_FINAL)) {
 749               		.loc 1 440 0
 750 000a 9111      		cpse r25,__zero_reg__
 751 000c 00C0      		rjmp .L11
 752               		.loc 1 440 0 is_stmt 0 discriminator 1
 753 000e 8785      		ldd r24,Z+15
 754               	.LVL56:
 755 0010 8F30      		cpi r24,lo8(15)
 756 0012 01F0      		breq .L13
 757               	.L11:
 758               	.LBB302:
 759               	.LBB303:
 760               	.LBB304:
 761               	.LBB305:
 762               		.loc 3 440 0 is_stmt 1
 763               	/* #APP */
 764               	 ;  440 "../../os/common/ports/AVR/chcore.h" 1
 765 0014 7894      		sei
 766               	 ;  0 "" 2
 767               	/* epilogue start */
 768               	/* #NOAPP */
 769               	.LBE305:
 770               	.LBE304:
 771               	.LBE303:
 772               	.LBE302:
 441:../../os/rt/src/chthreads.c ****     REG_REMOVE(tp);
 442:../../os/rt/src/chthreads.c ****     chSysUnlock();
 443:../../os/rt/src/chthreads.c **** 
 444:../../os/rt/src/chthreads.c **** #if CH_CFG_USE_DYNAMIC == TRUE
 445:../../os/rt/src/chthreads.c ****     switch (tp->flags & CH_FLAG_MODE_MASK) {
 446:../../os/rt/src/chthreads.c **** #if CH_CFG_USE_HEAP == TRUE
 447:../../os/rt/src/chthreads.c ****     case CH_FLAG_MODE_HEAP:
 448:../../os/rt/src/chthreads.c ****       chHeapFree(chThdGetWorkingAreaX(tp));
 449:../../os/rt/src/chthreads.c ****       break;
 450:../../os/rt/src/chthreads.c **** #endif
 451:../../os/rt/src/chthreads.c **** #if CH_CFG_USE_MEMPOOLS == TRUE
 452:../../os/rt/src/chthreads.c ****     case CH_FLAG_MODE_MPOOL:
 453:../../os/rt/src/chthreads.c ****       chPoolFree(tp->mpool, chThdGetWorkingAreaX(tp));
 454:../../os/rt/src/chthreads.c ****       break;
 455:../../os/rt/src/chthreads.c **** #endif
 456:../../os/rt/src/chthreads.c ****     default:
 457:../../os/rt/src/chthreads.c ****       /* Nothing else to do for static threads.*/
 458:../../os/rt/src/chthreads.c ****       break;
 459:../../os/rt/src/chthreads.c ****     }
 460:../../os/rt/src/chthreads.c **** #endif /* CH_CFG_USE_DYNAMIC == TRUE */
 461:../../os/rt/src/chthreads.c ****     return;
 462:../../os/rt/src/chthreads.c ****   }
 463:../../os/rt/src/chthreads.c ****   chSysUnlock();
 464:../../os/rt/src/chthreads.c **** }
 773               		.loc 1 464 0
 774 0016 0895      		ret
 775               	.L13:
 776               	.LVL57:
 777               	.LBB306:
 778               	.LBB307:
 779               	.LBB308:
 780               	.LBB309:
 268:../../os/rt/include/chlists.h **** }
 269:../../os/rt/include/chlists.h **** 
 270:../../os/rt/include/chlists.h **** /**
 271:../../os/rt/include/chlists.h ****  * @brief   Removes the first-out element from a queue and returns it.
 272:../../os/rt/include/chlists.h ****  * @note    If the queue is priority ordered then this function returns the
 273:../../os/rt/include/chlists.h ****  *          element with the highest priority.
 274:../../os/rt/include/chlists.h ****  *
 275:../../os/rt/include/chlists.h ****  * @param[in] qp        the pointer to the queue list header
 276:../../os/rt/include/chlists.h ****  * @return              The removed element pointer.
 277:../../os/rt/include/chlists.h ****  *
 278:../../os/rt/include/chlists.h ****  * @notapi
 279:../../os/rt/include/chlists.h ****  */
 280:../../os/rt/include/chlists.h **** static inline ch_queue_t *ch_queue_fifo_remove(ch_queue_t *qp) {
 281:../../os/rt/include/chlists.h ****   ch_queue_t *p = qp->next;
 282:../../os/rt/include/chlists.h **** 
 283:../../os/rt/include/chlists.h ****   qp->next       = p->next;
 284:../../os/rt/include/chlists.h ****   qp->next->prev = qp;
 285:../../os/rt/include/chlists.h **** 
 286:../../os/rt/include/chlists.h ****   return p;
 287:../../os/rt/include/chlists.h **** }
 288:../../os/rt/include/chlists.h **** 
 289:../../os/rt/include/chlists.h **** /**
 290:../../os/rt/include/chlists.h ****  * @brief   Removes the last-out element from a queue and returns it.
 291:../../os/rt/include/chlists.h ****  * @note    If the queue is priority ordered then this function returns the
 292:../../os/rt/include/chlists.h ****  *          element with the lowest priority.
 293:../../os/rt/include/chlists.h ****  *
 294:../../os/rt/include/chlists.h ****  * @param[in] qp    the pointer to the queue list header
 295:../../os/rt/include/chlists.h ****  * @return          The removed element pointer.
 296:../../os/rt/include/chlists.h ****  *
 297:../../os/rt/include/chlists.h ****  * @notapi
 298:../../os/rt/include/chlists.h ****  */
 299:../../os/rt/include/chlists.h **** static inline ch_queue_t *ch_queue_lifo_remove(ch_queue_t *qp) {
 300:../../os/rt/include/chlists.h ****   ch_queue_t *p = qp->prev;
 301:../../os/rt/include/chlists.h **** 
 302:../../os/rt/include/chlists.h ****   qp->prev       = p->prev;
 303:../../os/rt/include/chlists.h ****   qp->prev->next = qp;
 304:../../os/rt/include/chlists.h **** 
 305:../../os/rt/include/chlists.h ****   return p;
 306:../../os/rt/include/chlists.h **** }
 307:../../os/rt/include/chlists.h **** 
 308:../../os/rt/include/chlists.h **** /**
 309:../../os/rt/include/chlists.h ****  * @brief   Removes an element from a queue and returns it.
 310:../../os/rt/include/chlists.h ****  * @details The element is removed from the queue regardless of its relative
 311:../../os/rt/include/chlists.h ****  *          position and regardless the used insertion method.
 312:../../os/rt/include/chlists.h ****  *
 313:../../os/rt/include/chlists.h ****  * @param[in] p         the pointer to the element to be removed from the queue
 314:../../os/rt/include/chlists.h ****  * @return              The removed element pointer.
 315:../../os/rt/include/chlists.h ****  *
 316:../../os/rt/include/chlists.h ****  * @notapi
 317:../../os/rt/include/chlists.h ****  */
 318:../../os/rt/include/chlists.h **** static inline ch_queue_t *ch_queue_dequeue(ch_queue_t *p) {
 319:../../os/rt/include/chlists.h **** 
 320:../../os/rt/include/chlists.h ****   p->prev->next = p->next;
 781               		.loc 2 320 0
 782 0018 A185      		ldd r26,Z+9
 783 001a B285      		ldd r27,Z+10
 784 001c 8781      		ldd r24,Z+7
 785 001e 9085      		ldd r25,Z+8
 786 0020 1196      		adiw r26,1
 787 0022 9C93      		st X,r25
 788 0024 8E93      		st -X,r24
 321:../../os/rt/include/chlists.h ****   p->next->prev = p->prev;
 789               		.loc 2 321 0
 790 0026 0780      		ldd __tmp_reg__,Z+7
 791 0028 F085      		ldd r31,Z+8
 792 002a E02D      		mov r30,__tmp_reg__
 793               	.LVL58:
 794 002c B383      		std Z+3,r27
 795 002e A283      		std Z+2,r26
 796               	.LVL59:
 797               	.LBE309:
 798               	.LBE308:
 799               	.LBB310:
 800               	.LBB311:
 801               	.LBB312:
 802               	.LBB313:
 803               		.loc 3 440 0
 804               	/* #APP */
 805               	 ;  440 "../../os/common/ports/AVR/chcore.h" 1
 806 0030 7894      		sei
 807               	 ;  0 "" 2
 808               	/* #NOAPP */
 809 0032 0895      		ret
 810               	.LBE313:
 811               	.LBE312:
 812               	.LBE311:
 813               	.LBE310:
 814               	.LBE307:
 815               	.LBE306:
 816               		.cfi_endproc
 817               	.LFE198:
 819               		.section	.text.chThdExitS,"ax",@progbits
 820               	.global	chThdExitS
 822               	chThdExitS:
 823               	.LFB200:
 465:../../os/rt/src/chthreads.c **** #endif /* CH_CFG_USE_REGISTRY == TRUE */
 466:../../os/rt/src/chthreads.c **** 
 467:../../os/rt/src/chthreads.c **** /**
 468:../../os/rt/src/chthreads.c ****  * @brief   Terminates the current thread.
 469:../../os/rt/src/chthreads.c ****  * @details The thread goes in the @p CH_STATE_FINAL state holding the
 470:../../os/rt/src/chthreads.c ****  *          specified exit status code, other threads can retrieve the
 471:../../os/rt/src/chthreads.c ****  *          exit status code by invoking the function @p chThdWait().
 472:../../os/rt/src/chthreads.c ****  * @post    Eventual code after this function will never be executed,
 473:../../os/rt/src/chthreads.c ****  *          this function never returns. The compiler has no way to
 474:../../os/rt/src/chthreads.c ****  *          know this so do not assume that the compiler would remove
 475:../../os/rt/src/chthreads.c ****  *          the dead code.
 476:../../os/rt/src/chthreads.c ****  *
 477:../../os/rt/src/chthreads.c ****  * @param[in] msg       thread exit code
 478:../../os/rt/src/chthreads.c ****  *
 479:../../os/rt/src/chthreads.c ****  * @api
 480:../../os/rt/src/chthreads.c ****  */
 481:../../os/rt/src/chthreads.c **** void chThdExit(msg_t msg) {
 482:../../os/rt/src/chthreads.c **** 
 483:../../os/rt/src/chthreads.c ****   chSysLock();
 484:../../os/rt/src/chthreads.c ****   chThdExitS(msg);
 485:../../os/rt/src/chthreads.c ****   /* The thread never returns here.*/
 486:../../os/rt/src/chthreads.c **** }
 487:../../os/rt/src/chthreads.c **** 
 488:../../os/rt/src/chthreads.c **** /**
 489:../../os/rt/src/chthreads.c ****  * @brief   Terminates the current thread.
 490:../../os/rt/src/chthreads.c ****  * @details The thread goes in the @p CH_STATE_FINAL state holding the
 491:../../os/rt/src/chthreads.c ****  *          specified exit status code, other threads can retrieve the
 492:../../os/rt/src/chthreads.c ****  *          exit status code by invoking the function @p chThdWait().
 493:../../os/rt/src/chthreads.c ****  * @post    Exiting a non-static thread that does not have references
 494:../../os/rt/src/chthreads.c ****  *          (detached) causes the thread to remain in the registry.
 495:../../os/rt/src/chthreads.c ****  *          It can only be removed by performing a registry scan operation.
 496:../../os/rt/src/chthreads.c ****  * @post    Eventual code after this function will never be executed,
 497:../../os/rt/src/chthreads.c ****  *          this function never returns. The compiler has no way to
 498:../../os/rt/src/chthreads.c ****  *          know this so do not assume that the compiler would remove
 499:../../os/rt/src/chthreads.c ****  *          the dead code.
 500:../../os/rt/src/chthreads.c ****  *
 501:../../os/rt/src/chthreads.c ****  * @param[in] msg       thread exit code
 502:../../os/rt/src/chthreads.c ****  *
 503:../../os/rt/src/chthreads.c ****  * @sclass
 504:../../os/rt/src/chthreads.c ****  */
 505:../../os/rt/src/chthreads.c **** void chThdExitS(msg_t msg) {
 824               		.loc 1 505 0
 825               		.cfi_startproc
 826               	.LVL60:
 827 0000 0F93      		push r16
 828               	.LCFI12:
 829               		.cfi_def_cfa_offset 3
 830               		.cfi_offset 16, -2
 831 0002 1F93      		push r17
 832               	.LCFI13:
 833               		.cfi_def_cfa_offset 4
 834               		.cfi_offset 17, -3
 835 0004 CF93      		push r28
 836               	.LCFI14:
 837               		.cfi_def_cfa_offset 5
 838               		.cfi_offset 28, -4
 839 0006 DF93      		push r29
 840               	.LCFI15:
 841               		.cfi_def_cfa_offset 6
 842               		.cfi_offset 29, -5
 843               	/* prologue: function */
 844               	/* frame size = 0 */
 845               	/* stack size = 4 */
 846               	.L__stack_usage = 4
 847               	.LBB314:
 848               	.LBB315:
 849               		.file 4 "../../os/rt/include/chthreads.h"
   1:../../os/rt/include/chthreads.h **** /*
   2:../../os/rt/include/chthreads.h ****     ChibiOS - Copyright (C) 2006,2007,2008,2009,2010,2011,2012,2013,2014,
   3:../../os/rt/include/chthreads.h ****               2015,2016,2017,2018,2019,2020,2021 Giovanni Di Sirio.
   4:../../os/rt/include/chthreads.h **** 
   5:../../os/rt/include/chthreads.h ****     This file is part of ChibiOS.
   6:../../os/rt/include/chthreads.h **** 
   7:../../os/rt/include/chthreads.h ****     ChibiOS is free software; you can redistribute it and/or modify
   8:../../os/rt/include/chthreads.h ****     it under the terms of the GNU General Public License as published by
   9:../../os/rt/include/chthreads.h ****     the Free Software Foundation version 3 of the License.
  10:../../os/rt/include/chthreads.h **** 
  11:../../os/rt/include/chthreads.h ****     ChibiOS is distributed in the hope that it will be useful,
  12:../../os/rt/include/chthreads.h ****     but WITHOUT ANY WARRANTY; without even the implied warranty of
  13:../../os/rt/include/chthreads.h ****     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  14:../../os/rt/include/chthreads.h ****     GNU General Public License for more details.
  15:../../os/rt/include/chthreads.h **** 
  16:../../os/rt/include/chthreads.h ****     You should have received a copy of the GNU General Public License
  17:../../os/rt/include/chthreads.h ****     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  18:../../os/rt/include/chthreads.h **** */
  19:../../os/rt/include/chthreads.h **** 
  20:../../os/rt/include/chthreads.h **** /**
  21:../../os/rt/include/chthreads.h ****  * @file    rt/include/chthreads.h
  22:../../os/rt/include/chthreads.h ****  * @brief   Threads module macros and structures.
  23:../../os/rt/include/chthreads.h ****  *
  24:../../os/rt/include/chthreads.h ****  * @addtogroup threads
  25:../../os/rt/include/chthreads.h ****  * @{
  26:../../os/rt/include/chthreads.h ****  */
  27:../../os/rt/include/chthreads.h **** 
  28:../../os/rt/include/chthreads.h **** #ifndef CHTHREADS_H
  29:../../os/rt/include/chthreads.h **** #define CHTHREADS_H
  30:../../os/rt/include/chthreads.h **** 
  31:../../os/rt/include/chthreads.h **** /*lint -sem(chThdExit, r_no) -sem(chThdExitS, r_no)*/
  32:../../os/rt/include/chthreads.h **** 
  33:../../os/rt/include/chthreads.h **** /*===========================================================================*/
  34:../../os/rt/include/chthreads.h **** /* Module constants.                                                         */
  35:../../os/rt/include/chthreads.h **** /*===========================================================================*/
  36:../../os/rt/include/chthreads.h **** 
  37:../../os/rt/include/chthreads.h **** /*===========================================================================*/
  38:../../os/rt/include/chthreads.h **** /* Module pre-compile time settings.                                         */
  39:../../os/rt/include/chthreads.h **** /*===========================================================================*/
  40:../../os/rt/include/chthreads.h **** 
  41:../../os/rt/include/chthreads.h **** /*===========================================================================*/
  42:../../os/rt/include/chthreads.h **** /* Derived constants and error checks.                                       */
  43:../../os/rt/include/chthreads.h **** /*===========================================================================*/
  44:../../os/rt/include/chthreads.h **** 
  45:../../os/rt/include/chthreads.h **** /*===========================================================================*/
  46:../../os/rt/include/chthreads.h **** /* Module data structures and types.                                         */
  47:../../os/rt/include/chthreads.h **** /*===========================================================================*/
  48:../../os/rt/include/chthreads.h **** 
  49:../../os/rt/include/chthreads.h **** /**
  50:../../os/rt/include/chthreads.h ****  * @brief   Thread function.
  51:../../os/rt/include/chthreads.h ****  */
  52:../../os/rt/include/chthreads.h **** typedef void (*tfunc_t)(void *p);
  53:../../os/rt/include/chthreads.h **** 
  54:../../os/rt/include/chthreads.h **** /**
  55:../../os/rt/include/chthreads.h ****  * @brief   Type of a thread descriptor.
  56:../../os/rt/include/chthreads.h ****  */
  57:../../os/rt/include/chthreads.h **** typedef struct {
  58:../../os/rt/include/chthreads.h ****   /**
  59:../../os/rt/include/chthreads.h ****    * @brief   Thread name.
  60:../../os/rt/include/chthreads.h ****    */
  61:../../os/rt/include/chthreads.h ****   const char        *name;
  62:../../os/rt/include/chthreads.h ****   /**
  63:../../os/rt/include/chthreads.h ****    * @brief   Pointer to the working area base.
  64:../../os/rt/include/chthreads.h ****    */
  65:../../os/rt/include/chthreads.h ****   stkalign_t        *wbase;
  66:../../os/rt/include/chthreads.h ****   /**
  67:../../os/rt/include/chthreads.h ****    * @brief   Pointer to the working area end.
  68:../../os/rt/include/chthreads.h ****    */
  69:../../os/rt/include/chthreads.h ****   stkalign_t        *wend;
  70:../../os/rt/include/chthreads.h ****   /**
  71:../../os/rt/include/chthreads.h ****    * @brief   Thread priority.
  72:../../os/rt/include/chthreads.h ****    */
  73:../../os/rt/include/chthreads.h ****   tprio_t           prio;
  74:../../os/rt/include/chthreads.h ****   /**
  75:../../os/rt/include/chthreads.h ****    * @brief   Thread function pointer.
  76:../../os/rt/include/chthreads.h ****    */
  77:../../os/rt/include/chthreads.h ****   tfunc_t           funcp;
  78:../../os/rt/include/chthreads.h ****   /**
  79:../../os/rt/include/chthreads.h ****    * @brief   Thread argument.
  80:../../os/rt/include/chthreads.h ****    */
  81:../../os/rt/include/chthreads.h ****   void              *arg;
  82:../../os/rt/include/chthreads.h **** #if (CH_CFG_SMP_MODE != FALSE) || defined(__DOXYGEN__)
  83:../../os/rt/include/chthreads.h ****   /**
  84:../../os/rt/include/chthreads.h ****    * @brief         OS instance affinity or @p NULL for current one.
  85:../../os/rt/include/chthreads.h ****    */
  86:../../os/rt/include/chthreads.h ****   os_instance_t     *instance;
  87:../../os/rt/include/chthreads.h **** #endif
  88:../../os/rt/include/chthreads.h **** } thread_descriptor_t;
  89:../../os/rt/include/chthreads.h **** 
  90:../../os/rt/include/chthreads.h **** /*===========================================================================*/
  91:../../os/rt/include/chthreads.h **** /* Module macros.                                                            */
  92:../../os/rt/include/chthreads.h **** /*===========================================================================*/
  93:../../os/rt/include/chthreads.h **** 
  94:../../os/rt/include/chthreads.h **** /**
  95:../../os/rt/include/chthreads.h ****  * @name    Threads queues
  96:../../os/rt/include/chthreads.h ****  * @{
  97:../../os/rt/include/chthreads.h ****  */
  98:../../os/rt/include/chthreads.h **** /**
  99:../../os/rt/include/chthreads.h ****  * @brief   Data part of a static threads queue object initializer.
 100:../../os/rt/include/chthreads.h ****  * @details This macro should be used when statically initializing a threads
 101:../../os/rt/include/chthreads.h ****  *          queue that is part of a bigger structure.
 102:../../os/rt/include/chthreads.h ****  *
 103:../../os/rt/include/chthreads.h ****  * @param[in] name      the name of the threads queue variable
 104:../../os/rt/include/chthreads.h ****  */
 105:../../os/rt/include/chthreads.h **** #define __THREADS_QUEUE_DATA(name) {__CH_QUEUE_DATA(name)}
 106:../../os/rt/include/chthreads.h **** 
 107:../../os/rt/include/chthreads.h **** /**
 108:../../os/rt/include/chthreads.h ****  * @brief   Static threads queue object initializer.
 109:../../os/rt/include/chthreads.h ****  * @details Statically initialized threads queues require no explicit
 110:../../os/rt/include/chthreads.h ****  *          initialization using @p queue_init().
 111:../../os/rt/include/chthreads.h ****  *
 112:../../os/rt/include/chthreads.h ****  * @param[in] name      the name of the threads queue variable
 113:../../os/rt/include/chthreads.h ****  */
 114:../../os/rt/include/chthreads.h **** #define THREADS_QUEUE_DECL(name)                                            \
 115:../../os/rt/include/chthreads.h ****   threads_queue_t name = __THREADS_QUEUE_DATA(name)
 116:../../os/rt/include/chthreads.h **** /** @} */
 117:../../os/rt/include/chthreads.h **** 
 118:../../os/rt/include/chthreads.h **** /**
 119:../../os/rt/include/chthreads.h ****  * @name    Working Areas
 120:../../os/rt/include/chthreads.h ****  * @{
 121:../../os/rt/include/chthreads.h ****  */
 122:../../os/rt/include/chthreads.h **** /**
 123:../../os/rt/include/chthreads.h ****  * @brief   Calculates the total Working Area size.
 124:../../os/rt/include/chthreads.h ****  *
 125:../../os/rt/include/chthreads.h ****  * @param[in] n         the stack size to be assigned to the thread
 126:../../os/rt/include/chthreads.h ****  * @return              The total used memory in bytes.
 127:../../os/rt/include/chthreads.h ****  *
 128:../../os/rt/include/chthreads.h ****  * @api
 129:../../os/rt/include/chthreads.h ****  */
 130:../../os/rt/include/chthreads.h **** #define THD_WORKING_AREA_SIZE(n)                                            \
 131:../../os/rt/include/chthreads.h ****   MEM_ALIGN_NEXT(sizeof(thread_t) + PORT_WA_SIZE(n), PORT_STACK_ALIGN)
 132:../../os/rt/include/chthreads.h **** 
 133:../../os/rt/include/chthreads.h **** /**
 134:../../os/rt/include/chthreads.h ****  * @brief   Static working area allocation.
 135:../../os/rt/include/chthreads.h ****  * @details This macro is used to allocate a static thread working area
 136:../../os/rt/include/chthreads.h ****  *          aligned as both position and size.
 137:../../os/rt/include/chthreads.h ****  *
 138:../../os/rt/include/chthreads.h ****  * @param[in] s         the name to be assigned to the stack array
 139:../../os/rt/include/chthreads.h ****  * @param[in] n         the stack size to be assigned to the thread
 140:../../os/rt/include/chthreads.h ****  *
 141:../../os/rt/include/chthreads.h ****  * @api
 142:../../os/rt/include/chthreads.h ****  */
 143:../../os/rt/include/chthreads.h **** #define THD_WORKING_AREA(s, n) PORT_WORKING_AREA(s, n)
 144:../../os/rt/include/chthreads.h **** 
 145:../../os/rt/include/chthreads.h **** /**
 146:../../os/rt/include/chthreads.h ****  * @brief   Base of a working area casted to the correct type.
 147:../../os/rt/include/chthreads.h ****  *
 148:../../os/rt/include/chthreads.h ****  * @param[in] s         name of the working area
 149:../../os/rt/include/chthreads.h ****  */
 150:../../os/rt/include/chthreads.h **** #define THD_WORKING_AREA_BASE(s) ((stkalign_t *)(s))
 151:../../os/rt/include/chthreads.h **** 
 152:../../os/rt/include/chthreads.h **** /**
 153:../../os/rt/include/chthreads.h ****  * @brief   End of a working area casted to the correct type.
 154:../../os/rt/include/chthreads.h ****  *
 155:../../os/rt/include/chthreads.h ****  * @param[in] s         name of the working area
 156:../../os/rt/include/chthreads.h ****  */
 157:../../os/rt/include/chthreads.h **** #define THD_WORKING_AREA_END(s) (THD_WORKING_AREA_BASE(s) +                 \
 158:../../os/rt/include/chthreads.h ****                                  (sizeof (s) / sizeof (stkalign_t)))
 159:../../os/rt/include/chthreads.h **** /** @} */
 160:../../os/rt/include/chthreads.h **** 
 161:../../os/rt/include/chthreads.h **** /**
 162:../../os/rt/include/chthreads.h ****  * @name    Threads abstraction macros
 163:../../os/rt/include/chthreads.h ****  * @{
 164:../../os/rt/include/chthreads.h ****  */
 165:../../os/rt/include/chthreads.h **** /**
 166:../../os/rt/include/chthreads.h ****  * @brief   Thread declaration macro.
 167:../../os/rt/include/chthreads.h ****  * @note    Thread declarations should be performed using this macro because
 168:../../os/rt/include/chthreads.h ****  *          the port layer could define optimizations for thread functions.
 169:../../os/rt/include/chthreads.h ****  */
 170:../../os/rt/include/chthreads.h **** #define THD_FUNCTION(tname, arg) PORT_THD_FUNCTION(tname, arg)
 171:../../os/rt/include/chthreads.h **** /** @} */
 172:../../os/rt/include/chthreads.h **** 
 173:../../os/rt/include/chthreads.h **** /**
 174:../../os/rt/include/chthreads.h ****  * @name    Threads initializers
 175:../../os/rt/include/chthreads.h ****  * @{
 176:../../os/rt/include/chthreads.h ****  */
 177:../../os/rt/include/chthreads.h **** #if (CH_CFG_SMP_MODE != FALSE) || defined(__DOXYGEN__)
 178:../../os/rt/include/chthreads.h **** /**
 179:../../os/rt/include/chthreads.h ****  * @brief   Thread descriptor initializer with no affinity.
 180:../../os/rt/include/chthreads.h ****  *
 181:../../os/rt/include/chthreads.h ****  * @param[in] name      thread name
 182:../../os/rt/include/chthreads.h ****  * @param[in] wbase     pointer to the working area base
 183:../../os/rt/include/chthreads.h ****  * @param[in] wend      pointer to the working area end
 184:../../os/rt/include/chthreads.h ****  * @param[in] prio      thread priority
 185:../../os/rt/include/chthreads.h ****  * @param[in] funcp     thread function pointer
 186:../../os/rt/include/chthreads.h ****  * @param[in] arg       thread argument
 187:../../os/rt/include/chthreads.h ****  */
 188:../../os/rt/include/chthreads.h **** #define THD_DESCRIPTOR(name, wbase, wend, prio, funcp, arg) {               \
 189:../../os/rt/include/chthreads.h ****   (name),                                                                   \
 190:../../os/rt/include/chthreads.h ****   (wbase),                                                                  \
 191:../../os/rt/include/chthreads.h ****   (wend),                                                                   \
 192:../../os/rt/include/chthreads.h ****   (prio),                                                                   \
 193:../../os/rt/include/chthreads.h ****   (funcp),                                                                  \
 194:../../os/rt/include/chthreads.h ****   (arg),                                                                    \
 195:../../os/rt/include/chthreads.h ****   NULL                                                                      \
 196:../../os/rt/include/chthreads.h **** }
 197:../../os/rt/include/chthreads.h **** #else
 198:../../os/rt/include/chthreads.h **** #define THD_DESCRIPTOR(name, wbase, wend, prio, funcp, arg) {               \
 199:../../os/rt/include/chthreads.h ****   (name),                                                                   \
 200:../../os/rt/include/chthreads.h ****   (wbase),                                                                  \
 201:../../os/rt/include/chthreads.h ****   (wend),                                                                   \
 202:../../os/rt/include/chthreads.h ****   (prio),                                                                   \
 203:../../os/rt/include/chthreads.h ****   (funcp),                                                                  \
 204:../../os/rt/include/chthreads.h ****   (arg)                                                                     \
 205:../../os/rt/include/chthreads.h **** }
 206:../../os/rt/include/chthreads.h **** #endif
 207:../../os/rt/include/chthreads.h **** 
 208:../../os/rt/include/chthreads.h **** /**
 209:../../os/rt/include/chthreads.h ****  * @brief   Thread descriptor initializer with no affinity.
 210:../../os/rt/include/chthreads.h ****  *
 211:../../os/rt/include/chthreads.h ****  * @param[in] name      thread name
 212:../../os/rt/include/chthreads.h ****  * @param[in] wbase     pointer to the working area base
 213:../../os/rt/include/chthreads.h ****  * @param[in] wend      pointer to the working area end
 214:../../os/rt/include/chthreads.h ****  * @param[in] prio      thread priority
 215:../../os/rt/include/chthreads.h ****  * @param[in] funcp     thread function pointer
 216:../../os/rt/include/chthreads.h ****  * @param[in] arg       thread argument
 217:../../os/rt/include/chthreads.h ****  * @param[in] oip       instance affinity
 218:../../os/rt/include/chthreads.h ****  */
 219:../../os/rt/include/chthreads.h **** #define THD_DESCRIPTOR_AFFINITY(name, wbase, wend, prio, funcp, arg, oip) { \
 220:../../os/rt/include/chthreads.h ****   (name),                                                                   \
 221:../../os/rt/include/chthreads.h ****   (wbase),                                                                  \
 222:../../os/rt/include/chthreads.h ****   (wend),                                                                   \
 223:../../os/rt/include/chthreads.h ****   (prio),                                                                   \
 224:../../os/rt/include/chthreads.h ****   (funcp),                                                                  \
 225:../../os/rt/include/chthreads.h ****   (arg),                                                                    \
 226:../../os/rt/include/chthreads.h ****   (oip)                                                                     \
 227:../../os/rt/include/chthreads.h **** }
 228:../../os/rt/include/chthreads.h **** /** @} */
 229:../../os/rt/include/chthreads.h **** 
 230:../../os/rt/include/chthreads.h **** /**
 231:../../os/rt/include/chthreads.h ****  * @name    Macro Functions
 232:../../os/rt/include/chthreads.h ****  * @{
 233:../../os/rt/include/chthreads.h ****  */
 234:../../os/rt/include/chthreads.h **** /**
 235:../../os/rt/include/chthreads.h ****  * @brief   Delays the invoking thread for the specified number of seconds.
 236:../../os/rt/include/chthreads.h ****  * @note    The specified time is rounded up to a value allowed by the real
 237:../../os/rt/include/chthreads.h ****  *          system tick clock.
 238:../../os/rt/include/chthreads.h ****  * @note    The maximum specifiable value is implementation dependent.
 239:../../os/rt/include/chthreads.h ****  * @note    Use of this macro for large values is not secure because
 240:../../os/rt/include/chthreads.h ****  *          integer overflows, make sure your value can be correctly
 241:../../os/rt/include/chthreads.h ****  *          converted.
 242:../../os/rt/include/chthreads.h ****  *
 243:../../os/rt/include/chthreads.h ****  * @param[in] sec       time in seconds, must be different from zero
 244:../../os/rt/include/chthreads.h ****  *
 245:../../os/rt/include/chthreads.h ****  * @api
 246:../../os/rt/include/chthreads.h ****  */
 247:../../os/rt/include/chthreads.h **** #define chThdSleepSeconds(sec) chThdSleep(TIME_S2I(sec))
 248:../../os/rt/include/chthreads.h **** 
 249:../../os/rt/include/chthreads.h **** /**
 250:../../os/rt/include/chthreads.h ****  * @brief   Delays the invoking thread for the specified number of
 251:../../os/rt/include/chthreads.h ****  *          milliseconds.
 252:../../os/rt/include/chthreads.h ****  * @note    The specified time is rounded up to a value allowed by the real
 253:../../os/rt/include/chthreads.h ****  *          system tick clock.
 254:../../os/rt/include/chthreads.h ****  * @note    The maximum specifiable value is implementation dependent.
 255:../../os/rt/include/chthreads.h ****  * @note    Use of this macro for large values is not secure because
 256:../../os/rt/include/chthreads.h ****  *          integer overflows, make sure your value can be correctly
 257:../../os/rt/include/chthreads.h ****  *          converted.
 258:../../os/rt/include/chthreads.h ****  *
 259:../../os/rt/include/chthreads.h ****  * @param[in] msec      time in milliseconds, must be different from zero
 260:../../os/rt/include/chthreads.h ****  *
 261:../../os/rt/include/chthreads.h ****  * @api
 262:../../os/rt/include/chthreads.h ****  */
 263:../../os/rt/include/chthreads.h **** #define chThdSleepMilliseconds(msec) chThdSleep(TIME_MS2I(msec))
 264:../../os/rt/include/chthreads.h **** 
 265:../../os/rt/include/chthreads.h **** /**
 266:../../os/rt/include/chthreads.h ****  * @brief   Delays the invoking thread for the specified number of
 267:../../os/rt/include/chthreads.h ****  *          microseconds.
 268:../../os/rt/include/chthreads.h ****  * @note    The specified time is rounded up to a value allowed by the real
 269:../../os/rt/include/chthreads.h ****  *          system tick clock.
 270:../../os/rt/include/chthreads.h ****  * @note    The maximum specifiable value is implementation dependent.
 271:../../os/rt/include/chthreads.h ****  * @note    Use of this macro for large values is not secure because
 272:../../os/rt/include/chthreads.h ****  *          integer overflows, make sure your value can be correctly
 273:../../os/rt/include/chthreads.h ****  *          converted.
 274:../../os/rt/include/chthreads.h ****  *
 275:../../os/rt/include/chthreads.h ****  * @param[in] usec      time in microseconds, must be different from zero
 276:../../os/rt/include/chthreads.h ****  *
 277:../../os/rt/include/chthreads.h ****  * @api
 278:../../os/rt/include/chthreads.h ****  */
 279:../../os/rt/include/chthreads.h **** #define chThdSleepMicroseconds(usec) chThdSleep(TIME_US2I(usec))
 280:../../os/rt/include/chthreads.h **** /** @} */
 281:../../os/rt/include/chthreads.h **** 
 282:../../os/rt/include/chthreads.h **** /*===========================================================================*/
 283:../../os/rt/include/chthreads.h **** /* External declarations.                                                    */
 284:../../os/rt/include/chthreads.h **** /*===========================================================================*/
 285:../../os/rt/include/chthreads.h **** 
 286:../../os/rt/include/chthreads.h **** #ifdef __cplusplus
 287:../../os/rt/include/chthreads.h **** extern "C" {
 288:../../os/rt/include/chthreads.h **** #endif
 289:../../os/rt/include/chthreads.h ****    thread_t *__thd_object_init(os_instance_t *oip,
 290:../../os/rt/include/chthreads.h ****                                thread_t *tp,
 291:../../os/rt/include/chthreads.h ****                                const char *name,
 292:../../os/rt/include/chthreads.h ****                                tprio_t prio);
 293:../../os/rt/include/chthreads.h **** #if CH_DBG_FILL_THREADS == TRUE
 294:../../os/rt/include/chthreads.h ****   void __thd_stackfill(uint8_t *startp, uint8_t *endp);
 295:../../os/rt/include/chthreads.h **** #endif
 296:../../os/rt/include/chthreads.h ****   thread_t *chThdCreateSuspendedI(const thread_descriptor_t *tdp);
 297:../../os/rt/include/chthreads.h ****   thread_t *chThdCreateSuspended(const thread_descriptor_t *tdp);
 298:../../os/rt/include/chthreads.h ****   thread_t *chThdCreateI(const thread_descriptor_t *tdp);
 299:../../os/rt/include/chthreads.h ****   thread_t *chThdCreate(const thread_descriptor_t *tdp);
 300:../../os/rt/include/chthreads.h ****   thread_t *chThdCreateStatic(void *wsp, size_t size,
 301:../../os/rt/include/chthreads.h ****                               tprio_t prio, tfunc_t pf, void *arg);
 302:../../os/rt/include/chthreads.h ****   thread_t *chThdStart(thread_t *tp);
 303:../../os/rt/include/chthreads.h **** #if CH_CFG_USE_REGISTRY == TRUE
 304:../../os/rt/include/chthreads.h ****   thread_t *chThdAddRef(thread_t *tp);
 305:../../os/rt/include/chthreads.h ****   void chThdRelease(thread_t *tp);
 306:../../os/rt/include/chthreads.h **** #endif
 307:../../os/rt/include/chthreads.h ****   void chThdExit(msg_t msg);
 308:../../os/rt/include/chthreads.h ****   void chThdExitS(msg_t msg);
 309:../../os/rt/include/chthreads.h **** #if CH_CFG_USE_WAITEXIT == TRUE
 310:../../os/rt/include/chthreads.h ****   msg_t chThdWait(thread_t *tp);
 311:../../os/rt/include/chthreads.h **** #endif
 312:../../os/rt/include/chthreads.h ****   tprio_t chThdSetPriority(tprio_t newprio);
 313:../../os/rt/include/chthreads.h ****   void chThdTerminate(thread_t *tp);
 314:../../os/rt/include/chthreads.h ****   msg_t chThdSuspendS(thread_reference_t *trp);
 315:../../os/rt/include/chthreads.h ****   msg_t chThdSuspendTimeoutS(thread_reference_t *trp, sysinterval_t timeout);
 316:../../os/rt/include/chthreads.h ****   void chThdResumeI(thread_reference_t *trp, msg_t msg);
 317:../../os/rt/include/chthreads.h ****   void chThdResumeS(thread_reference_t *trp, msg_t msg);
 318:../../os/rt/include/chthreads.h ****   void chThdResume(thread_reference_t *trp, msg_t msg);
 319:../../os/rt/include/chthreads.h ****   msg_t chThdEnqueueTimeoutS(threads_queue_t *tqp, sysinterval_t timeout);
 320:../../os/rt/include/chthreads.h ****   void chThdDequeueNextI(threads_queue_t *tqp, msg_t msg);
 321:../../os/rt/include/chthreads.h ****   void chThdDequeueAllI(threads_queue_t *tqp, msg_t msg);
 322:../../os/rt/include/chthreads.h ****   void chThdSleep(sysinterval_t time);
 323:../../os/rt/include/chthreads.h ****   void chThdSleepUntil(systime_t time);
 324:../../os/rt/include/chthreads.h ****   systime_t chThdSleepUntilWindowed(systime_t prev, systime_t next);
 325:../../os/rt/include/chthreads.h ****   void chThdYield(void);
 326:../../os/rt/include/chthreads.h **** #ifdef __cplusplus
 327:../../os/rt/include/chthreads.h **** }
 328:../../os/rt/include/chthreads.h **** #endif
 329:../../os/rt/include/chthreads.h **** 
 330:../../os/rt/include/chthreads.h **** /*===========================================================================*/
 331:../../os/rt/include/chthreads.h **** /* Module inline functions.                                                  */
 332:../../os/rt/include/chthreads.h **** /*===========================================================================*/
 333:../../os/rt/include/chthreads.h **** 
 334:../../os/rt/include/chthreads.h **** /**
 335:../../os/rt/include/chthreads.h ****  * @brief   Returns a pointer to the current @p thread_t.
 336:../../os/rt/include/chthreads.h ****  *
 337:../../os/rt/include/chthreads.h ****  * @return             A pointer to the current thread.
 338:../../os/rt/include/chthreads.h ****  *
 339:../../os/rt/include/chthreads.h ****  * @xclass
 340:../../os/rt/include/chthreads.h ****  */
 341:../../os/rt/include/chthreads.h **** static inline thread_t *chThdGetSelfX(void) {
 342:../../os/rt/include/chthreads.h **** 
 343:../../os/rt/include/chthreads.h ****   return __sch_get_currthread();
 850               		.loc 4 343 0
 851 0008 C091 0000 		lds r28,ch0+5
 852 000c D091 0000 		lds r29,ch0+5+1
 853               	.LBE315:
 854               	.LBE314:
 506:../../os/rt/src/chthreads.c ****   thread_t *currtp = chThdGetSelfX();
 507:../../os/rt/src/chthreads.c **** 
 508:../../os/rt/src/chthreads.c ****   /* Storing exit message.*/
 509:../../os/rt/src/chthreads.c ****   currtp->u.exitcode = msg;
 855               		.loc 1 509 0
 856 0010 9B8B      		std Y+19,r25
 857 0012 8A8B      		std Y+18,r24
 510:../../os/rt/src/chthreads.c **** 
 511:../../os/rt/src/chthreads.c ****   /* Exit handler hook.*/
 512:../../os/rt/src/chthreads.c ****   CH_CFG_THREAD_EXIT_HOOK(tp);
 513:../../os/rt/src/chthreads.c **** 
 514:../../os/rt/src/chthreads.c **** #if CH_CFG_USE_WAITEXIT == TRUE
 515:../../os/rt/src/chthreads.c ****   /* Waking up any waiting thread.*/
 516:../../os/rt/src/chthreads.c ****   while (unlikely(ch_list_notempty(&currtp->waiting))) {
 858               		.loc 1 516 0
 859 0014 8E01      		movw r16,r28
 860 0016 0C5E      		subi r16,-20
 861 0018 1F4F      		sbci r17,-1
 862               	.LVL61:
 863               	.LBB316:
 864               	.LBB317:
 181:../../os/rt/include/chlists.h **** }
 865               		.loc 2 181 0
 866 001a 8C89      		ldd r24,Y+20
 867 001c 9D89      		ldd r25,Y+21
 868               	.LVL62:
 869               	.LBE317:
 870               	.LBE316:
 871               		.loc 1 516 0
 872 001e 0817      		cp r16,r24
 873 0020 1907      		cpc r17,r25
 874 0022 01F0      		breq .L15
 875               	.LVL63:
 876               	.L16:
 877               	.LBB319:
 878               	.LBB320:
 210:../../os/rt/include/chlists.h **** 
 879               		.loc 2 210 0
 880 0024 FC01      		movw r30,r24
 881 0026 2081      		ld r18,Z
 882 0028 3181      		ldd r19,Z+1
 883 002a 3D8B      		std Y+21,r19
 884 002c 2C8B      		std Y+20,r18
 885               	.LVL64:
 886               	.LBE320:
 887               	.LBE319:
 517:../../os/rt/src/chthreads.c ****     (void) chSchReadyI(threadref(ch_list_unlink(&currtp->waiting)));
 888               		.loc 1 517 0
 889 002e 0E94 0000 		call chSchReadyI
 890               	.LVL65:
 891               	.LBB321:
 892               	.LBB318:
 181:../../os/rt/include/chlists.h **** }
 893               		.loc 2 181 0
 894 0032 8C89      		ldd r24,Y+20
 895 0034 9D89      		ldd r25,Y+21
 896               	.LVL66:
 897               	.LBE318:
 898               	.LBE321:
 516:../../os/rt/src/chthreads.c ****     (void) chSchReadyI(threadref(ch_list_unlink(&currtp->waiting)));
 899               		.loc 1 516 0
 900 0036 8017      		cp r24,r16
 901 0038 9107      		cpc r25,r17
 902 003a 01F4      		brne .L16
 903               	.L15:
 518:../../os/rt/src/chthreads.c ****   }
 519:../../os/rt/src/chthreads.c **** #endif
 520:../../os/rt/src/chthreads.c **** 
 521:../../os/rt/src/chthreads.c **** #if CH_CFG_USE_REGISTRY == TRUE
 522:../../os/rt/src/chthreads.c ****   if (unlikely(currtp->refs == (trefs_t)0)) {
 904               		.loc 1 522 0
 905 003c 8989      		ldd r24,Y+17
 906 003e 8111      		cpse r24,__zero_reg__
 907 0040 00C0      		rjmp .L17
 908               	.LVL67:
 909               	.LBB322:
 910               	.LBB323:
 320:../../os/rt/include/chlists.h ****   p->next->prev = p->prev;
 911               		.loc 2 320 0
 912 0042 E985      		ldd r30,Y+9
 913 0044 FA85      		ldd r31,Y+10
 914 0046 8F81      		ldd r24,Y+7
 915 0048 9885      		ldd r25,Y+8
 916 004a 9183      		std Z+1,r25
 917 004c 8083      		st Z,r24
 918               		.loc 2 321 0
 919 004e AF81      		ldd r26,Y+7
 920 0050 B885      		ldd r27,Y+8
 921 0052 1396      		adiw r26,2+1
 922 0054 FC93      		st X,r31
 923 0056 EE93      		st -X,r30
 924 0058 1297      		sbiw r26,2
 925               	.LVL68:
 926               	.L17:
 927               	.LBE323:
 928               	.LBE322:
 523:../../os/rt/src/chthreads.c **** #if CH_CFG_USE_DYNAMIC == TRUE
 524:../../os/rt/src/chthreads.c ****     /* Static threads are immediately removed from the registry because there
 525:../../os/rt/src/chthreads.c ****        is no memory to recover.*/
 526:../../os/rt/src/chthreads.c ****     if (unlikely(((currtp->flags & CH_FLAG_MODE_MASK) == CH_FLAG_MODE_STATIC))) {
 527:../../os/rt/src/chthreads.c ****       REG_REMOVE(currtp);
 528:../../os/rt/src/chthreads.c ****     }
 529:../../os/rt/src/chthreads.c **** #else
 530:../../os/rt/src/chthreads.c ****     REG_REMOVE(currtp);
 531:../../os/rt/src/chthreads.c **** #endif
 532:../../os/rt/src/chthreads.c ****   }
 533:../../os/rt/src/chthreads.c **** #endif
 534:../../os/rt/src/chthreads.c **** 
 535:../../os/rt/src/chthreads.c ****   /* Going into final state.*/
 536:../../os/rt/src/chthreads.c ****   chSchGoSleepS(CH_STATE_FINAL);
 929               		.loc 1 536 0
 930 005a 8FE0      		ldi r24,lo8(15)
 931               	/* epilogue start */
 537:../../os/rt/src/chthreads.c **** 
 538:../../os/rt/src/chthreads.c ****   /* The thread never returns here.*/
 539:../../os/rt/src/chthreads.c ****   chDbgAssert(false, "zombies apocalypse");
 540:../../os/rt/src/chthreads.c **** }
 932               		.loc 1 540 0
 933 005c DF91      		pop r29
 934 005e CF91      		pop r28
 935 0060 1F91      		pop r17
 936 0062 0F91      		pop r16
 536:../../os/rt/src/chthreads.c **** 
 937               		.loc 1 536 0
 938 0064 0C94 0000 		jmp chSchGoSleepS
 939               	.LVL69:
 940               		.cfi_endproc
 941               	.LFE200:
 943               		.section	.text.chThdExit,"ax",@progbits
 944               	.global	chThdExit
 946               	chThdExit:
 947               	.LFB199:
 481:../../os/rt/src/chthreads.c **** 
 948               		.loc 1 481 0
 949               		.cfi_startproc
 950               	.LVL70:
 951               	/* prologue: function */
 952               	/* frame size = 0 */
 953               	/* stack size = 0 */
 954               	.L__stack_usage = 0
 955               	.LBB324:
 956               	.LBB325:
 957               	.LBB326:
 430:../../os/common/ports/AVR/chcore.h **** }
 958               		.loc 3 430 0
 959               	/* #APP */
 960               	 ;  430 "../../os/common/ports/AVR/chcore.h" 1
 961 0000 F894      		cli
 962               	 ;  0 "" 2
 963               	/* #NOAPP */
 964               	.LBE326:
 965               	.LBE325:
 966               	.LBE324:
 484:../../os/rt/src/chthreads.c ****   /* The thread never returns here.*/
 967               		.loc 1 484 0
 968 0002 0C94 0000 		jmp chThdExitS
 969               	.LVL71:
 970               		.cfi_endproc
 971               	.LFE199:
 973               		.section	.text.chThdWait,"ax",@progbits
 974               	.global	chThdWait
 976               	chThdWait:
 977               	.LFB201:
 541:../../os/rt/src/chthreads.c **** 
 542:../../os/rt/src/chthreads.c **** #if (CH_CFG_USE_WAITEXIT == TRUE) || defined(__DOXYGEN__)
 543:../../os/rt/src/chthreads.c **** /**
 544:../../os/rt/src/chthreads.c ****  * @brief   Blocks the execution of the invoking thread until the specified
 545:../../os/rt/src/chthreads.c ****  *          thread terminates then the exit code is returned.
 546:../../os/rt/src/chthreads.c ****  * @details This function waits for the specified thread to terminate then
 547:../../os/rt/src/chthreads.c ****  *          decrements its reference counter, if the counter reaches zero then
 548:../../os/rt/src/chthreads.c ****  *          the thread working area is returned to the proper allocator and
 549:../../os/rt/src/chthreads.c ****  *          the thread is removed from registry.
 550:../../os/rt/src/chthreads.c ****  * @pre     The configuration option @p CH_CFG_USE_WAITEXIT must be enabled in
 551:../../os/rt/src/chthreads.c ****  *          order to use this function.
 552:../../os/rt/src/chthreads.c ****  * @post    Enabling @p chThdWait() requires 2-4 (depending on the
 553:../../os/rt/src/chthreads.c ****  *          architecture) extra bytes in the @p thread_t structure.
 554:../../os/rt/src/chthreads.c ****  * @note    If @p CH_CFG_USE_DYNAMIC is not specified this function just waits
 555:../../os/rt/src/chthreads.c ****  *          for the thread termination, no memory allocators are involved.
 556:../../os/rt/src/chthreads.c ****  *
 557:../../os/rt/src/chthreads.c ****  * @param[in] tp        pointer to the thread
 558:../../os/rt/src/chthreads.c ****  * @return              The exit code from the terminated thread.
 559:../../os/rt/src/chthreads.c ****  *
 560:../../os/rt/src/chthreads.c ****  * @api
 561:../../os/rt/src/chthreads.c ****  */
 562:../../os/rt/src/chthreads.c **** msg_t chThdWait(thread_t *tp) {
 978               		.loc 1 562 0
 979               		.cfi_startproc
 980               	.LVL72:
 981 0000 0F93      		push r16
 982               	.LCFI16:
 983               		.cfi_def_cfa_offset 3
 984               		.cfi_offset 16, -2
 985 0002 1F93      		push r17
 986               	.LCFI17:
 987               		.cfi_def_cfa_offset 4
 988               		.cfi_offset 17, -3
 989 0004 CF93      		push r28
 990               	.LCFI18:
 991               		.cfi_def_cfa_offset 5
 992               		.cfi_offset 28, -4
 993 0006 DF93      		push r29
 994               	.LCFI19:
 995               		.cfi_def_cfa_offset 6
 996               		.cfi_offset 29, -5
 997               	/* prologue: function */
 998               	/* frame size = 0 */
 999               	/* stack size = 4 */
 1000               	.L__stack_usage = 4
 1001 0008 EC01      		movw r28,r24
 1002               	.LBB327:
 1003               	.LBB328:
 1004               		.loc 4 343 0
 1005 000a E091 0000 		lds r30,ch0+5
 1006 000e F091 0000 		lds r31,ch0+5+1
 1007               	.LBE328:
 1008               	.LBE327:
 1009               	.LBB329:
 1010               	.LBB330:
 1011               	.LBB331:
 430:../../os/common/ports/AVR/chcore.h **** }
 1012               		.loc 3 430 0
 1013               	/* #APP */
 1014               	 ;  430 "../../os/common/ports/AVR/chcore.h" 1
 1015 0012 F894      		cli
 1016               	 ;  0 "" 2
 1017               	/* #NOAPP */
 1018               	.LBE331:
 1019               	.LBE330:
 1020               	.LBE329:
 563:../../os/rt/src/chthreads.c ****   thread_t *currtp = chThdGetSelfX();
 564:../../os/rt/src/chthreads.c ****   msg_t msg;
 565:../../os/rt/src/chthreads.c **** 
 566:../../os/rt/src/chthreads.c ****   chDbgCheck(tp != NULL);
 567:../../os/rt/src/chthreads.c **** 
 568:../../os/rt/src/chthreads.c ****   chSysLock();
 569:../../os/rt/src/chthreads.c ****   chDbgAssert(tp != currtp, "waiting self");
 570:../../os/rt/src/chthreads.c **** #if CH_CFG_USE_REGISTRY == TRUE
 571:../../os/rt/src/chthreads.c ****   chDbgAssert(tp->refs > (trefs_t)0, "no references");
 572:../../os/rt/src/chthreads.c **** #endif
 573:../../os/rt/src/chthreads.c **** 
 574:../../os/rt/src/chthreads.c ****   if (likely(tp->state != CH_STATE_FINAL)) {
 1021               		.loc 1 574 0
 1022 0014 8F85      		ldd r24,Y+15
 1023               	.LVL73:
 1024 0016 8F30      		cpi r24,lo8(15)
 1025 0018 01F0      		breq .L21
 1026               	.LVL74:
 1027               	.LBB332:
 1028               	.LBB333:
 194:../../os/rt/include/chlists.h ****   lp->next = p;
 1029               		.loc 2 194 0
 1030 001a 8C89      		ldd r24,Y+20
 1031 001c 9D89      		ldd r25,Y+21
 1032 001e 9183      		std Z+1,r25
 1033 0020 8083      		st Z,r24
 195:../../os/rt/include/chlists.h **** }
 1034               		.loc 2 195 0
 1035 0022 FD8B      		std Y+21,r31
 1036 0024 EC8B      		std Y+20,r30
 1037               	.LVL75:
 1038               	.LBE333:
 1039               	.LBE332:
 575:../../os/rt/src/chthreads.c ****     ch_list_link(&tp->waiting, &currtp->hdr.list);
 576:../../os/rt/src/chthreads.c ****     chSchGoSleepS(CH_STATE_WTEXIT);
 1040               		.loc 1 576 0
 1041 0026 89E0      		ldi r24,lo8(9)
 1042 0028 0E94 0000 		call chSchGoSleepS
 1043               	.LVL76:
 1044               	.L21:
 577:../../os/rt/src/chthreads.c ****   }
 578:../../os/rt/src/chthreads.c ****   msg = tp->u.exitcode;
 1045               		.loc 1 578 0
 1046 002c 0A89      		ldd r16,Y+18
 1047 002e 1B89      		ldd r17,Y+19
 1048               	.LVL77:
 1049               	.LBB334:
 1050               	.LBB335:
 1051               	.LBB336:
 1052               	.LBB337:
 1053               		.loc 3 440 0
 1054               	/* #APP */
 1055               	 ;  440 "../../os/common/ports/AVR/chcore.h" 1
 1056 0030 7894      		sei
 1057               	 ;  0 "" 2
 1058               	/* #NOAPP */
 1059               	.LBE337:
 1060               	.LBE336:
 1061               	.LBE335:
 1062               	.LBE334:
 579:../../os/rt/src/chthreads.c ****   chSysUnlock();
 580:../../os/rt/src/chthreads.c **** 
 581:../../os/rt/src/chthreads.c **** #if CH_CFG_USE_REGISTRY == TRUE
 582:../../os/rt/src/chthreads.c ****   /* Releasing a reference to the thread.*/
 583:../../os/rt/src/chthreads.c ****   chThdRelease(tp);
 1063               		.loc 1 583 0
 1064 0032 CE01      		movw r24,r28
 1065 0034 0E94 0000 		call chThdRelease
 1066               	.LVL78:
 584:../../os/rt/src/chthreads.c **** #endif
 585:../../os/rt/src/chthreads.c **** 
 586:../../os/rt/src/chthreads.c ****   return msg;
 587:../../os/rt/src/chthreads.c **** }
 1067               		.loc 1 587 0
 1068 0038 C801      		movw r24,r16
 1069               	/* epilogue start */
 1070 003a DF91      		pop r29
 1071 003c CF91      		pop r28
 1072               	.LVL79:
 1073 003e 1F91      		pop r17
 1074 0040 0F91      		pop r16
 1075               	.LVL80:
 1076 0042 0895      		ret
 1077               		.cfi_endproc
 1078               	.LFE201:
 1080               		.section	.text.chThdSetPriority,"ax",@progbits
 1081               	.global	chThdSetPriority
 1083               	chThdSetPriority:
 1084               	.LFB202:
 588:../../os/rt/src/chthreads.c **** #endif /* CH_CFG_USE_WAITEXIT */
 589:../../os/rt/src/chthreads.c **** 
 590:../../os/rt/src/chthreads.c **** /**
 591:../../os/rt/src/chthreads.c ****  * @brief   Changes the running thread priority level then reschedules if
 592:../../os/rt/src/chthreads.c ****  *          necessary.
 593:../../os/rt/src/chthreads.c ****  * @note    The function returns the real thread priority regardless of the
 594:../../os/rt/src/chthreads.c ****  *          current priority that could be higher than the real priority
 595:../../os/rt/src/chthreads.c ****  *          because the priority inheritance mechanism.
 596:../../os/rt/src/chthreads.c ****  *
 597:../../os/rt/src/chthreads.c ****  * @param[in] newprio   the new priority level of the running thread
 598:../../os/rt/src/chthreads.c ****  * @return              The old priority level.
 599:../../os/rt/src/chthreads.c ****  *
 600:../../os/rt/src/chthreads.c ****  * @api
 601:../../os/rt/src/chthreads.c ****  */
 602:../../os/rt/src/chthreads.c **** tprio_t chThdSetPriority(tprio_t newprio) {
 1085               		.loc 1 602 0
 1086               		.cfi_startproc
 1087               	.LVL81:
 1088 0000 CF93      		push r28
 1089               	.LCFI20:
 1090               		.cfi_def_cfa_offset 3
 1091               		.cfi_offset 28, -2
 1092               	/* prologue: function */
 1093               	/* frame size = 0 */
 1094               	/* stack size = 1 */
 1095               	.L__stack_usage = 1
 1096               	.LBB338:
 1097               	.LBB339:
 1098               		.loc 4 343 0
 1099 0002 E091 0000 		lds r30,ch0+5
 1100 0006 F091 0000 		lds r31,ch0+5+1
 1101               	.LBE339:
 1102               	.LBE338:
 1103               	.LBB340:
 1104               	.LBB341:
 1105               	.LBB342:
 430:../../os/common/ports/AVR/chcore.h **** }
 1106               		.loc 3 430 0
 1107               	/* #APP */
 1108               	 ;  430 "../../os/common/ports/AVR/chcore.h" 1
 1109 000a F894      		cli
 1110               	 ;  0 "" 2
 1111               	/* #NOAPP */
 1112               	.LBE342:
 1113               	.LBE341:
 1114               	.LBE340:
 603:../../os/rt/src/chthreads.c ****   thread_t *currtp = chThdGetSelfX();
 604:../../os/rt/src/chthreads.c ****   tprio_t oldprio;
 605:../../os/rt/src/chthreads.c **** 
 606:../../os/rt/src/chthreads.c ****   chDbgCheck(newprio <= HIGHPRIO);
 607:../../os/rt/src/chthreads.c **** 
 608:../../os/rt/src/chthreads.c ****   chSysLock();
 609:../../os/rt/src/chthreads.c **** #if CH_CFG_USE_MUTEXES == TRUE
 610:../../os/rt/src/chthreads.c ****   oldprio = currtp->realprio;
 1115               		.loc 1 610 0
 1116 000c C58D      		ldd r28,Z+29
 1117               	.LVL82:
 611:../../os/rt/src/chthreads.c ****   if ((currtp->hdr.pqueue.prio == currtp->realprio) ||
 1118               		.loc 1 611 0
 1119 000e 9481      		ldd r25,Z+4
 1120 0010 9C17      		cp r25,r28
 1121 0012 01F0      		breq .L26
 1122               		.loc 1 611 0 is_stmt 0 discriminator 1
 1123 0014 9817      		cp r25,r24
 1124 0016 00F4      		brsh .L27
 1125               	.L26:
 612:../../os/rt/src/chthreads.c ****       (newprio > currtp->hdr.pqueue.prio)) {
 613:../../os/rt/src/chthreads.c ****     currtp->hdr.pqueue.prio = newprio;
 1126               		.loc 1 613 0 is_stmt 1
 1127 0018 8483      		std Z+4,r24
 1128               	.L27:
 614:../../os/rt/src/chthreads.c ****   }
 615:../../os/rt/src/chthreads.c ****   currtp->realprio = newprio;
 1129               		.loc 1 615 0
 1130 001a 858F      		std Z+29,r24
 616:../../os/rt/src/chthreads.c **** #else
 617:../../os/rt/src/chthreads.c ****   oldprio = currtp->hdr.pqueue.prio;
 618:../../os/rt/src/chthreads.c ****   currtp->hdr.pqueue.prio = newprio;
 619:../../os/rt/src/chthreads.c **** #endif
 620:../../os/rt/src/chthreads.c ****   chSchRescheduleS();
 1131               		.loc 1 620 0
 1132 001c 0E94 0000 		call chSchRescheduleS
 1133               	.LVL83:
 1134               	.LBB343:
 1135               	.LBB344:
 1136               	.LBB345:
 1137               	.LBB346:
 1138               		.loc 3 440 0
 1139               	/* #APP */
 1140               	 ;  440 "../../os/common/ports/AVR/chcore.h" 1
 1141 0020 7894      		sei
 1142               	 ;  0 "" 2
 1143               	/* #NOAPP */
 1144               	.LBE346:
 1145               	.LBE345:
 1146               	.LBE344:
 1147               	.LBE343:
 621:../../os/rt/src/chthreads.c ****   chSysUnlock();
 622:../../os/rt/src/chthreads.c **** 
 623:../../os/rt/src/chthreads.c ****   return oldprio;
 624:../../os/rt/src/chthreads.c **** }
 1148               		.loc 1 624 0
 1149 0022 8C2F      		mov r24,r28
 1150               	/* epilogue start */
 1151 0024 CF91      		pop r28
 1152               	.LVL84:
 1153 0026 0895      		ret
 1154               		.cfi_endproc
 1155               	.LFE202:
 1157               		.section	.text.chThdTerminate,"ax",@progbits
 1158               	.global	chThdTerminate
 1160               	chThdTerminate:
 1161               	.LFB203:
 625:../../os/rt/src/chthreads.c **** 
 626:../../os/rt/src/chthreads.c **** /**
 627:../../os/rt/src/chthreads.c ****  * @brief   Requests a thread termination.
 628:../../os/rt/src/chthreads.c ****  * @pre     The target thread must be written to invoke periodically
 629:../../os/rt/src/chthreads.c ****  *          @p chThdShouldTerminate() and terminate cleanly if it returns
 630:../../os/rt/src/chthreads.c ****  *          @p true.
 631:../../os/rt/src/chthreads.c ****  * @post    The specified thread will terminate after detecting the termination
 632:../../os/rt/src/chthreads.c ****  *          condition.
 633:../../os/rt/src/chthreads.c ****  *
 634:../../os/rt/src/chthreads.c ****  * @param[in] tp        pointer to the thread
 635:../../os/rt/src/chthreads.c ****  *
 636:../../os/rt/src/chthreads.c ****  * @api
 637:../../os/rt/src/chthreads.c ****  */
 638:../../os/rt/src/chthreads.c **** void chThdTerminate(thread_t *tp) {
 1162               		.loc 1 638 0
 1163               		.cfi_startproc
 1164               	.LVL85:
 1165               	/* prologue: function */
 1166               	/* frame size = 0 */
 1167               	/* stack size = 0 */
 1168               	.L__stack_usage = 0
 1169 0000 FC01      		movw r30,r24
 1170               	.LBB347:
 1171               	.LBB348:
 1172               	.LBB349:
 430:../../os/common/ports/AVR/chcore.h **** }
 1173               		.loc 3 430 0
 1174               	/* #APP */
 1175               	 ;  430 "../../os/common/ports/AVR/chcore.h" 1
 1176 0002 F894      		cli
 1177               	 ;  0 "" 2
 1178               	/* #NOAPP */
 1179               	.LBE349:
 1180               	.LBE348:
 1181               	.LBE347:
 639:../../os/rt/src/chthreads.c **** 
 640:../../os/rt/src/chthreads.c ****   chSysLock();
 641:../../os/rt/src/chthreads.c ****   tp->flags |= CH_FLAG_TERMINATE;
 1182               		.loc 1 641 0
 1183 0004 9089      		ldd r25,Z+16
 1184 0006 9460      		ori r25,lo8(4)
 1185 0008 908B      		std Z+16,r25
 1186               	.LBB350:
 1187               	.LBB351:
 1188               	.LBB352:
 1189               	.LBB353:
 1190               		.loc 3 440 0
 1191               	/* #APP */
 1192               	 ;  440 "../../os/common/ports/AVR/chcore.h" 1
 1193 000a 7894      		sei
 1194               	 ;  0 "" 2
 1195               	/* epilogue start */
 1196               	/* #NOAPP */
 1197               	.LBE353:
 1198               	.LBE352:
 1199               	.LBE351:
 1200               	.LBE350:
 642:../../os/rt/src/chthreads.c ****   chSysUnlock();
 643:../../os/rt/src/chthreads.c **** }
 1201               		.loc 1 643 0
 1202 000c 0895      		ret
 1203               		.cfi_endproc
 1204               	.LFE203:
 1206               		.section	.text.chThdSleep,"ax",@progbits
 1207               	.global	chThdSleep
 1209               	chThdSleep:
 1210               	.LFB204:
 644:../../os/rt/src/chthreads.c **** 
 645:../../os/rt/src/chthreads.c **** /**
 646:../../os/rt/src/chthreads.c ****  * @brief   Suspends the invoking thread for the specified time.
 647:../../os/rt/src/chthreads.c ****  *
 648:../../os/rt/src/chthreads.c ****  * @param[in] time      the delay in system ticks, the special values are
 649:../../os/rt/src/chthreads.c ****  *                      handled as follow:
 650:../../os/rt/src/chthreads.c ****  *                      - @a TIME_INFINITE the thread enters an infinite sleep
 651:../../os/rt/src/chthreads.c ****  *                        state.
 652:../../os/rt/src/chthreads.c ****  *                      - @a TIME_IMMEDIATE this value is not allowed.
 653:../../os/rt/src/chthreads.c ****  *                      .
 654:../../os/rt/src/chthreads.c ****  *
 655:../../os/rt/src/chthreads.c ****  * @api
 656:../../os/rt/src/chthreads.c ****  */
 657:../../os/rt/src/chthreads.c **** void chThdSleep(sysinterval_t time) {
 1211               		.loc 1 657 0
 1212               		.cfi_startproc
 1213               	.LVL86:
 1214               	/* prologue: function */
 1215               	/* frame size = 0 */
 1216               	/* stack size = 0 */
 1217               	.L__stack_usage = 0
 1218               	.LBB354:
 1219               	.LBB355:
 1220               	.LBB356:
 430:../../os/common/ports/AVR/chcore.h **** }
 1221               		.loc 3 430 0
 1222               	/* #APP */
 1223               	 ;  430 "../../os/common/ports/AVR/chcore.h" 1
 1224 0000 F894      		cli
 1225               	 ;  0 "" 2
 1226               	.LVL87:
 1227               	/* #NOAPP */
 1228               	.LBE356:
 1229               	.LBE355:
 1230               	.LBE354:
 1231               	.LBB357:
 1232               	.LBB358:
 344:../../os/rt/include/chthreads.h **** }
 345:../../os/rt/include/chthreads.h **** 
 346:../../os/rt/include/chthreads.h **** /**
 347:../../os/rt/include/chthreads.h ****  * @brief   Returns the current thread priority.
 348:../../os/rt/include/chthreads.h ****  * @note    Can be invoked in any context.
 349:../../os/rt/include/chthreads.h ****  *
 350:../../os/rt/include/chthreads.h ****  * @return              The current thread priority.
 351:../../os/rt/include/chthreads.h ****  *
 352:../../os/rt/include/chthreads.h ****  * @xclass
 353:../../os/rt/include/chthreads.h ****  */
 354:../../os/rt/include/chthreads.h **** static inline tprio_t chThdGetPriorityX(void) {
 355:../../os/rt/include/chthreads.h **** 
 356:../../os/rt/include/chthreads.h ****   return chThdGetSelfX()->hdr.pqueue.prio;
 357:../../os/rt/include/chthreads.h **** }
 358:../../os/rt/include/chthreads.h **** 
 359:../../os/rt/include/chthreads.h **** /**
 360:../../os/rt/include/chthreads.h ****  * @brief   Returns the number of ticks consumed by the specified thread.
 361:../../os/rt/include/chthreads.h ****  * @note    This function is only available when the
 362:../../os/rt/include/chthreads.h ****  *          @p CH_DBG_THREADS_PROFILING configuration option is enabled.
 363:../../os/rt/include/chthreads.h ****  *
 364:../../os/rt/include/chthreads.h ****  * @param[in] tp        pointer to the thread
 365:../../os/rt/include/chthreads.h ****  * @return              The number of consumed system ticks.
 366:../../os/rt/include/chthreads.h ****  *
 367:../../os/rt/include/chthreads.h ****  * @xclass
 368:../../os/rt/include/chthreads.h ****  */
 369:../../os/rt/include/chthreads.h **** #if (CH_DBG_THREADS_PROFILING == TRUE) || defined(__DOXYGEN__)
 370:../../os/rt/include/chthreads.h **** static inline systime_t chThdGetTicksX(thread_t *tp) {
 371:../../os/rt/include/chthreads.h **** 
 372:../../os/rt/include/chthreads.h ****   return tp->time;
 373:../../os/rt/include/chthreads.h **** }
 374:../../os/rt/include/chthreads.h **** #endif
 375:../../os/rt/include/chthreads.h **** 
 376:../../os/rt/include/chthreads.h **** #if (CH_DBG_ENABLE_STACK_CHECK == TRUE) || (CH_CFG_USE_DYNAMIC == TRUE) ||  \
 377:../../os/rt/include/chthreads.h ****     defined(__DOXYGEN__)
 378:../../os/rt/include/chthreads.h **** /**
 379:../../os/rt/include/chthreads.h ****  * @brief   Returns the working area base of the specified thread.
 380:../../os/rt/include/chthreads.h ****  *
 381:../../os/rt/include/chthreads.h ****  * @param[in] tp        pointer to the thread
 382:../../os/rt/include/chthreads.h ****  * @return              The working area base pointer.
 383:../../os/rt/include/chthreads.h ****  *
 384:../../os/rt/include/chthreads.h ****  * @xclass
 385:../../os/rt/include/chthreads.h ****  */
 386:../../os/rt/include/chthreads.h **** static inline stkalign_t *chThdGetWorkingAreaX(thread_t *tp) {
 387:../../os/rt/include/chthreads.h **** 
 388:../../os/rt/include/chthreads.h ****   return tp->wabase;
 389:../../os/rt/include/chthreads.h **** }
 390:../../os/rt/include/chthreads.h **** #endif /* CH_DBG_ENABLE_STACK_CHECK == TRUE */
 391:../../os/rt/include/chthreads.h **** 
 392:../../os/rt/include/chthreads.h **** /**
 393:../../os/rt/include/chthreads.h ****  * @brief   Verifies if the specified thread is in the @p CH_STATE_FINAL state.
 394:../../os/rt/include/chthreads.h ****  *
 395:../../os/rt/include/chthreads.h ****  * @param[in] tp        pointer to the thread
 396:../../os/rt/include/chthreads.h ****  * @retval true         thread terminated.
 397:../../os/rt/include/chthreads.h ****  * @retval false        thread not terminated.
 398:../../os/rt/include/chthreads.h ****  *
 399:../../os/rt/include/chthreads.h ****  * @xclass
 400:../../os/rt/include/chthreads.h ****  */
 401:../../os/rt/include/chthreads.h **** static inline bool chThdTerminatedX(thread_t *tp) {
 402:../../os/rt/include/chthreads.h **** 
 403:../../os/rt/include/chthreads.h ****   return (bool)(tp->state == CH_STATE_FINAL);
 404:../../os/rt/include/chthreads.h **** }
 405:../../os/rt/include/chthreads.h **** 
 406:../../os/rt/include/chthreads.h **** /**
 407:../../os/rt/include/chthreads.h ****  * @brief   Verifies if the current thread has a termination request pending.
 408:../../os/rt/include/chthreads.h ****  *
 409:../../os/rt/include/chthreads.h ****  * @retval true         termination request pending.
 410:../../os/rt/include/chthreads.h ****  * @retval false        termination request not pending.
 411:../../os/rt/include/chthreads.h ****  *
 412:../../os/rt/include/chthreads.h ****  * @xclass
 413:../../os/rt/include/chthreads.h ****  */
 414:../../os/rt/include/chthreads.h **** static inline bool chThdShouldTerminateX(void) {
 415:../../os/rt/include/chthreads.h **** 
 416:../../os/rt/include/chthreads.h ****   return (bool)((chThdGetSelfX()->flags & CH_FLAG_TERMINATE) != (tmode_t)0);
 417:../../os/rt/include/chthreads.h **** }
 418:../../os/rt/include/chthreads.h **** 
 419:../../os/rt/include/chthreads.h **** /**
 420:../../os/rt/include/chthreads.h ****  * @brief   Resumes a thread created with @p chThdCreateI().
 421:../../os/rt/include/chthreads.h ****  *
 422:../../os/rt/include/chthreads.h ****  * @param[in] tp        pointer to the thread
 423:../../os/rt/include/chthreads.h ****  * @return              The pointer to the @p thread_t structure allocated for
 424:../../os/rt/include/chthreads.h ****  *                      the thread into the working space area.
 425:../../os/rt/include/chthreads.h ****  *
 426:../../os/rt/include/chthreads.h ****  * @iclass
 427:../../os/rt/include/chthreads.h ****  */
 428:../../os/rt/include/chthreads.h **** static inline thread_t *chThdStartI(thread_t *tp) {
 429:../../os/rt/include/chthreads.h **** 
 430:../../os/rt/include/chthreads.h ****   chDbgAssert(tp->state == CH_STATE_WTSTART, "wrong state");
 431:../../os/rt/include/chthreads.h **** 
 432:../../os/rt/include/chthreads.h ****   return chSchReadyI(tp);
 433:../../os/rt/include/chthreads.h **** }
 434:../../os/rt/include/chthreads.h **** 
 435:../../os/rt/include/chthreads.h **** /**
 436:../../os/rt/include/chthreads.h ****  * @brief   Suspends the invoking thread for the specified number of ticks.
 437:../../os/rt/include/chthreads.h ****  *
 438:../../os/rt/include/chthreads.h ****  * @param[in] ticks     the delay in system ticks, the special values are
 439:../../os/rt/include/chthreads.h ****  *                      handled as follow:
 440:../../os/rt/include/chthreads.h ****  *                      - @a TIME_INFINITE the thread enters an infinite sleep
 441:../../os/rt/include/chthreads.h ****  *                        state.
 442:../../os/rt/include/chthreads.h ****  *                      - @a TIME_IMMEDIATE this value is not allowed.
 443:../../os/rt/include/chthreads.h ****  *                      .
 444:../../os/rt/include/chthreads.h ****  *
 445:../../os/rt/include/chthreads.h ****  * @sclass
 446:../../os/rt/include/chthreads.h ****  */
 447:../../os/rt/include/chthreads.h **** static inline void chThdSleepS(sysinterval_t ticks) {
 448:../../os/rt/include/chthreads.h **** 
 449:../../os/rt/include/chthreads.h ****   chDbgCheck(ticks != TIME_IMMEDIATE);
 450:../../os/rt/include/chthreads.h **** 
 451:../../os/rt/include/chthreads.h ****   (void) chSchGoSleepTimeoutS(CH_STATE_SLEEPING, ticks);
 1233               		.loc 4 451 0
 1234 0002 BC01      		movw r22,r24
 1235 0004 88E0      		ldi r24,lo8(8)
 1236               	.LVL88:
 1237 0006 0E94 0000 		call chSchGoSleepTimeoutS
 1238               	.LVL89:
 1239               	.LBE358:
 1240               	.LBE357:
 1241               	.LBB359:
 1242               	.LBB360:
 1243               	.LBB361:
 1244               	.LBB362:
 1245               		.loc 3 440 0
 1246               	/* #APP */
 1247               	 ;  440 "../../os/common/ports/AVR/chcore.h" 1
 1248 000a 7894      		sei
 1249               	 ;  0 "" 2
 1250               	/* epilogue start */
 1251               	/* #NOAPP */
 1252               	.LBE362:
 1253               	.LBE361:
 1254               	.LBE360:
 1255               	.LBE359:
 658:../../os/rt/src/chthreads.c **** 
 659:../../os/rt/src/chthreads.c ****   chSysLock();
 660:../../os/rt/src/chthreads.c ****   chThdSleepS(time);
 661:../../os/rt/src/chthreads.c ****   chSysUnlock();
 662:../../os/rt/src/chthreads.c **** }
 1256               		.loc 1 662 0
 1257 000c 0895      		ret
 1258               		.cfi_endproc
 1259               	.LFE204:
 1261               		.section	.text.chThdSleepUntil,"ax",@progbits
 1262               	.global	chThdSleepUntil
 1264               	chThdSleepUntil:
 1265               	.LFB205:
 663:../../os/rt/src/chthreads.c **** 
 664:../../os/rt/src/chthreads.c **** /**
 665:../../os/rt/src/chthreads.c ****  * @brief   Suspends the invoking thread until the system time arrives to the
 666:../../os/rt/src/chthreads.c ****  *          specified value.
 667:../../os/rt/src/chthreads.c ****  * @note    The function has no concept of "past", all specifiable times
 668:../../os/rt/src/chthreads.c ****  *          are in the future, this means that if you call this function
 669:../../os/rt/src/chthreads.c ****  *          exceeding your calculated intervals then the function will
 670:../../os/rt/src/chthreads.c ****  *          return in a far future time, not immediately.
 671:../../os/rt/src/chthreads.c ****  * @see     chThdSleepUntilWindowed()
 672:../../os/rt/src/chthreads.c ****  *
 673:../../os/rt/src/chthreads.c ****  * @param[in] time      absolute system time
 674:../../os/rt/src/chthreads.c ****  *
 675:../../os/rt/src/chthreads.c ****  * @api
 676:../../os/rt/src/chthreads.c ****  */
 677:../../os/rt/src/chthreads.c **** void chThdSleepUntil(systime_t time) {
 1266               		.loc 1 677 0
 1267               		.cfi_startproc
 1268               	.LVL90:
 1269               	/* prologue: function */
 1270               	/* frame size = 0 */
 1271               	/* stack size = 0 */
 1272               	.L__stack_usage = 0
 1273               	.LBB363:
 1274               	.LBB364:
 1275               	.LBB365:
 430:../../os/common/ports/AVR/chcore.h **** }
 1276               		.loc 3 430 0
 1277               	/* #APP */
 1278               	 ;  430 "../../os/common/ports/AVR/chcore.h" 1
 1279 0000 F894      		cli
 1280               	 ;  0 "" 2
 1281               	/* #NOAPP */
 1282               	.LBE365:
 1283               	.LBE364:
 1284               	.LBE363:
 1285               	.LBB366:
 1286               	.LBB367:
 1287               		.file 5 "../../os/rt/include/chvt.h"
   1:../../os/rt/include/chvt.h **** /*
   2:../../os/rt/include/chvt.h ****     ChibiOS - Copyright (C) 2006,2007,2008,2009,2010,2011,2012,2013,2014,
   3:../../os/rt/include/chvt.h ****               2015,2016,2017,2018,2019,2020,2021 Giovanni Di Sirio.
   4:../../os/rt/include/chvt.h **** 
   5:../../os/rt/include/chvt.h ****     This file is part of ChibiOS.
   6:../../os/rt/include/chvt.h **** 
   7:../../os/rt/include/chvt.h ****     ChibiOS is free software; you can redistribute it and/or modify
   8:../../os/rt/include/chvt.h ****     it under the terms of the GNU General Public License as published by
   9:../../os/rt/include/chvt.h ****     the Free Software Foundation version 3 of the License.
  10:../../os/rt/include/chvt.h **** 
  11:../../os/rt/include/chvt.h ****     ChibiOS is distributed in the hope that it will be useful,
  12:../../os/rt/include/chvt.h ****     but WITHOUT ANY WARRANTY; without even the implied warranty of
  13:../../os/rt/include/chvt.h ****     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  14:../../os/rt/include/chvt.h ****     GNU General Public License for more details.
  15:../../os/rt/include/chvt.h **** 
  16:../../os/rt/include/chvt.h ****     You should have received a copy of the GNU General Public License
  17:../../os/rt/include/chvt.h ****     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  18:../../os/rt/include/chvt.h **** */
  19:../../os/rt/include/chvt.h **** 
  20:../../os/rt/include/chvt.h **** /**
  21:../../os/rt/include/chvt.h ****  * @file    rt/include/chvt.h
  22:../../os/rt/include/chvt.h ****  * @brief   Time and Virtual Timers module macros and structures.
  23:../../os/rt/include/chvt.h ****  *
  24:../../os/rt/include/chvt.h ****  * @addtogroup time
  25:../../os/rt/include/chvt.h ****  * @{
  26:../../os/rt/include/chvt.h ****  */
  27:../../os/rt/include/chvt.h **** 
  28:../../os/rt/include/chvt.h **** #ifndef CHVT_H
  29:../../os/rt/include/chvt.h **** #define CHVT_H
  30:../../os/rt/include/chvt.h **** 
  31:../../os/rt/include/chvt.h **** /*===========================================================================*/
  32:../../os/rt/include/chvt.h **** /* Module constants.                                                         */
  33:../../os/rt/include/chvt.h **** /*===========================================================================*/
  34:../../os/rt/include/chvt.h **** 
  35:../../os/rt/include/chvt.h **** /*===========================================================================*/
  36:../../os/rt/include/chvt.h **** /* Module pre-compile time settings.                                         */
  37:../../os/rt/include/chvt.h **** /*===========================================================================*/
  38:../../os/rt/include/chvt.h **** 
  39:../../os/rt/include/chvt.h **** /*===========================================================================*/
  40:../../os/rt/include/chvt.h **** /* Derived constants and error checks.                                       */
  41:../../os/rt/include/chvt.h **** /*===========================================================================*/
  42:../../os/rt/include/chvt.h **** 
  43:../../os/rt/include/chvt.h **** #if (CH_CFG_ST_TIMEDELTA < 0) || (CH_CFG_ST_TIMEDELTA == 1)
  44:../../os/rt/include/chvt.h **** #error "invalid CH_CFG_ST_TIMEDELTA specified, must "                       \
  45:../../os/rt/include/chvt.h ****        "be zero or greater than one"
  46:../../os/rt/include/chvt.h **** #endif
  47:../../os/rt/include/chvt.h **** 
  48:../../os/rt/include/chvt.h **** #if (CH_CFG_ST_TIMEDELTA > 0) && (CH_CFG_TIME_QUANTUM > 0)
  49:../../os/rt/include/chvt.h **** #error "CH_CFG_TIME_QUANTUM not supported in tickless mode"
  50:../../os/rt/include/chvt.h **** #endif
  51:../../os/rt/include/chvt.h **** 
  52:../../os/rt/include/chvt.h **** #if (CH_CFG_ST_TIMEDELTA > 0) && (CH_DBG_THREADS_PROFILING == TRUE)
  53:../../os/rt/include/chvt.h **** #error "CH_DBG_THREADS_PROFILING not supported in tickless mode"
  54:../../os/rt/include/chvt.h **** #endif
  55:../../os/rt/include/chvt.h **** 
  56:../../os/rt/include/chvt.h **** /*===========================================================================*/
  57:../../os/rt/include/chvt.h **** /* Module data structures and types.                                         */
  58:../../os/rt/include/chvt.h **** /*===========================================================================*/
  59:../../os/rt/include/chvt.h **** 
  60:../../os/rt/include/chvt.h **** /*===========================================================================*/
  61:../../os/rt/include/chvt.h **** /* Module macros.                                                            */
  62:../../os/rt/include/chvt.h **** /*===========================================================================*/
  63:../../os/rt/include/chvt.h **** 
  64:../../os/rt/include/chvt.h **** /*===========================================================================*/
  65:../../os/rt/include/chvt.h **** /* External declarations.                                                    */
  66:../../os/rt/include/chvt.h **** /*===========================================================================*/
  67:../../os/rt/include/chvt.h **** 
  68:../../os/rt/include/chvt.h **** /*
  69:../../os/rt/include/chvt.h ****  * Virtual Timers APIs.
  70:../../os/rt/include/chvt.h ****  */
  71:../../os/rt/include/chvt.h **** #ifdef __cplusplus
  72:../../os/rt/include/chvt.h **** extern "C" {
  73:../../os/rt/include/chvt.h **** #endif
  74:../../os/rt/include/chvt.h ****   void chVTDoSetI(virtual_timer_t *vtp, sysinterval_t delay,
  75:../../os/rt/include/chvt.h ****                   vtfunc_t vtfunc, void *par);
  76:../../os/rt/include/chvt.h ****   void chVTDoSetContinuousI(virtual_timer_t *vtp, sysinterval_t delay,
  77:../../os/rt/include/chvt.h ****                             vtfunc_t vtfunc, void *par);
  78:../../os/rt/include/chvt.h ****   void chVTDoResetI(virtual_timer_t *vtp);
  79:../../os/rt/include/chvt.h ****   sysinterval_t chVTGetRemainingIntervalI(virtual_timer_t *vtp);
  80:../../os/rt/include/chvt.h ****   void chVTDoTickI(void);
  81:../../os/rt/include/chvt.h **** #if CH_CFG_USE_TIMESTAMP == TRUE
  82:../../os/rt/include/chvt.h ****   systimestamp_t chVTGetTimeStampI(void);
  83:../../os/rt/include/chvt.h ****   void chVTResetTimeStampI(void);
  84:../../os/rt/include/chvt.h **** #endif
  85:../../os/rt/include/chvt.h **** #ifdef __cplusplus
  86:../../os/rt/include/chvt.h **** }
  87:../../os/rt/include/chvt.h **** #endif
  88:../../os/rt/include/chvt.h **** 
  89:../../os/rt/include/chvt.h **** /*===========================================================================*/
  90:../../os/rt/include/chvt.h **** /* Module inline functions.                                                  */
  91:../../os/rt/include/chvt.h **** /*===========================================================================*/
  92:../../os/rt/include/chvt.h **** 
  93:../../os/rt/include/chvt.h **** /**
  94:../../os/rt/include/chvt.h ****  * @brief   Initializes a @p virtual_timer_t object.
  95:../../os/rt/include/chvt.h ****  * @note    Initializing a timer object is not strictly required because
  96:../../os/rt/include/chvt.h ****  *          the function @p chVTSetI() initializes the object too. This
  97:../../os/rt/include/chvt.h ****  *          function is only useful if you need to perform a @p chVTIsArmed()
  98:../../os/rt/include/chvt.h ****  *          check before calling @p chVTSetI().
  99:../../os/rt/include/chvt.h ****  *
 100:../../os/rt/include/chvt.h ****  * @param[out] vtp      the @p virtual_timer_t structure pointer
 101:../../os/rt/include/chvt.h ****  *
 102:../../os/rt/include/chvt.h ****  * @init
 103:../../os/rt/include/chvt.h ****  */
 104:../../os/rt/include/chvt.h **** static inline void chVTObjectInit(virtual_timer_t *vtp) {
 105:../../os/rt/include/chvt.h **** 
 106:../../os/rt/include/chvt.h ****   vtp->dlist.next = NULL;
 107:../../os/rt/include/chvt.h **** }
 108:../../os/rt/include/chvt.h **** 
 109:../../os/rt/include/chvt.h **** /**
 110:../../os/rt/include/chvt.h ****  * @brief   Current system time.
 111:../../os/rt/include/chvt.h ****  * @details Returns the number of system ticks since the @p chSysInit()
 112:../../os/rt/include/chvt.h ****  *          invocation.
 113:../../os/rt/include/chvt.h ****  * @note    The counter can reach its maximum and then restart from zero.
 114:../../os/rt/include/chvt.h ****  * @note    This function can be called from any context but its atomicity
 115:../../os/rt/include/chvt.h ****  *          is not guaranteed on architectures whose word size is less than
 116:../../os/rt/include/chvt.h ****  *          @p systime_t size.
 117:../../os/rt/include/chvt.h ****  *
 118:../../os/rt/include/chvt.h ****  * @return              The system time in ticks.
 119:../../os/rt/include/chvt.h ****  *
 120:../../os/rt/include/chvt.h ****  * @xclass
 121:../../os/rt/include/chvt.h ****  */
 122:../../os/rt/include/chvt.h **** static inline systime_t chVTGetSystemTimeX(void) {
 123:../../os/rt/include/chvt.h **** 
 124:../../os/rt/include/chvt.h **** #if CH_CFG_ST_TIMEDELTA == 0
 125:../../os/rt/include/chvt.h ****   return currcore->vtlist.systime;
 1288               		.loc 5 125 0
 1289 0002 2091 0000 		lds r18,ch0+13
 1290 0006 3091 0000 		lds r19,ch0+13+1
 1291               	.LVL91:
 1292               	.LBE367:
 1293               	.LBE366:
 1294               	.LBB368:
 1295               	.LBB369:
 1296               		.file 6 "../../os/rt/include/chtime.h"
   1:../../os/rt/include/chtime.h **** /*
   2:../../os/rt/include/chtime.h ****     ChibiOS - Copyright (C) 2006,2007,2008,2009,2010,2011,2012,2013,2014,
   3:../../os/rt/include/chtime.h ****               2015,2016,2017,2018,2019,2020,2021 Giovanni Di Sirio.
   4:../../os/rt/include/chtime.h **** 
   5:../../os/rt/include/chtime.h ****     This file is part of ChibiOS.
   6:../../os/rt/include/chtime.h **** 
   7:../../os/rt/include/chtime.h ****     ChibiOS is free software; you can redistribute it and/or modify
   8:../../os/rt/include/chtime.h ****     it under the terms of the GNU General Public License as published by
   9:../../os/rt/include/chtime.h ****     the Free Software Foundation version 3 of the License.
  10:../../os/rt/include/chtime.h **** 
  11:../../os/rt/include/chtime.h ****     ChibiOS is distributed in the hope that it will be useful,
  12:../../os/rt/include/chtime.h ****     but WITHOUT ANY WARRANTY; without even the implied warranty of
  13:../../os/rt/include/chtime.h ****     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  14:../../os/rt/include/chtime.h ****     GNU General Public License for more details.
  15:../../os/rt/include/chtime.h **** 
  16:../../os/rt/include/chtime.h ****     You should have received a copy of the GNU General Public License
  17:../../os/rt/include/chtime.h ****     along with this program.  If not, see <http://www.gnu.org/licenses/>.
  18:../../os/rt/include/chtime.h **** */
  19:../../os/rt/include/chtime.h **** 
  20:../../os/rt/include/chtime.h **** /**
  21:../../os/rt/include/chtime.h ****  * @file    rt/include/chtime.h
  22:../../os/rt/include/chtime.h ****  * @brief   Time and intervals macros and structures.
  23:../../os/rt/include/chtime.h ****  *
  24:../../os/rt/include/chtime.h ****  * @addtogroup time_intervals
  25:../../os/rt/include/chtime.h ****  * @details This module is responsible for handling of system time and time
  26:../../os/rt/include/chtime.h ****  *          intervals.
  27:../../os/rt/include/chtime.h ****  * @{
  28:../../os/rt/include/chtime.h ****  */
  29:../../os/rt/include/chtime.h **** 
  30:../../os/rt/include/chtime.h **** #ifndef CHTIME_H
  31:../../os/rt/include/chtime.h **** #define CHTIME_H
  32:../../os/rt/include/chtime.h **** 
  33:../../os/rt/include/chtime.h **** /*===========================================================================*/
  34:../../os/rt/include/chtime.h **** /* Module constants.                                                         */
  35:../../os/rt/include/chtime.h **** /*===========================================================================*/
  36:../../os/rt/include/chtime.h **** 
  37:../../os/rt/include/chtime.h **** /**
  38:../../os/rt/include/chtime.h ****  * @name    Special time constants
  39:../../os/rt/include/chtime.h ****  * @{
  40:../../os/rt/include/chtime.h ****  */
  41:../../os/rt/include/chtime.h **** /**
  42:../../os/rt/include/chtime.h ****  * @brief   Zero interval specification for some functions with a timeout
  43:../../os/rt/include/chtime.h ****  *          specification.
  44:../../os/rt/include/chtime.h ****  * @note    Not all functions accept @p TIME_IMMEDIATE as timeout parameter,
  45:../../os/rt/include/chtime.h ****  *          see the specific function documentation.
  46:../../os/rt/include/chtime.h ****  */
  47:../../os/rt/include/chtime.h **** #define TIME_IMMEDIATE      ((sysinterval_t)0)
  48:../../os/rt/include/chtime.h **** 
  49:../../os/rt/include/chtime.h **** /**
  50:../../os/rt/include/chtime.h ****  * @brief   Infinite interval specification for all functions with a timeout
  51:../../os/rt/include/chtime.h ****  *          specification.
  52:../../os/rt/include/chtime.h ****  * @note    Not all functions accept @p TIME_INFINITE as timeout parameter,
  53:../../os/rt/include/chtime.h ****  *          see the specific function documentation.
  54:../../os/rt/include/chtime.h ****  */
  55:../../os/rt/include/chtime.h **** #define TIME_INFINITE       ((sysinterval_t)-1)
  56:../../os/rt/include/chtime.h **** 
  57:../../os/rt/include/chtime.h **** /**
  58:../../os/rt/include/chtime.h ****  * @brief   Maximum interval constant usable as timeout.
  59:../../os/rt/include/chtime.h ****  */
  60:../../os/rt/include/chtime.h **** #define TIME_MAX_INTERVAL   ((sysinterval_t)-2)
  61:../../os/rt/include/chtime.h **** 
  62:../../os/rt/include/chtime.h **** /**
  63:../../os/rt/include/chtime.h ****  * @brief   Maximum system of system time before it wraps.
  64:../../os/rt/include/chtime.h ****  */
  65:../../os/rt/include/chtime.h **** #define TIME_MAX_SYSTIME    ((systime_t)-1)
  66:../../os/rt/include/chtime.h **** /** @} */
  67:../../os/rt/include/chtime.h **** 
  68:../../os/rt/include/chtime.h **** /*===========================================================================*/
  69:../../os/rt/include/chtime.h **** /* Module pre-compile time settings.                                         */
  70:../../os/rt/include/chtime.h **** /*===========================================================================*/
  71:../../os/rt/include/chtime.h **** 
  72:../../os/rt/include/chtime.h **** /*===========================================================================*/
  73:../../os/rt/include/chtime.h **** /* Derived constants and error checks.                                       */
  74:../../os/rt/include/chtime.h **** /*===========================================================================*/
  75:../../os/rt/include/chtime.h **** 
  76:../../os/rt/include/chtime.h **** #if (CH_CFG_ST_RESOLUTION != 16) && (CH_CFG_ST_RESOLUTION != 32) &&         \
  77:../../os/rt/include/chtime.h ****     (CH_CFG_ST_RESOLUTION != 64)
  78:../../os/rt/include/chtime.h **** #error "invalid CH_CFG_ST_RESOLUTION specified, must be 16, 32 or 64"
  79:../../os/rt/include/chtime.h **** #endif
  80:../../os/rt/include/chtime.h **** 
  81:../../os/rt/include/chtime.h **** #if CH_CFG_ST_FREQUENCY < 10
  82:../../os/rt/include/chtime.h **** #error "invalid CH_CFG_ST_FREQUENCY specified, must be >= 10"
  83:../../os/rt/include/chtime.h **** #endif
  84:../../os/rt/include/chtime.h **** 
  85:../../os/rt/include/chtime.h **** #if (CH_CFG_INTERVALS_SIZE != 16) && (CH_CFG_INTERVALS_SIZE != 32) &&       \
  86:../../os/rt/include/chtime.h ****     (CH_CFG_INTERVALS_SIZE != 64)
  87:../../os/rt/include/chtime.h **** #error "invalid CH_CFG_INTERVALS_SIZE specified, must be 16, 32 or 64"
  88:../../os/rt/include/chtime.h **** #endif
  89:../../os/rt/include/chtime.h **** 
  90:../../os/rt/include/chtime.h **** #if (CH_CFG_TIME_TYPES_SIZE != 16) && (CH_CFG_TIME_TYPES_SIZE != 32)
  91:../../os/rt/include/chtime.h **** #error "invalid CH_CFG_TIME_TYPES_SIZE specified, must be 16 or 32"
  92:../../os/rt/include/chtime.h **** #endif
  93:../../os/rt/include/chtime.h **** 
  94:../../os/rt/include/chtime.h **** #if CH_CFG_INTERVALS_SIZE < CH_CFG_ST_RESOLUTION
  95:../../os/rt/include/chtime.h **** #error "CH_CFG_INTERVALS_SIZE must be >= CH_CFG_ST_RESOLUTION"
  96:../../os/rt/include/chtime.h **** #endif
  97:../../os/rt/include/chtime.h **** 
  98:../../os/rt/include/chtime.h **** /*===========================================================================*/
  99:../../os/rt/include/chtime.h **** /* Module data structures and types.                                         */
 100:../../os/rt/include/chtime.h **** /*===========================================================================*/
 101:../../os/rt/include/chtime.h **** 
 102:../../os/rt/include/chtime.h **** /**
 103:../../os/rt/include/chtime.h ****  * @brief   Type of system time.
 104:../../os/rt/include/chtime.h ****  * @note    It is selectable in configuration between 16, 32 or 64 bits.
 105:../../os/rt/include/chtime.h ****  */
 106:../../os/rt/include/chtime.h **** #if (CH_CFG_ST_RESOLUTION == 64) || defined(__DOXYGEN__)
 107:../../os/rt/include/chtime.h **** typedef uint64_t systime_t;
 108:../../os/rt/include/chtime.h **** #elif CH_CFG_ST_RESOLUTION == 32
 109:../../os/rt/include/chtime.h **** typedef uint32_t systime_t;
 110:../../os/rt/include/chtime.h **** #elif CH_CFG_ST_RESOLUTION == 16
 111:../../os/rt/include/chtime.h **** typedef uint16_t systime_t;
 112:../../os/rt/include/chtime.h **** #endif
 113:../../os/rt/include/chtime.h **** 
 114:../../os/rt/include/chtime.h **** /**
 115:../../os/rt/include/chtime.h ****  * @brief   Type of time interval.
 116:../../os/rt/include/chtime.h ****  * @note    It is selectable in configuration between 16, 32 or 64 bits.
 117:../../os/rt/include/chtime.h ****  */
 118:../../os/rt/include/chtime.h **** #if (CH_CFG_INTERVALS_SIZE == 64) || defined(__DOXYGEN__)
 119:../../os/rt/include/chtime.h **** typedef uint64_t sysinterval_t;
 120:../../os/rt/include/chtime.h **** #elif CH_CFG_INTERVALS_SIZE == 32
 121:../../os/rt/include/chtime.h **** typedef uint32_t sysinterval_t;
 122:../../os/rt/include/chtime.h **** #elif CH_CFG_INTERVALS_SIZE == 16
 123:../../os/rt/include/chtime.h **** typedef uint16_t sysinterval_t;
 124:../../os/rt/include/chtime.h **** #endif
 125:../../os/rt/include/chtime.h **** 
 126:../../os/rt/include/chtime.h **** /**
 127:../../os/rt/include/chtime.h ****  * @brief   Type of a time stamp.
 128:../../os/rt/include/chtime.h ****  */
 129:../../os/rt/include/chtime.h **** typedef uint64_t systimestamp_t;
 130:../../os/rt/include/chtime.h **** 
 131:../../os/rt/include/chtime.h **** #if (CH_CFG_TIME_TYPES_SIZE == 32) || defined(__DOXYGEN__)
 132:../../os/rt/include/chtime.h **** /**
 133:../../os/rt/include/chtime.h ****  * @brief   Type of seconds.
 134:../../os/rt/include/chtime.h ****  * @note    It is selectable in configuration between 16 or 32 bits.
 135:../../os/rt/include/chtime.h ****  */
 136:../../os/rt/include/chtime.h **** typedef uint32_t time_secs_t;
 137:../../os/rt/include/chtime.h **** 
 138:../../os/rt/include/chtime.h **** /**
 139:../../os/rt/include/chtime.h ****  * @brief   Type of milliseconds.
 140:../../os/rt/include/chtime.h ****  * @note    It is selectable in configuration between 16 or 32 bits.
 141:../../os/rt/include/chtime.h ****  */
 142:../../os/rt/include/chtime.h **** typedef uint32_t time_msecs_t;
 143:../../os/rt/include/chtime.h **** 
 144:../../os/rt/include/chtime.h **** /**
 145:../../os/rt/include/chtime.h ****  * @brief   Type of microseconds.
 146:../../os/rt/include/chtime.h ****  * @note    It is selectable in configuration between 16 or 32 bits.
 147:../../os/rt/include/chtime.h ****  */
 148:../../os/rt/include/chtime.h **** typedef uint32_t time_usecs_t;
 149:../../os/rt/include/chtime.h **** 
 150:../../os/rt/include/chtime.h **** /**
 151:../../os/rt/include/chtime.h ****  * @brief   Type of time conversion variable.
 152:../../os/rt/include/chtime.h ****  * @note    This type must have double width than other time types, it is
 153:../../os/rt/include/chtime.h ****  *          only used internally for conversions.
 154:../../os/rt/include/chtime.h ****  */
 155:../../os/rt/include/chtime.h **** typedef uint64_t time_conv_t;
 156:../../os/rt/include/chtime.h **** 
 157:../../os/rt/include/chtime.h **** #else
 158:../../os/rt/include/chtime.h **** typedef uint16_t time_secs_t;
 159:../../os/rt/include/chtime.h **** typedef uint16_t time_msecs_t;
 160:../../os/rt/include/chtime.h **** typedef uint16_t time_usecs_t;
 161:../../os/rt/include/chtime.h **** typedef uint32_t time_conv_t;
 162:../../os/rt/include/chtime.h **** #endif
 163:../../os/rt/include/chtime.h **** 
 164:../../os/rt/include/chtime.h **** /*===========================================================================*/
 165:../../os/rt/include/chtime.h **** /* Module macros.                                                            */
 166:../../os/rt/include/chtime.h **** /*===========================================================================*/
 167:../../os/rt/include/chtime.h **** 
 168:../../os/rt/include/chtime.h **** /**
 169:../../os/rt/include/chtime.h ****  * @name    Fast time conversion utilities
 170:../../os/rt/include/chtime.h ****  * @{
 171:../../os/rt/include/chtime.h ****  */
 172:../../os/rt/include/chtime.h **** /**
 173:../../os/rt/include/chtime.h ****  * @brief   Seconds to time interval.
 174:../../os/rt/include/chtime.h ****  * @details Converts from seconds to system ticks number.
 175:../../os/rt/include/chtime.h ****  * @note    The result is rounded upward to the next tick boundary.
 176:../../os/rt/include/chtime.h ****  * @note    Use of this macro for large values is not secure because
 177:../../os/rt/include/chtime.h ****  *          integer overflows, make sure your value can be correctly
 178:../../os/rt/include/chtime.h ****  *          converted.
 179:../../os/rt/include/chtime.h ****  *
 180:../../os/rt/include/chtime.h ****  * @param[in] secs      number of seconds
 181:../../os/rt/include/chtime.h ****  * @return              The number of ticks.
 182:../../os/rt/include/chtime.h ****  *
 183:../../os/rt/include/chtime.h ****  * @api
 184:../../os/rt/include/chtime.h ****  */
 185:../../os/rt/include/chtime.h **** #define TIME_S2I(secs)                                                      \
 186:../../os/rt/include/chtime.h ****   ((sysinterval_t)((time_conv_t)(secs) * (time_conv_t)CH_CFG_ST_FREQUENCY))
 187:../../os/rt/include/chtime.h **** 
 188:../../os/rt/include/chtime.h **** /**
 189:../../os/rt/include/chtime.h ****  * @brief   Milliseconds to time interval.
 190:../../os/rt/include/chtime.h ****  * @details Converts from milliseconds to system ticks number.
 191:../../os/rt/include/chtime.h ****  * @note    The result is rounded upward to the next tick boundary.
 192:../../os/rt/include/chtime.h ****  * @note    Use of this macro for large values is not secure because
 193:../../os/rt/include/chtime.h ****  *          integer overflows, make sure your value can be correctly
 194:../../os/rt/include/chtime.h ****  *          converted.
 195:../../os/rt/include/chtime.h ****  *
 196:../../os/rt/include/chtime.h ****  * @param[in] msecs     number of milliseconds
 197:../../os/rt/include/chtime.h ****  * @return              The number of ticks.
 198:../../os/rt/include/chtime.h ****  *
 199:../../os/rt/include/chtime.h ****  * @api
 200:../../os/rt/include/chtime.h ****  */
 201:../../os/rt/include/chtime.h **** #define TIME_MS2I(msecs)                                                    \
 202:../../os/rt/include/chtime.h ****   ((sysinterval_t)((((time_conv_t)(msecs) *                                 \
 203:../../os/rt/include/chtime.h ****                      (time_conv_t)CH_CFG_ST_FREQUENCY) +                    \
 204:../../os/rt/include/chtime.h ****                     (time_conv_t)999) / (time_conv_t)1000))
 205:../../os/rt/include/chtime.h **** 
 206:../../os/rt/include/chtime.h **** /**
 207:../../os/rt/include/chtime.h ****  * @brief   Microseconds to time interval.
 208:../../os/rt/include/chtime.h ****  * @details Converts from microseconds to system ticks number.
 209:../../os/rt/include/chtime.h ****  * @note    The result is rounded upward to the next tick boundary.
 210:../../os/rt/include/chtime.h ****  * @note    Use of this macro for large values is not secure because
 211:../../os/rt/include/chtime.h ****  *          integer overflows, make sure your value can be correctly
 212:../../os/rt/include/chtime.h ****  *          converted.
 213:../../os/rt/include/chtime.h ****  *
 214:../../os/rt/include/chtime.h ****  * @param[in] usecs     number of microseconds
 215:../../os/rt/include/chtime.h ****  * @return              The number of ticks.
 216:../../os/rt/include/chtime.h ****  *
 217:../../os/rt/include/chtime.h ****  * @api
 218:../../os/rt/include/chtime.h ****  */
 219:../../os/rt/include/chtime.h **** #define TIME_US2I(usecs)                                                    \
 220:../../os/rt/include/chtime.h ****   ((sysinterval_t)((((time_conv_t)(usecs) *                                 \
 221:../../os/rt/include/chtime.h ****                      (time_conv_t)CH_CFG_ST_FREQUENCY) +                    \
 222:../../os/rt/include/chtime.h ****                     (time_conv_t)999999) / (time_conv_t)1000000))
 223:../../os/rt/include/chtime.h **** 
 224:../../os/rt/include/chtime.h **** /**
 225:../../os/rt/include/chtime.h ****  * @brief   Time interval to seconds.
 226:../../os/rt/include/chtime.h ****  * @details Converts from system ticks number to seconds.
 227:../../os/rt/include/chtime.h ****  * @note    The result is rounded up to the next second boundary.
 228:../../os/rt/include/chtime.h ****  * @note    Use of this macro for large values is not secure because
 229:../../os/rt/include/chtime.h ****  *          integer overflows, make sure your value can be correctly
 230:../../os/rt/include/chtime.h ****  *          converted.
 231:../../os/rt/include/chtime.h ****  *
 232:../../os/rt/include/chtime.h ****  * @param[in] interval  interval in ticks
 233:../../os/rt/include/chtime.h ****  * @return              The number of seconds.
 234:../../os/rt/include/chtime.h ****  *
 235:../../os/rt/include/chtime.h ****  * @api
 236:../../os/rt/include/chtime.h ****  */
 237:../../os/rt/include/chtime.h **** #define TIME_I2S(interval)                                                  \
 238:../../os/rt/include/chtime.h ****   (time_secs_t)(((time_conv_t)(interval) +                                  \
 239:../../os/rt/include/chtime.h ****                  (time_conv_t)CH_CFG_ST_FREQUENCY -                         \
 240:../../os/rt/include/chtime.h ****                  (time_conv_t)1) / (time_conv_t)CH_CFG_ST_FREQUENCY)
 241:../../os/rt/include/chtime.h **** 
 242:../../os/rt/include/chtime.h **** /**
 243:../../os/rt/include/chtime.h ****  * @brief   Time interval to milliseconds.
 244:../../os/rt/include/chtime.h ****  * @details Converts from system ticks number to milliseconds.
 245:../../os/rt/include/chtime.h ****  * @note    The result is rounded up to the next millisecond boundary.
 246:../../os/rt/include/chtime.h ****  * @note    Use of this macro for large values is not secure because
 247:../../os/rt/include/chtime.h ****  *          integer overflows, make sure your value can be correctly
 248:../../os/rt/include/chtime.h ****  *          converted.
 249:../../os/rt/include/chtime.h ****  *
 250:../../os/rt/include/chtime.h ****  * @param[in] interval  interval in ticks
 251:../../os/rt/include/chtime.h ****  * @return              The number of milliseconds.
 252:../../os/rt/include/chtime.h ****  *
 253:../../os/rt/include/chtime.h ****  * @api
 254:../../os/rt/include/chtime.h ****  */
 255:../../os/rt/include/chtime.h **** #define TIME_I2MS(interval)                                                 \
 256:../../os/rt/include/chtime.h ****   (time_msecs_t)((((time_conv_t)(interval) * (time_conv_t)1000) +           \
 257:../../os/rt/include/chtime.h ****                   (time_conv_t)CH_CFG_ST_FREQUENCY - (time_conv_t)1) /      \
 258:../../os/rt/include/chtime.h ****                  (time_conv_t)CH_CFG_ST_FREQUENCY)
 259:../../os/rt/include/chtime.h **** 
 260:../../os/rt/include/chtime.h **** /**
 261:../../os/rt/include/chtime.h ****  * @brief   Time interval to microseconds.
 262:../../os/rt/include/chtime.h ****  * @details Converts from system ticks number to microseconds.
 263:../../os/rt/include/chtime.h ****  * @note    The result is rounded up to the next microsecond boundary.
 264:../../os/rt/include/chtime.h ****  * @note    Use of this macro for large values is not secure because
 265:../../os/rt/include/chtime.h ****  *          integer overflows, make sure your value can be correctly
 266:../../os/rt/include/chtime.h ****  *          converted.
 267:../../os/rt/include/chtime.h ****  *
 268:../../os/rt/include/chtime.h ****  * @param[in] interval  interval in ticks
 269:../../os/rt/include/chtime.h ****  * @return              The number of microseconds.
 270:../../os/rt/include/chtime.h ****  *
 271:../../os/rt/include/chtime.h ****  * @api
 272:../../os/rt/include/chtime.h ****  */
 273:../../os/rt/include/chtime.h **** #define TIME_I2US(interval)                                                 \
 274:../../os/rt/include/chtime.h ****   (time_usecs_t)((((time_conv_t)(interval) * (time_conv_t)1000000) +        \
 275:../../os/rt/include/chtime.h ****                   (time_conv_t)CH_CFG_ST_FREQUENCY - (time_conv_t)1) /      \
 276:../../os/rt/include/chtime.h ****                  (time_conv_t)CH_CFG_ST_FREQUENCY)
 277:../../os/rt/include/chtime.h **** /** @} */
 278:../../os/rt/include/chtime.h **** 
 279:../../os/rt/include/chtime.h **** /*===========================================================================*/
 280:../../os/rt/include/chtime.h **** /* External declarations.                                                    */
 281:../../os/rt/include/chtime.h **** /*===========================================================================*/
 282:../../os/rt/include/chtime.h **** 
 283:../../os/rt/include/chtime.h **** #ifdef __cplusplus
 284:../../os/rt/include/chtime.h **** extern "C" {
 285:../../os/rt/include/chtime.h **** #endif
 286:../../os/rt/include/chtime.h **** 
 287:../../os/rt/include/chtime.h **** #ifdef __cplusplus
 288:../../os/rt/include/chtime.h **** }
 289:../../os/rt/include/chtime.h **** #endif
 290:../../os/rt/include/chtime.h **** 
 291:../../os/rt/include/chtime.h **** /*===========================================================================*/
 292:../../os/rt/include/chtime.h **** /* Module inline functions.                                                  */
 293:../../os/rt/include/chtime.h **** /*===========================================================================*/
 294:../../os/rt/include/chtime.h **** 
 295:../../os/rt/include/chtime.h **** /**
 296:../../os/rt/include/chtime.h ****  * @name    Secure time conversion utilities
 297:../../os/rt/include/chtime.h ****  * @{
 298:../../os/rt/include/chtime.h ****  */
 299:../../os/rt/include/chtime.h **** /**
 300:../../os/rt/include/chtime.h ****  * @brief   Seconds to time interval.
 301:../../os/rt/include/chtime.h ****  * @details Converts from seconds to system ticks number.
 302:../../os/rt/include/chtime.h ****  * @note    The result is rounded upward to the next tick boundary.
 303:../../os/rt/include/chtime.h ****  *
 304:../../os/rt/include/chtime.h ****  * @param[in] secs      number of seconds
 305:../../os/rt/include/chtime.h ****  * @return              The number of ticks.
 306:../../os/rt/include/chtime.h ****  *
 307:../../os/rt/include/chtime.h ****  * @special
 308:../../os/rt/include/chtime.h ****  */
 309:../../os/rt/include/chtime.h **** static inline sysinterval_t chTimeS2I(time_secs_t secs) {
 310:../../os/rt/include/chtime.h ****   time_conv_t ticks;
 311:../../os/rt/include/chtime.h **** 
 312:../../os/rt/include/chtime.h ****   ticks = (time_conv_t)secs * (time_conv_t)CH_CFG_ST_FREQUENCY;
 313:../../os/rt/include/chtime.h **** 
 314:../../os/rt/include/chtime.h ****   chDbgAssert(ticks <= (time_conv_t)TIME_MAX_INTERVAL,
 315:../../os/rt/include/chtime.h ****               "conversion overflow");
 316:../../os/rt/include/chtime.h **** 
 317:../../os/rt/include/chtime.h ****   return (sysinterval_t)ticks;
 318:../../os/rt/include/chtime.h **** }
 319:../../os/rt/include/chtime.h **** 
 320:../../os/rt/include/chtime.h **** /**
 321:../../os/rt/include/chtime.h ****  * @brief   Milliseconds to time interval.
 322:../../os/rt/include/chtime.h ****  * @details Converts from milliseconds to system ticks number.
 323:../../os/rt/include/chtime.h ****  * @note    The result is rounded upward to the next tick boundary.
 324:../../os/rt/include/chtime.h ****  *
 325:../../os/rt/include/chtime.h ****  * @param[in] msec      number of milliseconds
 326:../../os/rt/include/chtime.h ****  * @return              The number of ticks.
 327:../../os/rt/include/chtime.h ****  *
 328:../../os/rt/include/chtime.h ****  * @special
 329:../../os/rt/include/chtime.h ****  */
 330:../../os/rt/include/chtime.h **** static inline sysinterval_t chTimeMS2I(time_msecs_t msec) {
 331:../../os/rt/include/chtime.h ****   time_conv_t ticks;
 332:../../os/rt/include/chtime.h **** 
 333:../../os/rt/include/chtime.h ****   ticks = (((time_conv_t)msec * (time_conv_t)CH_CFG_ST_FREQUENCY) +
 334:../../os/rt/include/chtime.h ****            (time_conv_t)999) / (time_conv_t)1000;
 335:../../os/rt/include/chtime.h **** 
 336:../../os/rt/include/chtime.h ****   chDbgAssert(ticks <= (time_conv_t)TIME_MAX_INTERVAL,
 337:../../os/rt/include/chtime.h ****               "conversion overflow");
 338:../../os/rt/include/chtime.h **** 
 339:../../os/rt/include/chtime.h ****   return (sysinterval_t)ticks;
 340:../../os/rt/include/chtime.h **** }
 341:../../os/rt/include/chtime.h **** 
 342:../../os/rt/include/chtime.h **** /**
 343:../../os/rt/include/chtime.h ****  * @brief   Microseconds to time interval.
 344:../../os/rt/include/chtime.h ****  * @details Converts from microseconds to system ticks number.
 345:../../os/rt/include/chtime.h ****  * @note    The result is rounded upward to the next tick boundary.
 346:../../os/rt/include/chtime.h ****  *
 347:../../os/rt/include/chtime.h ****  * @param[in] usec      number of microseconds
 348:../../os/rt/include/chtime.h ****  * @return              The number of ticks.
 349:../../os/rt/include/chtime.h ****  *
 350:../../os/rt/include/chtime.h ****  * @special
 351:../../os/rt/include/chtime.h ****  */
 352:../../os/rt/include/chtime.h **** static inline sysinterval_t chTimeUS2I(time_usecs_t usec) {
 353:../../os/rt/include/chtime.h ****   time_conv_t ticks;
 354:../../os/rt/include/chtime.h **** 
 355:../../os/rt/include/chtime.h ****   ticks = (((time_conv_t)usec * (time_conv_t)CH_CFG_ST_FREQUENCY) +
 356:../../os/rt/include/chtime.h ****            (time_conv_t)999999) / (time_conv_t)1000000;
 357:../../os/rt/include/chtime.h **** 
 358:../../os/rt/include/chtime.h ****   chDbgAssert(ticks <= (time_conv_t)TIME_MAX_INTERVAL,
 359:../../os/rt/include/chtime.h ****               "conversion overflow");
 360:../../os/rt/include/chtime.h **** 
 361:../../os/rt/include/chtime.h ****   return (sysinterval_t)ticks;
 362:../../os/rt/include/chtime.h **** }
 363:../../os/rt/include/chtime.h **** 
 364:../../os/rt/include/chtime.h **** /**
 365:../../os/rt/include/chtime.h ****  * @brief   Time interval to seconds.
 366:../../os/rt/include/chtime.h ****  * @details Converts from system interval to seconds.
 367:../../os/rt/include/chtime.h ****  * @note    The result is rounded up to the next second boundary.
 368:../../os/rt/include/chtime.h ****  *
 369:../../os/rt/include/chtime.h ****  * @param[in] interval  interval in ticks
 370:../../os/rt/include/chtime.h ****  * @return              The number of seconds.
 371:../../os/rt/include/chtime.h ****  *
 372:../../os/rt/include/chtime.h ****  * @special
 373:../../os/rt/include/chtime.h ****  */
 374:../../os/rt/include/chtime.h **** static inline time_secs_t chTimeI2S(sysinterval_t interval) {
 375:../../os/rt/include/chtime.h ****   time_conv_t secs;
 376:../../os/rt/include/chtime.h **** 
 377:../../os/rt/include/chtime.h ****   secs = ((time_conv_t)interval +
 378:../../os/rt/include/chtime.h ****           (time_conv_t)CH_CFG_ST_FREQUENCY -
 379:../../os/rt/include/chtime.h ****           (time_conv_t)1) / (time_conv_t)CH_CFG_ST_FREQUENCY;
 380:../../os/rt/include/chtime.h **** 
 381:../../os/rt/include/chtime.h ****   chDbgAssert(secs < (time_conv_t)((time_secs_t)-1),
 382:../../os/rt/include/chtime.h ****               "conversion overflow");
 383:../../os/rt/include/chtime.h **** 
 384:../../os/rt/include/chtime.h ****   return (time_secs_t)secs;
 385:../../os/rt/include/chtime.h **** }
 386:../../os/rt/include/chtime.h **** 
 387:../../os/rt/include/chtime.h **** /**
 388:../../os/rt/include/chtime.h ****  * @brief   Time interval to milliseconds.
 389:../../os/rt/include/chtime.h ****  * @details Converts from system interval to milliseconds.
 390:../../os/rt/include/chtime.h ****  * @note    The result is rounded up to the next millisecond boundary.
 391:../../os/rt/include/chtime.h ****  *
 392:../../os/rt/include/chtime.h ****  * @param[in] interval  interval in ticks
 393:../../os/rt/include/chtime.h ****  * @return              The number of milliseconds.
 394:../../os/rt/include/chtime.h ****  *
 395:../../os/rt/include/chtime.h ****  * @special
 396:../../os/rt/include/chtime.h ****  */
 397:../../os/rt/include/chtime.h **** static inline time_msecs_t chTimeI2MS(sysinterval_t interval) {
 398:../../os/rt/include/chtime.h ****   time_conv_t msecs;
 399:../../os/rt/include/chtime.h **** 
 400:../../os/rt/include/chtime.h ****   msecs = (((time_conv_t)interval * (time_conv_t)1000) +
 401:../../os/rt/include/chtime.h ****            (time_conv_t)CH_CFG_ST_FREQUENCY - (time_conv_t)1) /
 402:../../os/rt/include/chtime.h ****           (time_conv_t)CH_CFG_ST_FREQUENCY;
 403:../../os/rt/include/chtime.h **** 
 404:../../os/rt/include/chtime.h ****   chDbgAssert(msecs < (time_conv_t)((time_msecs_t)-1),
 405:../../os/rt/include/chtime.h ****               "conversion overflow");
 406:../../os/rt/include/chtime.h **** 
 407:../../os/rt/include/chtime.h ****   return (time_msecs_t)msecs;
 408:../../os/rt/include/chtime.h **** }
 409:../../os/rt/include/chtime.h **** 
 410:../../os/rt/include/chtime.h **** /**
 411:../../os/rt/include/chtime.h ****  * @brief   Time interval to microseconds.
 412:../../os/rt/include/chtime.h ****  * @details Converts from system interval to microseconds.
 413:../../os/rt/include/chtime.h ****  * @note    The result is rounded up to the next microsecond boundary.
 414:../../os/rt/include/chtime.h ****  *
 415:../../os/rt/include/chtime.h ****  * @param[in] interval  interval in ticks
 416:../../os/rt/include/chtime.h ****  * @return              The number of microseconds.
 417:../../os/rt/include/chtime.h ****  *
 418:../../os/rt/include/chtime.h ****  * @special
 419:../../os/rt/include/chtime.h ****  */
 420:../../os/rt/include/chtime.h **** static inline time_usecs_t chTimeI2US(sysinterval_t interval) {
 421:../../os/rt/include/chtime.h ****   time_conv_t usecs;
 422:../../os/rt/include/chtime.h **** 
 423:../../os/rt/include/chtime.h ****   usecs = (((time_conv_t)interval * (time_conv_t)1000000) +
 424:../../os/rt/include/chtime.h ****            (time_conv_t)CH_CFG_ST_FREQUENCY - (time_conv_t)1) /
 425:../../os/rt/include/chtime.h ****           (time_conv_t)CH_CFG_ST_FREQUENCY;
 426:../../os/rt/include/chtime.h **** 
 427:../../os/rt/include/chtime.h ****   chDbgAssert(usecs <= (time_conv_t)((time_usecs_t)-1),
 428:../../os/rt/include/chtime.h ****               "conversion overflow");
 429:../../os/rt/include/chtime.h **** 
 430:../../os/rt/include/chtime.h ****   return (time_usecs_t)usecs;
 431:../../os/rt/include/chtime.h **** }
 432:../../os/rt/include/chtime.h **** 
 433:../../os/rt/include/chtime.h **** /**
 434:../../os/rt/include/chtime.h ****  * @brief   Adds an interval to a system time returning a system time.
 435:../../os/rt/include/chtime.h ****  *
 436:../../os/rt/include/chtime.h ****  * @param[in] systime   base system time
 437:../../os/rt/include/chtime.h ****  * @param[in] interval  interval to be added
 438:../../os/rt/include/chtime.h ****  * @return              The new system time.
 439:../../os/rt/include/chtime.h ****  *
 440:../../os/rt/include/chtime.h ****  * @xclass
 441:../../os/rt/include/chtime.h ****  */
 442:../../os/rt/include/chtime.h **** static inline systime_t chTimeAddX(systime_t systime,
 443:../../os/rt/include/chtime.h ****                                    sysinterval_t interval) {
 444:../../os/rt/include/chtime.h **** 
 445:../../os/rt/include/chtime.h **** #if CH_CFG_ST_RESOLUTION != CH_CFG_INTERVALS_SIZE
 446:../../os/rt/include/chtime.h ****   chDbgCheck(interval <= (sysinterval_t)TIME_MAX_SYSTIME);
 447:../../os/rt/include/chtime.h **** #endif
 448:../../os/rt/include/chtime.h **** 
 449:../../os/rt/include/chtime.h ****   return systime + (systime_t)interval;
 450:../../os/rt/include/chtime.h **** }
 451:../../os/rt/include/chtime.h **** 
 452:../../os/rt/include/chtime.h **** /**
 453:../../os/rt/include/chtime.h ****  * @brief   Subtracts two system times returning an interval.
 454:../../os/rt/include/chtime.h ****  *
 455:../../os/rt/include/chtime.h ****  * @param[in] start     first system time
 456:../../os/rt/include/chtime.h ****  * @param[in] end       second system time
 457:../../os/rt/include/chtime.h ****  * @return              The interval representing the time difference.
 458:../../os/rt/include/chtime.h ****  *
 459:../../os/rt/include/chtime.h ****  * @xclass
 460:../../os/rt/include/chtime.h ****  */
 461:../../os/rt/include/chtime.h **** static inline sysinterval_t chTimeDiffX(systime_t start, systime_t end) {
 462:../../os/rt/include/chtime.h **** 
 463:../../os/rt/include/chtime.h ****   /*lint -save -e9033 [10.8] This cast is required by the operation, it is
 464:../../os/rt/include/chtime.h ****     known that the destination type can be wider.*/
 465:../../os/rt/include/chtime.h ****   return (sysinterval_t)((systime_t)(end - start));
 1297               		.loc 6 465 0
 1298 000a 821B      		sub r24,r18
 1299 000c 930B      		sbc r25,r19
 1300               	.LVL92:
 1301               	.LBE369:
 1302               	.LBE368:
 678:../../os/rt/src/chthreads.c ****   sysinterval_t interval;
 679:../../os/rt/src/chthreads.c **** 
 680:../../os/rt/src/chthreads.c ****   chSysLock();
 681:../../os/rt/src/chthreads.c ****   interval = chTimeDiffX(chVTGetSystemTimeX(), time);
 682:../../os/rt/src/chthreads.c ****   if (likely(interval > (sysinterval_t)0)) {
 1303               		.loc 1 682 0
 1304 000e 01F0      		breq .L31
 1305               	.LVL93:
 1306               	.LBB370:
 1307               	.LBB371:
 1308               		.loc 4 451 0
 1309 0010 BC01      		movw r22,r24
 1310 0012 88E0      		ldi r24,lo8(8)
 1311               	.LVL94:
 1312 0014 0E94 0000 		call chSchGoSleepTimeoutS
 1313               	.LVL95:
 1314               	.L31:
 1315               	.LBE371:
 1316               	.LBE370:
 1317               	.LBB372:
 1318               	.LBB373:
 1319               	.LBB374:
 1320               	.LBB375:
 1321               		.loc 3 440 0
 1322               	/* #APP */
 1323               	 ;  440 "../../os/common/ports/AVR/chcore.h" 1
 1324 0018 7894      		sei
 1325               	 ;  0 "" 2
 1326               	/* epilogue start */
 1327               	/* #NOAPP */
 1328               	.LBE375:
 1329               	.LBE374:
 1330               	.LBE373:
 1331               	.LBE372:
 683:../../os/rt/src/chthreads.c ****     chThdSleepS(interval);
 684:../../os/rt/src/chthreads.c ****   }
 685:../../os/rt/src/chthreads.c ****   chSysUnlock();
 686:../../os/rt/src/chthreads.c **** }
 1332               		.loc 1 686 0
 1333 001a 0895      		ret
 1334               		.cfi_endproc
 1335               	.LFE205:
 1337               		.section	.text.chThdSleepUntilWindowed,"ax",@progbits
 1338               	.global	chThdSleepUntilWindowed
 1340               	chThdSleepUntilWindowed:
 1341               	.LFB206:
 687:../../os/rt/src/chthreads.c **** 
 688:../../os/rt/src/chthreads.c **** /**
 689:../../os/rt/src/chthreads.c ****  * @brief   Suspends the invoking thread until the system time arrives to the
 690:../../os/rt/src/chthreads.c ****  *          specified value.
 691:../../os/rt/src/chthreads.c ****  * @note    The system time is assumed to be between @p prev and @p next
 692:../../os/rt/src/chthreads.c ****  *          else the call is assumed to have been called outside the
 693:../../os/rt/src/chthreads.c ****  *          allowed time interval, in this case no sleep is performed.
 694:../../os/rt/src/chthreads.c ****  * @see     chThdSleepUntil()
 695:../../os/rt/src/chthreads.c ****  *
 696:../../os/rt/src/chthreads.c ****  * @param[in] prev      absolute system time of the previous deadline
 697:../../os/rt/src/chthreads.c ****  * @param[in] next      absolute system time of the next deadline
 698:../../os/rt/src/chthreads.c ****  * @return              the @p next parameter
 699:../../os/rt/src/chthreads.c ****  *
 700:../../os/rt/src/chthreads.c ****  * @api
 701:../../os/rt/src/chthreads.c ****  */
 702:../../os/rt/src/chthreads.c **** systime_t chThdSleepUntilWindowed(systime_t prev, systime_t next) {
 1342               		.loc 1 702 0
 1343               		.cfi_startproc
 1344               	.LVL96:
 1345 0000 CF93      		push r28
 1346               	.LCFI21:
 1347               		.cfi_def_cfa_offset 3
 1348               		.cfi_offset 28, -2
 1349 0002 DF93      		push r29
 1350               	.LCFI22:
 1351               		.cfi_def_cfa_offset 4
 1352               		.cfi_offset 29, -3
 1353               	/* prologue: function */
 1354               	/* frame size = 0 */
 1355               	/* stack size = 2 */
 1356               	.L__stack_usage = 2
 1357 0004 EB01      		movw r28,r22
 1358               	.LBB376:
 1359               	.LBB377:
 1360               	.LBB378:
 430:../../os/common/ports/AVR/chcore.h **** }
 1361               		.loc 3 430 0
 1362               	/* #APP */
 1363               	 ;  430 "../../os/common/ports/AVR/chcore.h" 1
 1364 0006 F894      		cli
 1365               	 ;  0 "" 2
 1366               	/* #NOAPP */
 1367               	.LBE378:
 1368               	.LBE377:
 1369               	.LBE376:
 1370               	.LBB379:
 1371               	.LBB380:
 1372               		.loc 5 125 0
 1373 0008 2091 0000 		lds r18,ch0+13
 1374 000c 3091 0000 		lds r19,ch0+13+1
 1375               	.LBE380:
 1376               	.LBE379:
 1377               	.LBB381:
 1378               	.LBB382:
 466:../../os/rt/include/chtime.h ****   /*lint -restore*/
 467:../../os/rt/include/chtime.h **** }
 468:../../os/rt/include/chtime.h **** 
 469:../../os/rt/include/chtime.h **** /**
 470:../../os/rt/include/chtime.h ****  * @brief   Checks if the specified time is within the specified time range.
 471:../../os/rt/include/chtime.h ****  * @note    When start==end then the function returns always false because the
 472:../../os/rt/include/chtime.h ****  *          time window has zero size.
 473:../../os/rt/include/chtime.h ****  *
 474:../../os/rt/include/chtime.h ****  * @param[in] time      the time to be verified
 475:../../os/rt/include/chtime.h ****  * @param[in] start     the start of the time window (inclusive)
 476:../../os/rt/include/chtime.h ****  * @param[in] end       the end of the time window (non inclusive)
 477:../../os/rt/include/chtime.h ****  * @retval true         if the current time is within the specified
 478:../../os/rt/include/chtime.h ****  *                      time window.
 479:../../os/rt/include/chtime.h ****  * @retval false        if the current time is not within the specified
 480:../../os/rt/include/chtime.h ****  *                      time window.
 481:../../os/rt/include/chtime.h ****  *
 482:../../os/rt/include/chtime.h ****  * @xclass
 483:../../os/rt/include/chtime.h ****  */
 484:../../os/rt/include/chtime.h **** static inline bool chTimeIsInRangeX(systime_t time,
 485:../../os/rt/include/chtime.h ****                                     systime_t start,
 486:../../os/rt/include/chtime.h ****                                     systime_t end) {
 487:../../os/rt/include/chtime.h **** 
 488:../../os/rt/include/chtime.h ****   return (bool)((systime_t)((systime_t)time - (systime_t)start) <
 489:../../os/rt/include/chtime.h ****                 (systime_t)((systime_t)end - (systime_t)start));
 1379               		.loc 6 489 0
 1380 0010 AB01      		movw r20,r22
 1381 0012 481B      		sub r20,r24
 1382 0014 590B      		sbc r21,r25
 488:../../os/rt/include/chtime.h ****                 (systime_t)((systime_t)end - (systime_t)start));
 1383               		.loc 6 488 0
 1384 0016 B901      		movw r22,r18
 1385               	.LVL97:
 1386 0018 681B      		sub r22,r24
 1387 001a 790B      		sbc r23,r25
 1388               	.LBE382:
 1389               	.LBE381:
 703:../../os/rt/src/chthreads.c ****   systime_t time;
 704:../../os/rt/src/chthreads.c **** 
 705:../../os/rt/src/chthreads.c ****   chSysLock();
 706:../../os/rt/src/chthreads.c ****   time = chVTGetSystemTimeX();
 707:../../os/rt/src/chthreads.c ****   if (likely(chTimeIsInRangeX(time, prev, next))) {
 1390               		.loc 1 707 0
 1391 001c 6417      		cp r22,r20
 1392 001e 7507      		cpc r23,r21
 1393 0020 00F4      		brsh .L36
 1394               	.LBB383:
 1395               	.LBB384:
 465:../../os/rt/include/chtime.h ****   /*lint -restore*/
 1396               		.loc 6 465 0
 1397 0022 BE01      		movw r22,r28
 1398 0024 621B      		sub r22,r18
 1399 0026 730B      		sbc r23,r19
 1400               	.LBE384:
 1401               	.LBE383:
 1402               	.LBB385:
 1403               	.LBB386:
 1404               		.loc 4 451 0
 1405 0028 88E0      		ldi r24,lo8(8)
 1406               	.LVL98:
 1407 002a 0E94 0000 		call chSchGoSleepTimeoutS
 1408               	.LVL99:
 1409               	.L36:
 1410               	.LBE386:
 1411               	.LBE385:
 1412               	.LBB387:
 1413               	.LBB388:
 1414               	.LBB389:
 1415               	.LBB390:
 1416               		.loc 3 440 0
 1417               	/* #APP */
 1418               	 ;  440 "../../os/common/ports/AVR/chcore.h" 1
 1419 002e 7894      		sei
 1420               	 ;  0 "" 2
 1421               	/* #NOAPP */
 1422               	.LBE390:
 1423               	.LBE389:
 1424               	.LBE388:
 1425               	.LBE387:
 708:../../os/rt/src/chthreads.c ****     chThdSleepS(chTimeDiffX(time, next));
 709:../../os/rt/src/chthreads.c ****   }
 710:../../os/rt/src/chthreads.c ****   chSysUnlock();
 711:../../os/rt/src/chthreads.c **** 
 712:../../os/rt/src/chthreads.c ****   return next;
 713:../../os/rt/src/chthreads.c **** }
 1426               		.loc 1 713 0
 1427 0030 CE01      		movw r24,r28
 1428               	/* epilogue start */
 1429 0032 DF91      		pop r29
 1430 0034 CF91      		pop r28
 1431               	.LVL100:
 1432 0036 0895      		ret
 1433               		.cfi_endproc
 1434               	.LFE206:
 1436               		.section	.text.chThdYield,"ax",@progbits
 1437               	.global	chThdYield
 1439               	chThdYield:
 1440               	.LFB207:
 714:../../os/rt/src/chthreads.c **** 
 715:../../os/rt/src/chthreads.c **** /**
 716:../../os/rt/src/chthreads.c ****  * @brief   Yields the time slot.
 717:../../os/rt/src/chthreads.c ****  * @details Yields the CPU control to the next thread in the ready list with
 718:../../os/rt/src/chthreads.c ****  *          equal priority, if any.
 719:../../os/rt/src/chthreads.c ****  *
 720:../../os/rt/src/chthreads.c ****  * @api
 721:../../os/rt/src/chthreads.c ****  */
 722:../../os/rt/src/chthreads.c **** void chThdYield(void) {
 1441               		.loc 1 722 0
 1442               		.cfi_startproc
 1443               	/* prologue: function */
 1444               	/* frame size = 0 */
 1445               	/* stack size = 0 */
 1446               	.L__stack_usage = 0
 1447               	.LBB391:
 1448               	.LBB392:
 1449               	.LBB393:
 430:../../os/common/ports/AVR/chcore.h **** }
 1450               		.loc 3 430 0
 1451               	/* #APP */
 1452               	 ;  430 "../../os/common/ports/AVR/chcore.h" 1
 1453 0000 F894      		cli
 1454               	 ;  0 "" 2
 1455               	/* #NOAPP */
 1456               	.LBE393:
 1457               	.LBE392:
 1458               	.LBE391:
 723:../../os/rt/src/chthreads.c **** 
 724:../../os/rt/src/chthreads.c ****   chSysLock();
 725:../../os/rt/src/chthreads.c ****   chSchDoYieldS();
 1459               		.loc 1 725 0
 1460 0002 0E94 0000 		call chSchDoYieldS
 1461               	.LVL101:
 1462               	.LBB394:
 1463               	.LBB395:
 1464               	.LBB396:
 1465               	.LBB397:
 1466               		.loc 3 440 0
 1467               	/* #APP */
 1468               	 ;  440 "../../os/common/ports/AVR/chcore.h" 1
 1469 0006 7894      		sei
 1470               	 ;  0 "" 2
 1471               	/* epilogue start */
 1472               	/* #NOAPP */
 1473               	.LBE397:
 1474               	.LBE396:
 1475               	.LBE395:
 1476               	.LBE394:
 726:../../os/rt/src/chthreads.c ****   chSysUnlock();
 727:../../os/rt/src/chthreads.c **** }
 1477               		.loc 1 727 0
 1478 0008 0895      		ret
 1479               		.cfi_endproc
 1480               	.LFE207:
 1482               		.section	.text.chThdSuspendS,"ax",@progbits
 1483               	.global	chThdSuspendS
 1485               	chThdSuspendS:
 1486               	.LFB208:
 728:../../os/rt/src/chthreads.c **** 
 729:../../os/rt/src/chthreads.c **** /**
 730:../../os/rt/src/chthreads.c ****  * @brief   Sends the current thread sleeping and sets a reference variable.
 731:../../os/rt/src/chthreads.c ****  * @note    This function must reschedule, it can only be called from thread
 732:../../os/rt/src/chthreads.c ****  *          context.
 733:../../os/rt/src/chthreads.c ****  *
 734:../../os/rt/src/chthreads.c ****  * @param[in] trp       a pointer to a thread reference object
 735:../../os/rt/src/chthreads.c ****  * @return              The wake up message.
 736:../../os/rt/src/chthreads.c ****  *
 737:../../os/rt/src/chthreads.c ****  * @sclass
 738:../../os/rt/src/chthreads.c ****  */
 739:../../os/rt/src/chthreads.c **** msg_t chThdSuspendS(thread_reference_t *trp) {
 1487               		.loc 1 739 0
 1488               		.cfi_startproc
 1489               	.LVL102:
 1490 0000 CF93      		push r28
 1491               	.LCFI23:
 1492               		.cfi_def_cfa_offset 3
 1493               		.cfi_offset 28, -2
 1494 0002 DF93      		push r29
 1495               	.LCFI24:
 1496               		.cfi_def_cfa_offset 4
 1497               		.cfi_offset 29, -3
 1498               	/* prologue: function */
 1499               	/* frame size = 0 */
 1500               	/* stack size = 2 */
 1501               	.L__stack_usage = 2
 1502               	.LBB398:
 1503               	.LBB399:
 343:../../os/rt/include/chthreads.h **** }
 1504               		.loc 4 343 0
 1505 0004 C0E0      		ldi r28,lo8(ch0)
 1506 0006 D0E0      		ldi r29,hi8(ch0)
 1507 0008 ED81      		ldd r30,Y+5
 1508 000a FE81      		ldd r31,Y+6
 1509               	.LBE399:
 1510               	.LBE398:
 740:../../os/rt/src/chthreads.c ****   thread_t *tp = chThdGetSelfX();
 741:../../os/rt/src/chthreads.c **** 
 742:../../os/rt/src/chthreads.c ****   chDbgAssert(*trp == NULL, "not NULL");
 743:../../os/rt/src/chthreads.c **** 
 744:../../os/rt/src/chthreads.c ****   *trp = tp;
 1511               		.loc 1 744 0
 1512 000c DC01      		movw r26,r24
 1513 000e ED93      		st X+,r30
 1514 0010 FC93      		st X,r31
 745:../../os/rt/src/chthreads.c ****   tp->u.wttrp = trp;
 1515               		.loc 1 745 0
 1516 0012 938B      		std Z+19,r25
 1517 0014 828B      		std Z+18,r24
 746:../../os/rt/src/chthreads.c ****   chSchGoSleepS(CH_STATE_SUSPENDED);
 1518               		.loc 1 746 0
 1519 0016 83E0      		ldi r24,lo8(3)
 1520               	.LVL103:
 1521 0018 0E94 0000 		call chSchGoSleepS
 1522               	.LVL104:
 747:../../os/rt/src/chthreads.c **** 
 748:../../os/rt/src/chthreads.c ****   return chThdGetSelfX()->u.rdymsg;
 1523               		.loc 1 748 0
 1524 001c ED81      		ldd r30,Y+5
 1525 001e FE81      		ldd r31,Y+6
 749:../../os/rt/src/chthreads.c **** }
 1526               		.loc 1 749 0
 1527 0020 8289      		ldd r24,Z+18
 1528 0022 9389      		ldd r25,Z+19
 1529               	/* epilogue start */
 1530 0024 DF91      		pop r29
 1531 0026 CF91      		pop r28
 1532 0028 0895      		ret
 1533               		.cfi_endproc
 1534               	.LFE208:
 1536               		.section	.text.chThdSuspendTimeoutS,"ax",@progbits
 1537               	.global	chThdSuspendTimeoutS
 1539               	chThdSuspendTimeoutS:
 1540               	.LFB209:
 750:../../os/rt/src/chthreads.c **** 
 751:../../os/rt/src/chthreads.c **** /**
 752:../../os/rt/src/chthreads.c ****  * @brief   Sends the current thread sleeping and sets a reference variable.
 753:../../os/rt/src/chthreads.c ****  * @note    This function must reschedule, it can only be called from thread
 754:../../os/rt/src/chthreads.c ****  *          context.
 755:../../os/rt/src/chthreads.c ****  *
 756:../../os/rt/src/chthreads.c ****  * @param[in] trp       a pointer to a thread reference object
 757:../../os/rt/src/chthreads.c ****  * @param[in] timeout   the timeout in system ticks, the special values are
 758:../../os/rt/src/chthreads.c ****  *                      handled as follow:
 759:../../os/rt/src/chthreads.c ****  *                      - @a TIME_INFINITE the thread enters an infinite sleep
 760:../../os/rt/src/chthreads.c ****  *                        state.
 761:../../os/rt/src/chthreads.c ****  *                      - @a TIME_IMMEDIATE the thread is not suspended and
 762:../../os/rt/src/chthreads.c ****  *                        the function returns @p MSG_TIMEOUT as if a timeout
 763:../../os/rt/src/chthreads.c ****  *                        occurred.
 764:../../os/rt/src/chthreads.c ****  *                      .
 765:../../os/rt/src/chthreads.c ****  * @return              The wake up message.
 766:../../os/rt/src/chthreads.c ****  * @retval MSG_TIMEOUT  if the operation timed out.
 767:../../os/rt/src/chthreads.c ****  *
 768:../../os/rt/src/chthreads.c ****  * @sclass
 769:../../os/rt/src/chthreads.c ****  */
 770:../../os/rt/src/chthreads.c **** msg_t chThdSuspendTimeoutS(thread_reference_t *trp, sysinterval_t timeout) {
 1541               		.loc 1 770 0
 1542               		.cfi_startproc
 1543               	.LVL105:
 1544               	/* prologue: function */
 1545               	/* frame size = 0 */
 1546               	/* stack size = 0 */
 1547               	.L__stack_usage = 0
 1548               	.LBB400:
 1549               	.LBB401:
 343:../../os/rt/include/chthreads.h **** }
 1550               		.loc 4 343 0
 1551 0000 E091 0000 		lds r30,ch0+5
 1552 0004 F091 0000 		lds r31,ch0+5+1
 1553               	.LBE401:
 1554               	.LBE400:
 771:../../os/rt/src/chthreads.c ****   thread_t *tp = chThdGetSelfX();
 772:../../os/rt/src/chthreads.c **** 
 773:../../os/rt/src/chthreads.c ****   chDbgAssert(*trp == NULL, "not NULL");
 774:../../os/rt/src/chthreads.c **** 
 775:../../os/rt/src/chthreads.c ****   if (unlikely(TIME_IMMEDIATE == timeout)) {
 1555               		.loc 1 775 0
 1556 0008 6115      		cp r22,__zero_reg__
 1557 000a 7105      		cpc r23,__zero_reg__
 1558 000c 01F0      		breq .L40
 776:../../os/rt/src/chthreads.c ****     return MSG_TIMEOUT;
 777:../../os/rt/src/chthreads.c ****   }
 778:../../os/rt/src/chthreads.c **** 
 779:../../os/rt/src/chthreads.c ****   *trp = tp;
 1559               		.loc 1 779 0
 1560 000e DC01      		movw r26,r24
 1561 0010 ED93      		st X+,r30
 1562 0012 FC93      		st X,r31
 780:../../os/rt/src/chthreads.c ****   tp->u.wttrp = trp;
 1563               		.loc 1 780 0
 1564 0014 938B      		std Z+19,r25
 1565 0016 828B      		std Z+18,r24
 781:../../os/rt/src/chthreads.c **** 
 782:../../os/rt/src/chthreads.c ****   return chSchGoSleepTimeoutS(CH_STATE_SUSPENDED, timeout);
 1566               		.loc 1 782 0
 1567 0018 83E0      		ldi r24,lo8(3)
 1568               	.LVL106:
 1569 001a 0C94 0000 		jmp chSchGoSleepTimeoutS
 1570               	.LVL107:
 1571               	.L40:
 783:../../os/rt/src/chthreads.c **** }
 1572               		.loc 1 783 0
 1573 001e 8FEF      		ldi r24,lo8(-1)
 1574 0020 9FEF      		ldi r25,lo8(-1)
 1575               	.LVL108:
 1576               	/* epilogue start */
 1577 0022 0895      		ret
 1578               		.cfi_endproc
 1579               	.LFE209:
 1581               		.section	.text.chThdResumeI,"ax",@progbits
 1582               	.global	chThdResumeI
 1584               	chThdResumeI:
 1585               	.LFB210:
 784:../../os/rt/src/chthreads.c **** 
 785:../../os/rt/src/chthreads.c **** /**
 786:../../os/rt/src/chthreads.c ****  * @brief   Wakes up a thread waiting on a thread reference object.
 787:../../os/rt/src/chthreads.c ****  * @note    This function must not reschedule because it can be called from
 788:../../os/rt/src/chthreads.c ****  *          ISR context.
 789:../../os/rt/src/chthreads.c ****  *
 790:../../os/rt/src/chthreads.c ****  * @param[in] trp       a pointer to a thread reference object
 791:../../os/rt/src/chthreads.c ****  * @param[in] msg       the message code
 792:../../os/rt/src/chthreads.c ****  *
 793:../../os/rt/src/chthreads.c ****  * @iclass
 794:../../os/rt/src/chthreads.c ****  */
 795:../../os/rt/src/chthreads.c **** void chThdResumeI(thread_reference_t *trp, msg_t msg) {
 1586               		.loc 1 795 0
 1587               		.cfi_startproc
 1588               	.LVL109:
 1589               	/* prologue: function */
 1590               	/* frame size = 0 */
 1591               	/* stack size = 0 */
 1592               	.L__stack_usage = 0
 796:../../os/rt/src/chthreads.c **** 
 797:../../os/rt/src/chthreads.c ****   if (*trp != NULL) {
 1593               		.loc 1 797 0
 1594 0000 DC01      		movw r26,r24
 1595 0002 ED91      		ld r30,X+
 1596 0004 FC91      		ld r31,X
 1597 0006 1197      		sbiw r26,1
 1598 0008 3097      		sbiw r30,0
 1599 000a 01F0      		breq .L41
 1600               	.LVL110:
 1601               	.LBB402:
 798:../../os/rt/src/chthreads.c ****     thread_t *tp = *trp;
 799:../../os/rt/src/chthreads.c **** 
 800:../../os/rt/src/chthreads.c ****     chDbgAssert(tp->state == CH_STATE_SUSPENDED, "not CH_STATE_SUSPENDED");
 801:../../os/rt/src/chthreads.c **** 
 802:../../os/rt/src/chthreads.c ****     *trp = NULL;
 1602               		.loc 1 802 0
 1603 000c 1D92      		st X+,__zero_reg__
 1604 000e 1C92      		st X,__zero_reg__
 803:../../os/rt/src/chthreads.c ****     tp->u.rdymsg = msg;
 1605               		.loc 1 803 0
 1606 0010 738B      		std Z+19,r23
 1607 0012 628B      		std Z+18,r22
 804:../../os/rt/src/chthreads.c ****     (void) chSchReadyI(tp);
 1608               		.loc 1 804 0
 1609 0014 CF01      		movw r24,r30
 1610               	.LVL111:
 1611 0016 0C94 0000 		jmp chSchReadyI
 1612               	.LVL112:
 1613               	.L41:
 1614               	/* epilogue start */
 1615               	.LBE402:
 805:../../os/rt/src/chthreads.c ****   }
 806:../../os/rt/src/chthreads.c **** }
 1616               		.loc 1 806 0
 1617 001a 0895      		ret
 1618               		.cfi_endproc
 1619               	.LFE210:
 1621               		.section	.text.chThdResumeS,"ax",@progbits
 1622               	.global	chThdResumeS
 1624               	chThdResumeS:
 1625               	.LFB211:
 807:../../os/rt/src/chthreads.c **** 
 808:../../os/rt/src/chthreads.c **** /**
 809:../../os/rt/src/chthreads.c ****  * @brief   Wakes up a thread waiting on a thread reference object.
 810:../../os/rt/src/chthreads.c ****  * @note    This function must reschedule, it can only be called from thread
 811:../../os/rt/src/chthreads.c ****  *          context.
 812:../../os/rt/src/chthreads.c ****  *
 813:../../os/rt/src/chthreads.c ****  * @param[in] trp       a pointer to a thread reference object
 814:../../os/rt/src/chthreads.c ****  * @param[in] msg       the message code
 815:../../os/rt/src/chthreads.c ****  *
 816:../../os/rt/src/chthreads.c ****  * @iclass
 817:../../os/rt/src/chthreads.c ****  */
 818:../../os/rt/src/chthreads.c **** void chThdResumeS(thread_reference_t *trp, msg_t msg) {
 1626               		.loc 1 818 0
 1627               		.cfi_startproc
 1628               	.LVL113:
 1629               	/* prologue: function */
 1630               	/* frame size = 0 */
 1631               	/* stack size = 0 */
 1632               	.L__stack_usage = 0
 819:../../os/rt/src/chthreads.c **** 
 820:../../os/rt/src/chthreads.c ****   if (*trp != NULL) {
 1633               		.loc 1 820 0
 1634 0000 FC01      		movw r30,r24
 1635 0002 2081      		ld r18,Z
 1636 0004 3181      		ldd r19,Z+1
 1637 0006 2115      		cp r18,__zero_reg__
 1638 0008 3105      		cpc r19,__zero_reg__
 1639 000a 01F0      		breq .L43
 1640               	.LVL114:
 1641               	.LBB403:
 821:../../os/rt/src/chthreads.c ****     thread_t *tp = *trp;
 822:../../os/rt/src/chthreads.c **** 
 823:../../os/rt/src/chthreads.c ****     chDbgAssert(tp->state == CH_STATE_SUSPENDED, "not CH_STATE_SUSPENDED");
 824:../../os/rt/src/chthreads.c **** 
 825:../../os/rt/src/chthreads.c ****     *trp = NULL;
 1642               		.loc 1 825 0
 1643 000c 1182      		std Z+1,__zero_reg__
 1644 000e 1082      		st Z,__zero_reg__
 826:../../os/rt/src/chthreads.c ****     chSchWakeupS(tp, msg);
 1645               		.loc 1 826 0
 1646 0010 C901      		movw r24,r18
 1647               	.LVL115:
 1648 0012 0C94 0000 		jmp chSchWakeupS
 1649               	.LVL116:
 1650               	.L43:
 1651               	/* epilogue start */
 1652               	.LBE403:
 827:../../os/rt/src/chthreads.c ****   }
 828:../../os/rt/src/chthreads.c **** }
 1653               		.loc 1 828 0
 1654 0016 0895      		ret
 1655               		.cfi_endproc
 1656               	.LFE211:
 1658               		.section	.text.chThdResume,"ax",@progbits
 1659               	.global	chThdResume
 1661               	chThdResume:
 1662               	.LFB212:
 829:../../os/rt/src/chthreads.c **** 
 830:../../os/rt/src/chthreads.c **** /**
 831:../../os/rt/src/chthreads.c ****  * @brief   Wakes up a thread waiting on a thread reference object.
 832:../../os/rt/src/chthreads.c ****  * @note    This function must reschedule, it can only be called from thread
 833:../../os/rt/src/chthreads.c ****  *          context.
 834:../../os/rt/src/chthreads.c ****  *
 835:../../os/rt/src/chthreads.c ****  * @param[in] trp       a pointer to a thread reference object
 836:../../os/rt/src/chthreads.c ****  * @param[in] msg       the message code
 837:../../os/rt/src/chthreads.c ****  *
 838:../../os/rt/src/chthreads.c ****  * @api
 839:../../os/rt/src/chthreads.c ****  */
 840:../../os/rt/src/chthreads.c **** void chThdResume(thread_reference_t *trp, msg_t msg) {
 1663               		.loc 1 840 0
 1664               		.cfi_startproc
 1665               	.LVL117:
 1666               	/* prologue: function */
 1667               	/* frame size = 0 */
 1668               	/* stack size = 0 */
 1669               	.L__stack_usage = 0
 1670 0000 FC01      		movw r30,r24
 1671               	.LBB404:
 1672               	.LBB405:
 1673               	.LBB406:
 430:../../os/common/ports/AVR/chcore.h **** }
 1674               		.loc 3 430 0
 1675               	/* #APP */
 1676               	 ;  430 "../../os/common/ports/AVR/chcore.h" 1
 1677 0002 F894      		cli
 1678               	 ;  0 "" 2
 1679               	.LVL118:
 1680               	/* #NOAPP */
 1681               	.LBE406:
 1682               	.LBE405:
 1683               	.LBE404:
 1684               	.LBB407:
 1685               	.LBB408:
 820:../../os/rt/src/chthreads.c ****     thread_t *tp = *trp;
 1686               		.loc 1 820 0
 1687 0004 8081      		ld r24,Z
 1688 0006 9181      		ldd r25,Z+1
 1689               	.LVL119:
 1690 0008 0097      		sbiw r24,0
 1691 000a 01F0      		breq .L46
 1692               	.LVL120:
 1693               	.LBB409:
 825:../../os/rt/src/chthreads.c ****     chSchWakeupS(tp, msg);
 1694               		.loc 1 825 0
 1695 000c 1182      		std Z+1,__zero_reg__
 1696 000e 1082      		st Z,__zero_reg__
 826:../../os/rt/src/chthreads.c ****   }
 1697               		.loc 1 826 0
 1698 0010 0E94 0000 		call chSchWakeupS
 1699               	.LVL121:
 1700               	.L46:
 1701               	.LBE409:
 1702               	.LBE408:
 1703               	.LBE407:
 1704               	.LBB410:
 1705               	.LBB411:
 1706               	.LBB412:
 1707               	.LBB413:
 1708               		.loc 3 440 0
 1709               	/* #APP */
 1710               	 ;  440 "../../os/common/ports/AVR/chcore.h" 1
 1711 0014 7894      		sei
 1712               	 ;  0 "" 2
 1713               	/* epilogue start */
 1714               	/* #NOAPP */
 1715               	.LBE413:
 1716               	.LBE412:
 1717               	.LBE411:
 1718               	.LBE410:
 841:../../os/rt/src/chthreads.c **** 
 842:../../os/rt/src/chthreads.c ****   chSysLock();
 843:../../os/rt/src/chthreads.c ****   chThdResumeS(trp, msg);
 844:../../os/rt/src/chthreads.c ****   chSysUnlock();
 845:../../os/rt/src/chthreads.c **** }
 1719               		.loc 1 845 0
 1720 0016 0895      		ret
 1721               		.cfi_endproc
 1722               	.LFE212:
 1724               		.section	.text.chThdEnqueueTimeoutS,"ax",@progbits
 1725               	.global	chThdEnqueueTimeoutS
 1727               	chThdEnqueueTimeoutS:
 1728               	.LFB213:
 846:../../os/rt/src/chthreads.c **** 
 847:../../os/rt/src/chthreads.c **** /**
 848:../../os/rt/src/chthreads.c ****  * @brief   Enqueues the caller thread on a threads queue object.
 849:../../os/rt/src/chthreads.c ****  * @details The caller thread is enqueued and put to sleep until it is
 850:../../os/rt/src/chthreads.c ****  *          dequeued or the specified timeouts expires.
 851:../../os/rt/src/chthreads.c ****  *
 852:../../os/rt/src/chthreads.c ****  * @param[in] tqp       pointer to the threads queue object
 853:../../os/rt/src/chthreads.c ****  * @param[in] timeout   the timeout in system ticks, the special values are
 854:../../os/rt/src/chthreads.c ****  *                      handled as follow:
 855:../../os/rt/src/chthreads.c ****  *                      - @a TIME_INFINITE the thread enters an infinite sleep
 856:../../os/rt/src/chthreads.c ****  *                        state.
 857:../../os/rt/src/chthreads.c ****  *                      - @a TIME_IMMEDIATE the thread is not enqueued and
 858:../../os/rt/src/chthreads.c ****  *                        the function returns @p MSG_TIMEOUT as if a timeout
 859:../../os/rt/src/chthreads.c ****  *                        occurred.
 860:../../os/rt/src/chthreads.c ****  *                      .
 861:../../os/rt/src/chthreads.c ****  * @return              The message from @p osalQueueWakeupOneI() or
 862:../../os/rt/src/chthreads.c ****  *                      @p osalQueueWakeupAllI() functions.
 863:../../os/rt/src/chthreads.c ****  * @retval MSG_TIMEOUT  if the thread has not been dequeued within the
 864:../../os/rt/src/chthreads.c ****  *                      specified timeout or if the function has been
 865:../../os/rt/src/chthreads.c ****  *                      invoked with @p TIME_IMMEDIATE as timeout
 866:../../os/rt/src/chthreads.c ****  *                      specification.
 867:../../os/rt/src/chthreads.c ****  *
 868:../../os/rt/src/chthreads.c ****  * @sclass
 869:../../os/rt/src/chthreads.c ****  */
 870:../../os/rt/src/chthreads.c **** msg_t chThdEnqueueTimeoutS(threads_queue_t *tqp, sysinterval_t timeout) {
 1729               		.loc 1 870 0
 1730               		.cfi_startproc
 1731               	.LVL122:
 1732 0000 CF93      		push r28
 1733               	.LCFI25:
 1734               		.cfi_def_cfa_offset 3
 1735               		.cfi_offset 28, -2
 1736 0002 DF93      		push r29
 1737               	.LCFI26:
 1738               		.cfi_def_cfa_offset 4
 1739               		.cfi_offset 29, -3
 1740               	/* prologue: function */
 1741               	/* frame size = 0 */
 1742               	/* stack size = 2 */
 1743               	.L__stack_usage = 2
 1744               	.LBB414:
 1745               	.LBB415:
 343:../../os/rt/include/chthreads.h **** }
 1746               		.loc 4 343 0
 1747 0004 E091 0000 		lds r30,ch0+5
 1748 0008 F091 0000 		lds r31,ch0+5+1
 1749               	.LBE415:
 1750               	.LBE414:
 871:../../os/rt/src/chthreads.c ****   thread_t *currtp = chThdGetSelfX();
 872:../../os/rt/src/chthreads.c **** 
 873:../../os/rt/src/chthreads.c ****   if (unlikely(TIME_IMMEDIATE == timeout)) {
 1751               		.loc 1 873 0
 1752 000c 6115      		cp r22,__zero_reg__
 1753 000e 7105      		cpc r23,__zero_reg__
 1754 0010 01F0      		breq .L51
 1755               	.LVL123:
 1756               	.LBB416:
 1757               	.LBB417:
 264:../../os/rt/include/chlists.h ****   p->prev       = qp->prev;
 1758               		.loc 2 264 0
 1759 0012 9183      		std Z+1,r25
 1760 0014 8083      		st Z,r24
 265:../../os/rt/include/chlists.h ****   p->prev->next = p;
 1761               		.loc 2 265 0
 1762 0016 EC01      		movw r28,r24
 1763 0018 AA81      		ldd r26,Y+2
 1764 001a BB81      		ldd r27,Y+3
 1765 001c B383      		std Z+3,r27
 1766 001e A283      		std Z+2,r26
 266:../../os/rt/include/chlists.h ****   qp->prev      = p;
 1767               		.loc 2 266 0
 1768 0020 ED93      		st X+,r30
 1769 0022 FC93      		st X,r31
 267:../../os/rt/include/chlists.h **** }
 1770               		.loc 2 267 0
 1771 0024 FB83      		std Y+3,r31
 1772 0026 EA83      		std Y+2,r30
 1773               	.LVL124:
 1774               	.LBE417:
 1775               	.LBE416:
 874:../../os/rt/src/chthreads.c ****     return MSG_TIMEOUT;
 875:../../os/rt/src/chthreads.c ****   }
 876:../../os/rt/src/chthreads.c **** 
 877:../../os/rt/src/chthreads.c ****   ch_queue_insert(&tqp->queue, (ch_queue_t *)currtp);
 878:../../os/rt/src/chthreads.c **** 
 879:../../os/rt/src/chthreads.c ****   return chSchGoSleepTimeoutS(CH_STATE_QUEUED, timeout);
 1776               		.loc 1 879 0
 1777 0028 84E0      		ldi r24,lo8(4)
 1778               	.LVL125:
 1779               	/* epilogue start */
 880:../../os/rt/src/chthreads.c **** }
 1780               		.loc 1 880 0
 1781 002a DF91      		pop r29
 1782 002c CF91      		pop r28
 1783               	.LVL126:
 879:../../os/rt/src/chthreads.c **** }
 1784               		.loc 1 879 0
 1785 002e 0C94 0000 		jmp chSchGoSleepTimeoutS
 1786               	.LVL127:
 1787               	.L51:
 1788               		.loc 1 880 0
 1789 0032 8FEF      		ldi r24,lo8(-1)
 1790 0034 9FEF      		ldi r25,lo8(-1)
 1791               	.LVL128:
 1792               	/* epilogue start */
 1793 0036 DF91      		pop r29
 1794 0038 CF91      		pop r28
 1795 003a 0895      		ret
 1796               		.cfi_endproc
 1797               	.LFE213:
 1799               		.section	.text.chThdDequeueNextI,"ax",@progbits
 1800               	.global	chThdDequeueNextI
 1802               	chThdDequeueNextI:
 1803               	.LFB214:
 881:../../os/rt/src/chthreads.c **** 
 882:../../os/rt/src/chthreads.c **** /**
 883:../../os/rt/src/chthreads.c ****  * @brief   Dequeues and wakes up one thread from the threads queue object,
 884:../../os/rt/src/chthreads.c ****  *          if any.
 885:../../os/rt/src/chthreads.c ****  *
 886:../../os/rt/src/chthreads.c ****  * @param[in] tqp       pointer to the threads queue object
 887:../../os/rt/src/chthreads.c ****  * @param[in] msg       the message code
 888:../../os/rt/src/chthreads.c ****  *
 889:../../os/rt/src/chthreads.c ****  * @iclass
 890:../../os/rt/src/chthreads.c ****  */
 891:../../os/rt/src/chthreads.c **** void chThdDequeueNextI(threads_queue_t *tqp, msg_t msg) {
 1804               		.loc 1 891 0
 1805               		.cfi_startproc
 1806               	.LVL129:
 1807 0000 CF93      		push r28
 1808               	.LCFI27:
 1809               		.cfi_def_cfa_offset 3
 1810               		.cfi_offset 28, -2
 1811 0002 DF93      		push r29
 1812               	.LCFI28:
 1813               		.cfi_def_cfa_offset 4
 1814               		.cfi_offset 29, -3
 1815               	/* prologue: function */
 1816               	/* frame size = 0 */
 1817               	/* stack size = 2 */
 1818               	.L__stack_usage = 2
 1819 0004 FC01      		movw r30,r24
 1820               	.LVL130:
 1821               	.LBB418:
 1822               	.LBB419:
 251:../../os/rt/include/chlists.h **** }
 1823               		.loc 2 251 0
 1824 0006 8081      		ld r24,Z
 1825 0008 9181      		ldd r25,Z+1
 1826               	.LVL131:
 1827               	.LBE419:
 1828               	.LBE418:
 892:../../os/rt/src/chthreads.c **** 
 893:../../os/rt/src/chthreads.c ****   if (ch_queue_notempty(&tqp->queue)) {
 1829               		.loc 1 893 0
 1830 000a E817      		cp r30,r24
 1831 000c F907      		cpc r31,r25
 1832 000e 01F0      		breq .L52
 1833               	.LVL132:
 1834               	.LBB420:
 1835               	.LBB421:
 1836               	.LBB422:
 1837               	.LBB423:
 283:../../os/rt/include/chlists.h ****   qp->next->prev = qp;
 1838               		.loc 2 283 0
 1839 0010 EC01      		movw r28,r24
 1840 0012 A881      		ld r26,Y
 1841 0014 B981      		ldd r27,Y+1
 1842 0016 B183      		std Z+1,r27
 1843 0018 A083      		st Z,r26
 284:../../os/rt/include/chlists.h **** 
 1844               		.loc 2 284 0
 1845 001a 1396      		adiw r26,2+1
 1846 001c FC93      		st X,r31
 1847 001e EE93      		st -X,r30
 1848 0020 1297      		sbiw r26,2
 1849               	.LVL133:
 1850               	.LBE423:
 1851               	.LBE422:
 452:../../os/rt/include/chthreads.h **** }
 453:../../os/rt/include/chthreads.h **** 
 454:../../os/rt/include/chthreads.h **** /**
 455:../../os/rt/include/chthreads.h ****  * @brief   Initializes a threads queue object.
 456:../../os/rt/include/chthreads.h ****  *
 457:../../os/rt/include/chthreads.h ****  * @param[out] tqp      pointer to the threads queue object
 458:../../os/rt/include/chthreads.h ****  *
 459:../../os/rt/include/chthreads.h ****  * @init
 460:../../os/rt/include/chthreads.h ****  */
 461:../../os/rt/include/chthreads.h **** static inline void chThdQueueObjectInit(threads_queue_t *tqp) {
 462:../../os/rt/include/chthreads.h **** 
 463:../../os/rt/include/chthreads.h ****   ch_queue_init(&tqp->queue);
 464:../../os/rt/include/chthreads.h **** }
 465:../../os/rt/include/chthreads.h **** 
 466:../../os/rt/include/chthreads.h **** /**
 467:../../os/rt/include/chthreads.h ****  * @brief   Evaluates to @p true if the specified queue is empty.
 468:../../os/rt/include/chthreads.h ****  *
 469:../../os/rt/include/chthreads.h ****  * @param[out] tqp      pointer to the threads queue object
 470:../../os/rt/include/chthreads.h ****  * @return              The queue status.
 471:../../os/rt/include/chthreads.h ****  * @retval false        if the queue is not empty.
 472:../../os/rt/include/chthreads.h ****  * @retval true         if the queue is empty.
 473:../../os/rt/include/chthreads.h ****  *
 474:../../os/rt/include/chthreads.h ****  * @iclass
 475:../../os/rt/include/chthreads.h ****  */
 476:../../os/rt/include/chthreads.h **** static inline bool chThdQueueIsEmptyI(threads_queue_t *tqp) {
 477:../../os/rt/include/chthreads.h **** 
 478:../../os/rt/include/chthreads.h ****   chDbgCheckClassI();
 479:../../os/rt/include/chthreads.h **** 
 480:../../os/rt/include/chthreads.h ****   return ch_queue_isempty(&tqp->queue);
 481:../../os/rt/include/chthreads.h **** }
 482:../../os/rt/include/chthreads.h **** 
 483:../../os/rt/include/chthreads.h **** /**
 484:../../os/rt/include/chthreads.h ****  * @brief   Dequeues and wakes up one thread from the threads queue object.
 485:../../os/rt/include/chthreads.h ****  * @details Dequeues one thread from the queue without checking if the queue
 486:../../os/rt/include/chthreads.h ****  *          is empty.
 487:../../os/rt/include/chthreads.h ****  * @pre     The queue must contain at least an object.
 488:../../os/rt/include/chthreads.h ****  *
 489:../../os/rt/include/chthreads.h ****  * @param[in] tqp       pointer to the threads queue object
 490:../../os/rt/include/chthreads.h ****  * @param[in] msg       the message code
 491:../../os/rt/include/chthreads.h ****  *
 492:../../os/rt/include/chthreads.h ****  * @iclass
 493:../../os/rt/include/chthreads.h ****  */
 494:../../os/rt/include/chthreads.h **** static inline void chThdDoDequeueNextI(threads_queue_t *tqp, msg_t msg) {
 495:../../os/rt/include/chthreads.h ****   thread_t *tp;
 496:../../os/rt/include/chthreads.h **** 
 497:../../os/rt/include/chthreads.h ****   chDbgAssert(ch_queue_notempty(&tqp->queue), "empty queue");
 498:../../os/rt/include/chthreads.h **** 
 499:../../os/rt/include/chthreads.h ****   tp = threadref(ch_queue_fifo_remove(&tqp->queue));
 500:../../os/rt/include/chthreads.h **** 
 501:../../os/rt/include/chthreads.h ****   chDbgAssert(tp->state == CH_STATE_QUEUED, "invalid state");
 502:../../os/rt/include/chthreads.h **** 
 503:../../os/rt/include/chthreads.h ****   tp->u.rdymsg = msg;
 1852               		.loc 4 503 0
 1853 0022 7B8B      		std Y+19,r23
 1854 0024 6A8B      		std Y+18,r22
 1855               	/* epilogue start */
 1856               	.LBE421:
 1857               	.LBE420:
 894:../../os/rt/src/chthreads.c ****     chThdDoDequeueNextI(tqp, msg);
 895:../../os/rt/src/chthreads.c ****   }
 896:../../os/rt/src/chthreads.c **** }
 1858               		.loc 1 896 0
 1859 0026 DF91      		pop r29
 1860 0028 CF91      		pop r28
 1861               	.LBB425:
 1862               	.LBB424:
 504:../../os/rt/include/chthreads.h ****   (void) chSchReadyI(tp);
 1863               		.loc 4 504 0
 1864 002a 0C94 0000 		jmp chSchReadyI
 1865               	.LVL134:
 1866               	.L52:
 1867               	/* epilogue start */
 1868               	.LBE424:
 1869               	.LBE425:
 1870               		.loc 1 896 0
 1871 002e DF91      		pop r29
 1872 0030 CF91      		pop r28
 1873 0032 0895      		ret
 1874               		.cfi_endproc
 1875               	.LFE214:
 1877               		.section	.text.chThdDequeueAllI,"ax",@progbits
 1878               	.global	chThdDequeueAllI
 1880               	chThdDequeueAllI:
 1881               	.LFB215:
 897:../../os/rt/src/chthreads.c **** 
 898:../../os/rt/src/chthreads.c **** /**
 899:../../os/rt/src/chthreads.c ****  * @brief   Dequeues and wakes up all threads from the threads queue object.
 900:../../os/rt/src/chthreads.c ****  *
 901:../../os/rt/src/chthreads.c ****  * @param[in] tqp       pointer to the threads queue object
 902:../../os/rt/src/chthreads.c ****  * @param[in] msg       the message code
 903:../../os/rt/src/chthreads.c ****  *
 904:../../os/rt/src/chthreads.c ****  * @iclass
 905:../../os/rt/src/chthreads.c ****  */
 906:../../os/rt/src/chthreads.c **** void chThdDequeueAllI(threads_queue_t *tqp, msg_t msg) {
 1882               		.loc 1 906 0
 1883               		.cfi_startproc
 1884               	.LVL135:
 1885 0000 0F93      		push r16
 1886               	.LCFI29:
 1887               		.cfi_def_cfa_offset 3
 1888               		.cfi_offset 16, -2
 1889 0002 1F93      		push r17
 1890               	.LCFI30:
 1891               		.cfi_def_cfa_offset 4
 1892               		.cfi_offset 17, -3
 1893 0004 CF93      		push r28
 1894               	.LCFI31:
 1895               		.cfi_def_cfa_offset 5
 1896               		.cfi_offset 28, -4
 1897 0006 DF93      		push r29
 1898               	.LCFI32:
 1899               		.cfi_def_cfa_offset 6
 1900               		.cfi_offset 29, -5
 1901               	/* prologue: function */
 1902               	/* frame size = 0 */
 1903               	/* stack size = 4 */
 1904               	.L__stack_usage = 4
 1905 0008 EC01      		movw r28,r24
 1906 000a 8B01      		movw r16,r22
 1907               	.LVL136:
 1908               	.LBB426:
 1909               	.LBB427:
 251:../../os/rt/include/chlists.h **** }
 1910               		.loc 2 251 0
 1911 000c 8881      		ld r24,Y
 1912 000e 9981      		ldd r25,Y+1
 1913               	.LVL137:
 1914               	.LBE427:
 1915               	.LBE426:
 907:../../os/rt/src/chthreads.c **** 
 908:../../os/rt/src/chthreads.c ****   while (ch_queue_notempty(&tqp->queue)) {
 1916               		.loc 1 908 0
 1917 0010 C817      		cp r28,r24
 1918 0012 D907      		cpc r29,r25
 1919 0014 01F0      		breq .L54
 1920               	.LVL138:
 1921               	.L56:
 1922               	.LBB429:
 1923               	.LBB430:
 1924               	.LBB431:
 1925               	.LBB432:
 283:../../os/rt/include/chlists.h ****   qp->next->prev = qp;
 1926               		.loc 2 283 0
 1927 0016 DC01      		movw r26,r24
 1928 0018 ED91      		ld r30,X+
 1929 001a FC91      		ld r31,X
 1930 001c 1197      		sbiw r26,1
 1931 001e F983      		std Y+1,r31
 1932 0020 E883      		st Y,r30
 284:../../os/rt/include/chlists.h **** 
 1933               		.loc 2 284 0
 1934 0022 D383      		std Z+3,r29
 1935 0024 C283      		std Z+2,r28
 1936               	.LVL139:
 1937               	.LBE432:
 1938               	.LBE431:
 503:../../os/rt/include/chthreads.h ****   (void) chSchReadyI(tp);
 1939               		.loc 4 503 0
 1940 0026 5396      		adiw r26,18+1
 1941 0028 1C93      		st X,r17
 1942 002a 0E93      		st -X,r16
 1943 002c 5297      		sbiw r26,18
 1944               		.loc 4 504 0
 1945 002e 0E94 0000 		call chSchReadyI
 1946               	.LVL140:
 1947               	.LBE430:
 1948               	.LBE429:
 1949               	.LBB433:
 1950               	.LBB428:
 251:../../os/rt/include/chlists.h **** }
 1951               		.loc 2 251 0
 1952 0032 8881      		ld r24,Y
 1953 0034 9981      		ldd r25,Y+1
 1954               	.LVL141:
 1955               	.LBE428:
 1956               	.LBE433:
 1957               		.loc 1 908 0
 1958 0036 8C17      		cp r24,r28
 1959 0038 9D07      		cpc r25,r29
 1960 003a 01F4      		brne .L56
 1961               	.LVL142:
 1962               	.L54:
 1963               	/* epilogue start */
 909:../../os/rt/src/chthreads.c ****     chThdDoDequeueNextI(tqp, msg);
 910:../../os/rt/src/chthreads.c ****   }
 911:../../os/rt/src/chthreads.c **** }
 1964               		.loc 1 911 0
 1965 003c DF91      		pop r29
 1966 003e CF91      		pop r28
 1967               	.LVL143:
 1968 0040 1F91      		pop r17
 1969 0042 0F91      		pop r16
 1970               	.LVL144:
 1971 0044 0895      		ret
 1972               		.cfi_endproc
 1973               	.LFE215:
 1975               		.text
 1976               	.Letext0:
 1977               		.file 7 "/usr/lib/gcc/avr/7.3.0/include/stddef.h"
 1978               		.file 8 "/usr/lib/avr/include/stdint.h"
 1979               		.file 9 "../../os/common/ports/AVR/compilers/GCC/chtypes.h"
 1980               		.file 10 "../../os/rt/include/chearly.h"
 1981               		.file 11 "../../os/rt/include/chobjects.h"
 1982               		.file 12 "../../os/rt/include/chrfcu.h"
 1983               		.file 13 "../../os/rt/include/chdebug.h"
 1984               		.file 14 "../../os/rt/include/chsem.h"
 1985               		.file 15 "../../os/rt/include/chmtx.h"
 1986               		.file 16 "../../os/rt/include/chsys.h"
 1987               		.file 17 "../../os/rt/include/chregistry.h"
 1988               		.file 18 "../../os/oslib/include/chmemcore.h"
 1989               		.file 19 "../../os/rt/include/chschd.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 chthreads.c
     /tmp/ccm4X58O.s:2      *ABS*:000000000000003e __SP_H__
     /tmp/ccm4X58O.s:3      *ABS*:000000000000003d __SP_L__
     /tmp/ccm4X58O.s:4      *ABS*:000000000000003f __SREG__
     /tmp/ccm4X58O.s:5      *ABS*:0000000000000000 __tmp_reg__
     /tmp/ccm4X58O.s:6      *ABS*:0000000000000001 __zero_reg__
     /tmp/ccm4X58O.s:13     .text.__thd_object_init:0000000000000000 __thd_object_init
     /tmp/ccm4X58O.s:128    .text.chThdCreateSuspendedI:0000000000000000 chThdCreateSuspendedI
     /tmp/ccm4X58O.s:298    .text.chThdCreateSuspended:0000000000000000 chThdCreateSuspended
     /tmp/ccm4X58O.s:346    .text.chThdCreateI:0000000000000000 chThdCreateI
     /tmp/ccm4X58O.s:366    .text.chThdCreate:0000000000000000 chThdCreate
     /tmp/ccm4X58O.s:435    .text.chThdCreateStatic:0000000000000000 chThdCreateStatic
     /tmp/ccm4X58O.s:612    .text.chThdStart:0000000000000000 chThdStart
     /tmp/ccm4X58O.s:674    .text.chThdAddRef:0000000000000000 chThdAddRef
     /tmp/ccm4X58O.s:723    .text.chThdRelease:0000000000000000 chThdRelease
     /tmp/ccm4X58O.s:822    .text.chThdExitS:0000000000000000 chThdExitS
     /tmp/ccm4X58O.s:946    .text.chThdExit:0000000000000000 chThdExit
     /tmp/ccm4X58O.s:976    .text.chThdWait:0000000000000000 chThdWait
     /tmp/ccm4X58O.s:1083   .text.chThdSetPriority:0000000000000000 chThdSetPriority
     /tmp/ccm4X58O.s:1160   .text.chThdTerminate:0000000000000000 chThdTerminate
     /tmp/ccm4X58O.s:1209   .text.chThdSleep:0000000000000000 chThdSleep
     /tmp/ccm4X58O.s:1264   .text.chThdSleepUntil:0000000000000000 chThdSleepUntil
     /tmp/ccm4X58O.s:1340   .text.chThdSleepUntilWindowed:0000000000000000 chThdSleepUntilWindowed
     /tmp/ccm4X58O.s:1439   .text.chThdYield:0000000000000000 chThdYield
     /tmp/ccm4X58O.s:1485   .text.chThdSuspendS:0000000000000000 chThdSuspendS
     /tmp/ccm4X58O.s:1539   .text.chThdSuspendTimeoutS:0000000000000000 chThdSuspendTimeoutS
     /tmp/ccm4X58O.s:1584   .text.chThdResumeI:0000000000000000 chThdResumeI
     /tmp/ccm4X58O.s:1624   .text.chThdResumeS:0000000000000000 chThdResumeS
     /tmp/ccm4X58O.s:1661   .text.chThdResume:0000000000000000 chThdResume
     /tmp/ccm4X58O.s:1727   .text.chThdEnqueueTimeoutS:0000000000000000 chThdEnqueueTimeoutS
     /tmp/ccm4X58O.s:1802   .text.chThdDequeueNextI:0000000000000000 chThdDequeueNextI
     /tmp/ccm4X58O.s:1880   .text.chThdDequeueAllI:0000000000000000 chThdDequeueAllI

UNDEFINED SYMBOLS
_port_thread_start
ch0
chSchReadyI
chSchWakeupS
chSchGoSleepS
chSchRescheduleS
chSchGoSleepTimeoutS
chSchDoYieldS
__do_copy_data
